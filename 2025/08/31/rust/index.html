<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"goversion.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="rust 语言的优点是安全，它把运行时的潜在问题扼杀在编码阶段，只要程序编绎通过，运行时就基本不会有 bug 了。 但它有明显的缺点，从语言形式上它不太自然，缺乏美感。 做下面这些题之前，可以先阅读一下诸如《Rust 程序设计语言》、《Rust语言圣经》、《Rust入门秘籍》、《Rust 死灵书》的链接。  死灵书 https:&#x2F;&#x2F;nomicon.purewhite.io&#x2F;  我初看 rust a">
<meta property="og:type" content="article">
<meta property="og:title" content="rust">
<meta property="og:url" content="https://goversion.github.io/2025/08/31/rust/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="rust 语言的优点是安全，它把运行时的潜在问题扼杀在编码阶段，只要程序编绎通过，运行时就基本不会有 bug 了。 但它有明显的缺点，从语言形式上它不太自然，缺乏美感。 做下面这些题之前，可以先阅读一下诸如《Rust 程序设计语言》、《Rust语言圣经》、《Rust入门秘籍》、《Rust 死灵书》的链接。  死灵书 https:&#x2F;&#x2F;nomicon.purewhite.io&#x2F;  我初看 rust a">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-08-31T09:50:41.000Z">
<meta property="article:modified_time" content="2025-08-31T09:52:02.491Z">
<meta property="article:author" content="zhou tao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://goversion.github.io/2025/08/31/rust/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://goversion.github.io/2025/08/31/rust/","path":"2025/08/31/rust/","title":"rust"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>rust | Hexo</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#000-intro-intro2-rs"><span class="nav-number">1.</span> <span class="nav-text">000 intro&#x2F;intro2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#001-variables-variables1-rs"><span class="nav-number">2.</span> <span class="nav-text">001 variables&#x2F;variables1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#002-variables-variables2-rs"><span class="nav-number">3.</span> <span class="nav-text">002 variables&#x2F;variables2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#003-variables-variables3-rs"><span class="nav-number">4.</span> <span class="nav-text">003 variables&#x2F;variables3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#004-variables-variables4-rs"><span class="nav-number">5.</span> <span class="nav-text">004 variables&#x2F;variables4.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#005-variables-variables5-rs"><span class="nav-number">6.</span> <span class="nav-text">005 variables&#x2F;variables5.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#006-variables-variables6-rs"><span class="nav-number">7.</span> <span class="nav-text">006 variables&#x2F;variables6.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#007-functions-functions1-rs"><span class="nav-number">8.</span> <span class="nav-text">007 functions&#x2F;functions1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#008-functions-functions2-rs"><span class="nav-number">9.</span> <span class="nav-text">008 functions&#x2F;functions2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#009-functions-functions3-rs"><span class="nav-number">10.</span> <span class="nav-text">009 functions&#x2F;functions3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#010-functions-functions4"><span class="nav-number">11.</span> <span class="nav-text">010 functions&#x2F;functions4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#011-functions-functions5-rs"><span class="nav-number">12.</span> <span class="nav-text">011 functions&#x2F;functions5.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#012-if-if1-rs"><span class="nav-number">13.</span> <span class="nav-text">012 if&#x2F;if1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#013-if-if2-rs"><span class="nav-number">14.</span> <span class="nav-text">013 if&#x2F;if2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#014-if-if3-rs"><span class="nav-number">15.</span> <span class="nav-text">014 if&#x2F;if3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#015-quiz1-rs"><span class="nav-number">16.</span> <span class="nav-text">015 quiz1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#016-primitive-types-primitive-types1-rs"><span class="nav-number">17.</span> <span class="nav-text">016 primitive_types&#x2F;primitive_types1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#017-primitive-types-primitive-types2-rs"><span class="nav-number">18.</span> <span class="nav-text">017 primitive_types&#x2F;primitive_types2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#018-primitive-types-primitive-types3-rs"><span class="nav-number">19.</span> <span class="nav-text">018 primitive_types&#x2F;primitive_types3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#019-primitive-types-primitive-types4-rs"><span class="nav-number">20.</span> <span class="nav-text">019 primitive_types&#x2F;primitive_types4.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#020-primitive-types-primitive-types5-rs"><span class="nav-number">21.</span> <span class="nav-text">020 primitive_types&#x2F;primitive_types5.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#021-primitive-types-primitive-types6-rs"><span class="nav-number">22.</span> <span class="nav-text">021 primitive_types&#x2F;primitive_types6.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#022-vecs-vecs1-rs"><span class="nav-number">23.</span> <span class="nav-text">022 vecs&#x2F;vecs1.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9AVector-%E5%90%91%E9%87%8F%E8%AF%A6%E8%A7%A3"><span class="nav-number">23.0.1.</span> <span class="nav-text">背景讲解：Vector 向量详解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E3%80%81Vector-%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E5%88%9B%E5%BB%BA"><span class="nav-number">23.0.2.</span> <span class="nav-text">一、Vector 的定义和创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Vector-%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">23.0.3.</span> <span class="nav-text">二、Vector 的常用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E3%80%81Vector-%E7%9A%84%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">23.0.4.</span> <span class="nav-text">三、Vector 的使用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%90%91-Vector-%E6%B7%BB%E5%8A%A0%E5%92%8C%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0"><span class="nav-number">23.0.4.1.</span> <span class="nav-text">示例一：向 Vector 添加和删除元素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BA%8C%EF%BC%9A%E9%81%8D%E5%8E%86-Vector-%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0"><span class="nav-number">23.0.4.2.</span> <span class="nav-text">示例二：遍历 Vector 中的元素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%B8%89%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E8%AE%BF%E9%97%AE-Vector-%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0"><span class="nav-number">23.0.4.3.</span> <span class="nav-text">示例三：使用索引访问 Vector 中的元素</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#023-vecs-vecs2-rs"><span class="nav-number">24.</span> <span class="nav-text">023 vecs&#x2F;vecs2.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9A%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">24.0.1.</span> <span class="nav-text">背景讲解：迭代器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#024-move-semantics-move-semantics1-rs"><span class="nav-number">25.</span> <span class="nav-text">024 move_semantics&#x2F;move_semantics1.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9A%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E5%80%9F%E7%94%A8"><span class="nav-number">25.0.1.</span> <span class="nav-text">背景讲解：所有权和借用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#clone-%EF%BC%9A%E5%A4%8D%E5%88%B6-String-%E4%B8%AD%E5%A0%86%E4%B8%8A%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%80%8C%E4%B8%8D%E4%BB%85%E4%BB%85%E6%98%AF%E6%A0%88%E4%B8%8A%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E3%80%82"><span class="nav-number">25.0.1.1.</span> <span class="nav-text">clone()：复制 String 中堆上的数据，而不仅仅是栈上的数据，。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%8A%E4%B8%80%E4%B8%AA%E5%80%BC-%E6%89%80%E6%9C%89%E6%9D%83-%E4%BC%A0%E6%9D%A5%E4%BC%A0%E5%8E%BB%E6%9D%A5%E4%BD%BF%E7%94%A8%E5%AE%83"><span class="nav-number">25.0.1.2.</span> <span class="nav-text">把一个值(所有权)传来传去来使用它</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%95%E7%94%A8%E5%92%8C%E5%80%9F%E7%94%A8"><span class="nav-number">25.0.1.3.</span> <span class="nav-text">引用和借用</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#025-move-semantics-move-semantics2-rs"><span class="nav-number">26.</span> <span class="nav-text">025 move_semantics&#x2F;move_semantics2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#026-move-semantics-move-semantics3-rs"><span class="nav-number">27.</span> <span class="nav-text">026 move_semantics&#x2F;move_semantics3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#027-move-semantics-move-semantics4-rs"><span class="nav-number">28.</span> <span class="nav-text">027 move_semantics&#x2F;move_semantics4.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#028-move-semantics-move-semantics5-rs"><span class="nav-number">29.</span> <span class="nav-text">028 move_semantics&#x2F;move_semantics5.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#029-move-semantics-move-semantics6-rs"><span class="nav-number">30.</span> <span class="nav-text">029 move_semantics&#x2F;move_semantics6.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#030-structs-structs1-rs"><span class="nav-number">31.</span> <span class="nav-text">030 structs&#x2F;structs1.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9A"><span class="nav-number">31.0.1.</span> <span class="nav-text">背景讲解：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#031-structs-structs2-rs"><span class="nav-number">32.</span> <span class="nav-text">031 structs&#x2F;structs2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#032-structs-structs3-rs"><span class="nav-number">33.</span> <span class="nav-text">032 structs&#x2F;structs3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#033-enums-enums1-rs"><span class="nav-number">34.</span> <span class="nav-text">033 enums&#x2F;enums1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#034-enums-enums2-rs"><span class="nav-number">35.</span> <span class="nav-text">034 enums&#x2F;enums2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#035-enums-enums3-rs"><span class="nav-number">36.</span> <span class="nav-text">035 enums&#x2F;enums3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#036-strings-strings1-rs"><span class="nav-number">37.</span> <span class="nav-text">036 strings&#x2F;strings1.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">37.1.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%85%88%E7%9C%8B-str%EF%BC%9A"><span class="nav-number">37.1.1.</span> <span class="nav-text">1. 先看 str：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%86%8D%E7%9C%8B-string"><span class="nav-number">37.1.2.</span> <span class="nav-text">2. 再看 string</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#037-strings-strings2-rs"><span class="nav-number">38.</span> <span class="nav-text">037 strings&#x2F;strings2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#038-strings-strings3-rs"><span class="nav-number">39.</span> <span class="nav-text">038 strings&#x2F;strings3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#039-strings-strings4-rs"><span class="nav-number">40.</span> <span class="nav-text">039 strings&#x2F;strings4.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#040-modules-modules1-rs"><span class="nav-number">41.</span> <span class="nav-text">040 modules&#x2F;modules1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#041-modules-modules2-rs"><span class="nav-number">42.</span> <span class="nav-text">041 modules&#x2F;modules2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#042-modules-modules3-rs"><span class="nav-number">43.</span> <span class="nav-text">042 modules&#x2F;modules3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#043-hashmaps-hashmaps1-rs"><span class="nav-number">44.</span> <span class="nav-text">043 hashmaps&#x2F;hashmaps1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#044-hashmaps-hashmaps2-rs"><span class="nav-number">45.</span> <span class="nav-text">044 hashmaps&#x2F;hashmaps2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#045-hashmaps-hashmaps3-rs"><span class="nav-number">46.</span> <span class="nav-text">045 hashmaps&#x2F;hashmaps3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#046-quiz2-rs"><span class="nav-number">47.</span> <span class="nav-text">046 quiz2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#047-options-options1-rs"><span class="nav-number">48.</span> <span class="nav-text">047 options&#x2F;options1.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9AOption"><span class="nav-number">48.0.1.</span> <span class="nav-text">背景讲解：Option</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#048-options-options2-rs"><span class="nav-number">49.</span> <span class="nav-text">048 options&#x2F;options2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#049-options-options3-rs"><span class="nav-number">50.</span> <span class="nav-text">049 options&#x2F;options3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#050-error-handling-errors1-rs"><span class="nav-number">51.</span> <span class="nav-text">050 error_handling&#x2F;errors1.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9A-From-%E5%92%8C-Into"><span class="nav-number">51.0.1.</span> <span class="nav-text">背景讲解： From 和 Into</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9A-Result"><span class="nav-number">51.0.2.</span> <span class="nav-text">背景讲解： Result</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#051-error-handling-errors2-rs"><span class="nav-number">52.</span> <span class="nav-text">051 error_handling&#x2F;errors2.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9C%8B%E4%B8%8B%E9%9D%A2%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%8C-%E9%81%BF%E5%85%8D%E4%BA%86%E5%AF%B9%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%88%A4%E6%96%AD%E3%80%82"><span class="nav-number">52.0.1.</span> <span class="nav-text">看下面的例子，? 避免了对变量类型的判断。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#052-error-handling-errors3-rs"><span class="nav-number">53.</span> <span class="nav-text">052 error_handling&#x2F;errors3.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#unwrap-%E6%95%85%E9%9A%9C%E6%97%B6%E6%89%A7%E8%A1%8Cpanic"><span class="nav-number">53.0.1.</span> <span class="nav-text">unwrap: 故障时执行panic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E6%97%B6%E8%BF%94%E5%9B%9EErr%E5%AF%B9%E8%B1%A1"><span class="nav-number">53.0.2.</span> <span class="nav-text">?: 故障时返回Err对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#053-error-handling-errors4-rs"><span class="nav-number">54.</span> <span class="nav-text">053 error_handling&#x2F;errors4.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E8%AE%B2%E8%A7%A3%EF%BC%9A-1"><span class="nav-number">54.0.1.</span> <span class="nav-text">背景讲解：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE"><span class="nav-number">54.0.2.</span> <span class="nav-text">疑问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#054-error-handling-errors5-rs"><span class="nav-number">55.</span> <span class="nav-text">054 error_handling&#x2F;errors5.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE-1"><span class="nav-number">55.0.1.</span> <span class="nav-text">疑问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#055-error-handling-errors6-rs"><span class="nav-number">56.</span> <span class="nav-text">055 error_handling&#x2F;errors6.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">56.0.1.</span> <span class="nav-text">参考</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%94%E8%AE%B0"><span class="nav-number">56.0.2.</span> <span class="nav-text">笔记</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%85%E5%88%A0"><span class="nav-number">56.0.3.</span> <span class="nav-text">待删</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%85%E6%B6%88%E5%8C%96%EF%BC%8C%E5%BE%85%E5%88%A0%E9%99%A4%E7%9A%84%E5%86%85%E5%AE%B9"><span class="nav-number">56.0.4.</span> <span class="nav-text">待消化，待删除的内容</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#056-generics-generics1-rs"><span class="nav-number">57.</span> <span class="nav-text">056 generics&#x2F;generics1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#057-generics-generics2-rs"><span class="nav-number">58.</span> <span class="nav-text">057 generics&#x2F;generics2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#058-traits-traits1-rs"><span class="nav-number">59.</span> <span class="nav-text">058 traits&#x2F;traits1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#59-traits-traits2-rs"><span class="nav-number">60.</span> <span class="nav-text">59 traits&#x2F;traits2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#60-traits-traits3-rs"><span class="nav-number">61.</span> <span class="nav-text">60 traits&#x2F;traits3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#61-traits-traits4-rs"><span class="nav-number">62.</span> <span class="nav-text">61 traits&#x2F;traits4.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#62-traits-traits5-rs"><span class="nav-number">63.</span> <span class="nav-text">62 traits&#x2F;traits5.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#63-quiz3-rs"><span class="nav-number">64.</span> <span class="nav-text">63 quiz3.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE%EF%BC%9A"><span class="nav-number">64.0.1.</span> <span class="nav-text">疑问：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#064-lifetimes-lifetimes1-rs"><span class="nav-number">65.</span> <span class="nav-text">064 lifetimes&#x2F;lifetimes1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#065-lifetimes-lifetimes2-rs"><span class="nav-number">66.</span> <span class="nav-text">065 lifetimes&#x2F;lifetimes2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#066-lifetimes-lifetimes3-rs"><span class="nav-number">67.</span> <span class="nav-text">066 lifetimes&#x2F;lifetimes3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#067-tests-tests1-rs"><span class="nav-number">68.</span> <span class="nav-text">067 tests&#x2F;tests1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#068-tests-tests2-rs"><span class="nav-number">69.</span> <span class="nav-text">068 tests&#x2F;tests2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#069-tests-tests3-rs"><span class="nav-number">70.</span> <span class="nav-text">069 tests&#x2F;tests3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#070-tests-tests4-rs"><span class="nav-number">71.</span> <span class="nav-text">070 tests&#x2F;tests4.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE%EF%BC%9A-1"><span class="nav-number">71.0.1.</span> <span class="nav-text">疑问：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#71-iterators-iterators1-rs"><span class="nav-number">72.</span> <span class="nav-text">71 iterators&#x2F;iterators1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#72-iterators-iterators2-rs"><span class="nav-number">73.</span> <span class="nav-text">72 iterators&#x2F;iterators2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#73-iterators-iterators3-rs"><span class="nav-number">74.</span> <span class="nav-text">73 iterators&#x2F;iterators3.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE-2"><span class="nav-number">74.0.1.</span> <span class="nav-text">疑问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#74-iterators-iterators4-rs"><span class="nav-number">75.</span> <span class="nav-text">74 iterators&#x2F;iterators4.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#75-iterators-iterators5-rs"><span class="nav-number">76.</span> <span class="nav-text">75 iterators&#x2F;iterators5.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE-3"><span class="nav-number">76.0.1.</span> <span class="nav-text">疑问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E8%80%83-1"><span class="nav-number">76.0.2.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#76-smart-pointers-box1-rs"><span class="nav-number">77.</span> <span class="nav-text">76 smart_pointers&#x2F;box1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#77-smart-pointers-rc1-rs"><span class="nav-number">78.</span> <span class="nav-text">77 smart_pointers&#x2F;rc1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#78-smart-pointers-arc1-rs"><span class="nav-number">79.</span> <span class="nav-text">78 smart_pointers&#x2F;arc1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#79-smart-pointers-cow1-rs"><span class="nav-number">80.</span> <span class="nav-text">79 smart_pointers&#x2F;cow1.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE-4"><span class="nav-number">80.0.1.</span> <span class="nav-text">疑问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#80-thread-thread1-rs"><span class="nav-number">81.</span> <span class="nav-text">80 thread&#x2F;thread1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#81-threads-threads2-rs"><span class="nav-number">82.</span> <span class="nav-text">81 threads&#x2F;threads2.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%96%91%E9%97%AE-5"><span class="nav-number">82.0.1.</span> <span class="nav-text">疑问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E4%BA%86%E8%A7%A3%EF%BC%9A%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="nav-number">82.0.2.</span> <span class="nav-text">背景了解：智能指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Box%E6%8C%87%E9%92%88"><span class="nav-number">82.0.3.</span> <span class="nav-text">1. Box指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Rc%E6%8C%87%E9%92%88"><span class="nav-number">82.0.4.</span> <span class="nav-text">2. Rc指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Arc%E6%8C%87%E9%92%88"><span class="nav-number">82.0.5.</span> <span class="nav-text">3. Arc指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Mutex%E6%8C%87%E9%92%88"><span class="nav-number">82.0.6.</span> <span class="nav-text">4. Mutex指针</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%88%E7%89%88"><span class="nav-number">82.0.6.1.</span> <span class="nav-text">终版</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#82-threads-threads3-rs"><span class="nav-number">83.</span> <span class="nav-text">82 threads&#x2F;threads3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#083-macros-macros1-rs"><span class="nav-number">84.</span> <span class="nav-text">083 macros&#x2F;macros1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#084-macros-macros2-rs"><span class="nav-number">85.</span> <span class="nav-text">084 macros&#x2F;macros2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#085-macros-macros3-rs"><span class="nav-number">86.</span> <span class="nav-text">085 macros&#x2F;macros3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#086-macros-macros4-rs"><span class="nav-number">87.</span> <span class="nav-text">086 macros&#x2F;macros4.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#087-clippy-clippy1-rs"><span class="nav-number">88.</span> <span class="nav-text">087 clippy&#x2F;clippy1.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#088-clippy-clippy2-rs"><span class="nav-number">89.</span> <span class="nav-text">088 clippy&#x2F;clippy2.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#089-clippy-clippy3-rs"><span class="nav-number">90.</span> <span class="nav-text">089 clippy&#x2F;clippy3.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#090-conversions-using-as-rs"><span class="nav-number">91.</span> <span class="nav-text">090 conversions&#x2F;using_as.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#091-conversions-from-into-rs"><span class="nav-number">92.</span> <span class="nav-text">091 conversions&#x2F;from_into.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#092-conversions-from-str-rs"><span class="nav-number">93.</span> <span class="nav-text">092 conversions&#x2F;from_str.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#093-conversions-try-from-into-rs"><span class="nav-number">94.</span> <span class="nav-text">093 conversions&#x2F;try_from_into.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#094-conversions-as-ref-mut-rs"><span class="nav-number">95.</span> <span class="nav-text">094 conversions&#x2F;as_ref_mut.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#095-tests-tests5-rs"><span class="nav-number">96.</span> <span class="nav-text">095 tests&#x2F;tests5.rs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A"><span class="nav-number">96.0.1.</span> <span class="nav-text">参考：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#096-tests-tests6-rs"><span class="nav-number">97.</span> <span class="nav-text">096 tests&#x2F;tests6.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#097-tests-tests7-rs"><span class="nav-number">98.</span> <span class="nav-text">097 tests&#x2F;tests7.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#098-tests-tests8-rs"><span class="nav-number">99.</span> <span class="nav-text">098 tests&#x2F;tests8.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#099-tests-tests9-rs"><span class="nav-number">100.</span> <span class="nav-text">099 tests&#x2F;tests9.rs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A-1"><span class="nav-number">101.</span> <span class="nav-text">参考：</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zhou tao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://goversion.github.io/2025/08/31/rust/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhou tao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="rust | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          rust
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-08-31 17:50:41 / 修改时间：17:52:02" itemprop="dateCreated datePublished" datetime="2025-08-31T17:50:41+08:00">2025-08-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>rust 语言的优点是安全，它把运行时的潜在问题扼杀在编码阶段，只要程序编绎通过，运行时就基本不会有 bug 了。</p>
<p>但它有明显的缺点，从语言形式上它不太自然，缺乏美感。</p>
<p>做下面这些题之前，可以先阅读一下诸如《Rust 程序设计语言》、《Rust语言圣经》、《Rust入门秘籍》、《Rust 死灵书》的链接。</p>
<ul>
<li>死灵书 <a target="_blank" rel="noopener" href="https://nomicon.purewhite.io/">https://nomicon.purewhite.io/</a></li>
</ul>
<p>我初看 rust algorithm 代码时，几乎看不懂的。rust 比传统的 java&#x2F;c++&#x2F;python 语言难了一个数量级，本文以 rustling 为引子，把 rust 的基础内容全部串一遍。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">intro2                  intro/intro2.rs</span><br><span class="line">variables1              variables/variables1.rs</span><br><span class="line">variables2              variables/variables2.rs</span><br><span class="line">variables3              variables/variables3.rs</span><br><span class="line">variables4              variables/variables4.rs</span><br><span class="line">variables5              variables/variables5.rs</span><br><span class="line">variables6              variables/variables6.rs</span><br><span class="line">functions1              functions/functions1.rs</span><br><span class="line">functions2              functions/functions2.rs</span><br><span class="line">functions3              functions/functions3.rs</span><br><span class="line">functions4              functions/functions4.rs</span><br><span class="line">functions5              functions/functions5.rs</span><br><span class="line">if1                     if/if1.rs</span><br><span class="line">if2                     if/if2.rs</span><br><span class="line">if3                     if/if3.rs</span><br><span class="line">quiz1                   quiz1.rs</span><br><span class="line">primitive_types1        primitive_types/primitive_types1.rs</span><br><span class="line">primitive_types2        primitive_types/primitive_types2.rs</span><br><span class="line">primitive_types3        primitive_types/primitive_types3.rs</span><br><span class="line">primitive_types4        primitive_types/primitive_types4.rs</span><br><span class="line">primitive_types5        primitive_types/primitive_types5.rs</span><br><span class="line">primitive_types6        primitive_types/primitive_types6.rs</span><br><span class="line">vecs1                   vecs/vecs1.rs</span><br><span class="line">vecs2                   vecs/vecs2.rs</span><br><span class="line">move_semantics1         move_semantics/move_semantics1.rs</span><br><span class="line">move_semantics2         move_semantics/move_semantics2.rs</span><br><span class="line">move_semantics3         move_semantics/move_semantics3.rs</span><br><span class="line">move_semantics4         move_semantics/move_semantics4.rs</span><br><span class="line">move_semantics5         move_semantics/move_semantics5.rs</span><br><span class="line">move_semantics6         move_semantics/move_semantics6.rs</span><br><span class="line">structs1                structs/structs1.rs</span><br><span class="line">structs2                structs/structs2.rs</span><br><span class="line">structs3                structs/structs3.rs</span><br><span class="line">enums1                  enums/enums1.rs</span><br><span class="line">enums2                  enums/enums2.rs</span><br><span class="line">enums3                  enums/enums3.rs</span><br><span class="line">strings1                strings/strings1.rs</span><br><span class="line">strings2                strings/strings2.rs</span><br><span class="line">strings3                strings/strings3.rs</span><br><span class="line">strings4                strings/strings4.rs</span><br><span class="line">modules1                modules/modules1.rs</span><br><span class="line">modules2                modules/modules2.rs</span><br><span class="line">modules3                modules/modules3.rs</span><br><span class="line">hashmaps1               hashmaps/hashmaps1.rs</span><br><span class="line">hashmaps2               hashmaps/hashmaps2.rs</span><br><span class="line">hashmaps3               hashmaps/hashmaps3.rs</span><br><span class="line">quiz2                   quiz2.rs</span><br><span class="line">options1                options/options1.rs</span><br><span class="line">options2                options/options2.rs</span><br><span class="line">options3                options/options3.rs</span><br><span class="line">errors1                 error_handling/errors1.rs</span><br><span class="line">errors2                 error_handling/errors2.rs</span><br><span class="line">errors3                 error_handling/errors3.rs</span><br><span class="line">errors4                 error_handling/errors4.rs</span><br><span class="line">errors5                 error_handling/errors5.rs</span><br><span class="line">errors6                 error_handling/errors6.rs</span><br><span class="line">generics1               generics/generics1.rs</span><br><span class="line">generics2               generics/generics2.rs</span><br><span class="line">traits1                 traits/traits1.rs</span><br><span class="line">traits2                 traits/traits2.rs</span><br><span class="line">traits3                 traits/traits3.rs</span><br><span class="line">traits4                 traits/traits4.rs</span><br><span class="line">traits5                 traits/traits5.rs</span><br><span class="line">quiz3                   quiz3.rs</span><br><span class="line">lifetimes1              lifetimes/lifetimes1.rs</span><br><span class="line">lifetimes2              lifetimes/lifetimes2.rs</span><br><span class="line">lifetimes3              lifetimes/lifetimes3.rs</span><br><span class="line">tests1                  tests/tests1.rs</span><br><span class="line">tests2                  tests/tests2.rs</span><br><span class="line">tests3                  tests/tests3.rs</span><br><span class="line">tests4                  tests/tests4.rs</span><br><span class="line">iterators1              iterators/iterators1.rs</span><br><span class="line">iterators2              iterators/iterators2.rs</span><br><span class="line">iterators3              iterators/iterators3.rs</span><br><span class="line">iterators4              iterators/iterators4.rs</span><br><span class="line">iterators5              iterators/iterators5.rs</span><br><span class="line">box1                    smart_pointers/box1.rs</span><br><span class="line">rc1                     smart_pointers/rc1.rs</span><br><span class="line">arc1                    smart_pointers/arc1.rs</span><br><span class="line">cow1                    smart_pointers/cow1.rs</span><br><span class="line">threads1                threads/threads1.rs</span><br><span class="line">threads2                threads/threads2.rs</span><br><span class="line">threads3                threads/threads3.rs</span><br><span class="line">macros1                 macros/macros1.rs</span><br><span class="line">macros2                 macros/macros2.rs</span><br><span class="line">macros3                 macros/macros3.rs</span><br><span class="line">macros4                 macros/macros4.rs</span><br><span class="line">clippy1                 clippy/clippy1.rs</span><br><span class="line">clippy2                 clippy/clippy2.rs</span><br><span class="line">clippy3                 clippy/clippy3.rs</span><br><span class="line">using_as                conversions/using_as.rs</span><br><span class="line">from_into               conversions/from_into.rs</span><br><span class="line">from_str                conversions/from_str.rs</span><br><span class="line">try_from_into           conversions/try_from_into.rs</span><br><span class="line">as_ref_mut              conversions/as_ref_mut.rs</span><br><span class="line">tests5                  tests/tests5.rs</span><br><span class="line">tests6                  tests/tests6.rs</span><br><span class="line">tests7                  tests/tests7.rs</span><br><span class="line">tests8                  tests/tests8.rs</span><br><span class="line">tests9                  tests/tests9.rs</span><br><span class="line">algorithm1              algorithm/algorithm1.rs</span><br><span class="line">algorithm2              algorithm/algorithm2.rs</span><br><span class="line">algorithm3              algorithm/algorithm3.rs</span><br><span class="line">algorithm4              algorithm/algorithm4.rs</span><br><span class="line">algorithm5              algorithm/algorithm5.rs</span><br><span class="line">algorithm6              algorithm/algorithm6.rs</span><br><span class="line">algorithm7              algorithm/algorithm7.rs</span><br><span class="line">algorithm8              algorithm/algorithm8.rs</span><br><span class="line">algorithm9              algorithm/algorithm9.rs</span><br><span class="line">algorithm10             algorithm/algorithm10.rs</span><br></pre></td></tr></table></figure>


<h2 id="000-intro-intro2-rs"><a href="#000-intro-intro2-rs" class="headerlink" title="000 intro&#x2F;intro2.rs"></a>000 intro&#x2F;intro2.rs</h2><h2 id="001-variables-variables1-rs"><a href="#001-variables-variables1-rs" class="headerlink" title="001 variables&#x2F;variables1.rs"></a>001 variables&#x2F;variables1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x has the value &#123;&#125;&quot;</span>, x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>变量定义用let，其实在rust里 是一个数据绑定到一个变量，这是这个语言内存管理方面的创新点。</p>
<h2 id="002-variables-variables2-rs"><a href="#002-variables-variables2-rs" class="headerlink" title="002 variables&#x2F;variables2.rs"></a>002 variables&#x2F;variables2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">10</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x is ten!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x is not ten!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>变量出现必须与一个数据做绑定，而绑定后默认不可修改，如果后续要对他修改，那就加上mut。</p>
<p>这里还涉及一个if判断逻辑，类似于python2，不需要括号。</p>
<h2 id="003-variables-variables3-rs"><a href="#003-variables-variables3-rs" class="headerlink" title="003 variables&#x2F;variables3.rs"></a>003 variables&#x2F;variables3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: <span class="type">i32</span> =<span class="number">5</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number &#123;&#125;&quot;</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>报错信息是变量x没有被初始化，所以变量出现必须与一个数据做绑定，同时i32是可以取掉的，因为rust编译器将自动将x推导为等式右边数字的类型。</p>
<h2 id="004-variables-variables4-rs"><a href="#004-variables-variables4-rs" class="headerlink" title="004 variables&#x2F;variables4.rs"></a>004 variables&#x2F;variables4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number &#123;&#125;&quot;</span>, x);</span><br><span class="line">    x = <span class="number">5</span>; <span class="comment">// don&#x27;t change this line</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number &#123;&#125;&quot;</span>, x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>像某语言一样 let 不可变，var 可变。</p>
<h2 id="005-variables-variables5-rs"><a href="#005-variables-variables5-rs" class="headerlink" title="005 variables&#x2F;variables5.rs"></a>005 variables&#x2F;variables5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="string">&quot;T-H-R-E-E&quot;</span>; <span class="comment">// don&#x27;t change this line</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Spell a Number : &#123;&#125;&quot;</span>, number);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="number">3</span>; <span class="comment">// don&#x27;t rename this variable</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number plus two is : &#123;&#125;&quot;</span>, number + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="006-variables-variables6-rs"><a href="#006-variables-variables6-rs" class="headerlink" title="006 variables&#x2F;variables6.rs"></a>006 variables&#x2F;variables6.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> NUMBER:<span class="type">i16</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number &#123;&#125;&quot;</span>, NUMBER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="007-functions-functions1-rs"><a href="#007-functions-functions1-rs" class="headerlink" title="007 functions&#x2F;functions1.rs"></a>007 functions&#x2F;functions1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">call_me</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">call_me</span>()&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不要求被调用函数必须在调用者之前声明或者定义。</p>
<h2 id="008-functions-functions2-rs"><a href="#008-functions-functions2-rs" class="headerlink" title="008 functions&#x2F;functions2.rs"></a>008 functions&#x2F;functions2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">call_me</span>(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">call_me</span>(num: <span class="type">i32</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..num &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Ring! Call number &#123;&#125;&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="009-functions-functions3-rs"><a href="#009-functions-functions3-rs" class="headerlink" title="009 functions&#x2F;functions3.rs"></a>009 functions&#x2F;functions3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">call_me</span>(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">call_me</span>(num: <span class="type">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..num &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Ring! Call number &#123;&#125;&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="010-functions-functions4"><a href="#010-functions-functions4" class="headerlink" title="010 functions&#x2F;functions4"></a>010 functions&#x2F;functions4</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This store is having a sale where</span></span><br><span class="line"><span class="comment">// if the price is an even number, you get 10 Rustbucks off, but</span></span><br><span class="line"><span class="comment">// if it&#x27;s an odd number, it&#x27;s 3 Rustbucks off.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">original_price</span> = <span class="number">51</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Your sale price is &#123;&#125;&quot;</span>, <span class="title function_ invoke__">sale_price</span>(original_price));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">sale_price</span>(price: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="title function_ invoke__">is_even</span>(price) &#123;</span><br><span class="line">        price - <span class="number">10</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        price - <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">is_even</span>(num: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    num % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>返回值的类型，需要写明白。</p>
<h2 id="011-functions-functions5-rs"><a href="#011-functions-functions5-rs" class="headerlink" title="011 functions&#x2F;functions5.rs"></a>011 functions&#x2F;functions5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">answer</span> = <span class="title function_ invoke__">square</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The square of 3 is &#123;&#125;&quot;</span>, answer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">square</span>(num: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    num * num</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>square 的返回行 <code>num * num;</code> 分号要去掉。</p>
<h2 id="012-if-if1-rs"><a href="#012-if-if1-rs" class="headerlink" title="012 if&#x2F;if1.rs"></a>012 if&#x2F;if1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">bigger</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="comment">// Complete this function to return the bigger number!</span></span><br><span class="line">    <span class="comment">// Do not use:</span></span><br><span class="line">    <span class="comment">// ## another function call</span></span><br><span class="line">    <span class="comment">// ## additional variables</span></span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        a</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="013-if-if2-rs"><a href="#013-if-if2-rs" class="headerlink" title="013 if&#x2F;if2.rs"></a>013 if&#x2F;if2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">foo_if_fizz</span>(fizzish: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> fizzish == <span class="string">&quot;fizz&quot;</span> &#123;</span><br><span class="line">        <span class="string">&quot;foo&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> fizzish == <span class="string">&quot;fuzz&quot;</span> &#123;</span><br><span class="line">        <span class="string">&quot;bar&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">&quot;baz&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// No test changes needed!</span></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">foo_for_fizz</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">foo_if_fizz</span>(<span class="string">&quot;fizz&quot;</span>), <span class="string">&quot;foo&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">bar_for_fuzz</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">foo_if_fizz</span>(<span class="string">&quot;fuzz&quot;</span>), <span class="string">&quot;bar&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">default_to_baz</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">foo_if_fizz</span>(<span class="string">&quot;literally anything&quot;</span>), <span class="string">&quot;baz&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="014-if-if3-rs"><a href="#014-if-if3-rs" class="headerlink" title="014 if&#x2F;if3.rs"></a>014 if&#x2F;if3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">animal_habitat</span>(animal: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">identifier</span> = <span class="keyword">if</span> animal == <span class="string">&quot;crab&quot;</span> &#123;</span><br><span class="line">        <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> animal == <span class="string">&quot;gopher&quot;</span> &#123;</span><br><span class="line">        <span class="number">2</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> animal == <span class="string">&quot;snake&quot;</span> &#123;</span><br><span class="line">        <span class="number">3</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DO NOT CHANGE THIS STATEMENT BELOW</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">habitat</span> = <span class="keyword">if</span> identifier == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="string">&quot;Beach&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> identifier == <span class="number">2</span> &#123;</span><br><span class="line">        <span class="string">&quot;Burrow&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> identifier == <span class="number">3</span> &#123;</span><br><span class="line">        <span class="string">&quot;Desert&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    habitat</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">gopher_lives_in_burrow</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">animal_habitat</span>(<span class="string">&quot;gopher&quot;</span>), <span class="string">&quot;Burrow&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">snake_lives_in_desert</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">animal_habitat</span>(<span class="string">&quot;snake&quot;</span>), <span class="string">&quot;Desert&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">crab_lives_on_beach</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">animal_habitat</span>(<span class="string">&quot;crab&quot;</span>), <span class="string">&quot;Beach&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">unknown_animal</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">animal_habitat</span>(<span class="string">&quot;dinosaur&quot;</span>), <span class="string">&quot;Unknown&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>let identifier = if animal == &quot;crab&quot; &#123;</code><br>最外层是 let 语句，里层是 if 表达式，表达式可以成为语句的一部分。<br>这里的知识点是语句和表达式。</p>
<p>可以将Rust看作一切皆表达式。由于当分号后面什么都没有时自动补单元值（）的特点，可以将Rust中的语句看作计算结果均为（）的特殊表达式。而对于普通的表达式来说，则会得到正常的求值结果。</p>
<p>Rust 中的语法分为两大类： 语句 (statement) 和表达式 (Expression)。</p>
<p>语句：指的是要执行的一些操作和产生副作用的表达式。</p>
<p>表达式：主要用于计算求值。</p>
<p>Rust编译器在解析代码的时候，如果碰到分毫，就会继续往后面执行；如果碰断语句，则执行语句；如果碰到表达式，则会对表达式求值，如果分号后面什么都没有，就会补上单元值（）。</p>
<h2 id="015-quiz1-rs"><a href="#015-quiz1-rs" class="headerlink" title="015 quiz1.rs"></a>015 quiz1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_price_of_apples</span>(number: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> number &gt; <span class="number">40</span> &#123;</span><br><span class="line">        number * <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        number * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Don&#x27;t modify this function!</span></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">verify_test</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">price1</span> = <span class="title function_ invoke__">calculate_price_of_apples</span>(<span class="number">35</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">price2</span> = <span class="title function_ invoke__">calculate_price_of_apples</span>(<span class="number">40</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">price3</span> = <span class="title function_ invoke__">calculate_price_of_apples</span>(<span class="number">41</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">price4</span> = <span class="title function_ invoke__">calculate_price_of_apples</span>(<span class="number">65</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">70</span>, price1);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">80</span>, price2);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">41</span>, price3);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">65</span>, price4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="016-primitive-types-primitive-types1-rs"><a href="#016-primitive-types-primitive-types1-rs" class="headerlink" title="016 primitive_types&#x2F;primitive_types1.rs"></a>016 primitive_types&#x2F;primitive_types1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// Booleans (`bool`)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">is_morning</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> is_morning &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Good morning!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">is_evening</span> = <span class="literal">true</span>;<span class="comment">// Finish the rest of this line like the example! Or make it be false!</span></span><br><span class="line">    <span class="keyword">if</span> is_evening &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Good evening!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="017-primitive-types-primitive-types2-rs"><a href="#017-primitive-types-primitive-types2-rs" class="headerlink" title="017 primitive_types&#x2F;primitive_types2.rs"></a>017 primitive_types&#x2F;primitive_types2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// Characters (`char`)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Note the _single_ quotes, these are different from the double quotes</span></span><br><span class="line">    <span class="comment">// you&#x27;ve been seeing around.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_first_initial</span> = <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> my_first_initial.<span class="title function_ invoke__">is_alphabetic</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Alphabetical!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> my_first_initial.<span class="title function_ invoke__">is_numeric</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Numerical!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Neither alphabetic nor numeric!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">your_character</span> = <span class="string">&#x27;3&#x27;</span>; <span class="comment">// Finish this line like the example! What&#x27;s your favorite character?</span></span><br><span class="line">    <span class="comment">// Try a letter, try a number, try a special character, try a character</span></span><br><span class="line">    <span class="comment">// from a different language than your own, try an emoji!</span></span><br><span class="line">    <span class="keyword">if</span> your_character.<span class="title function_ invoke__">is_alphabetic</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Alphabetical!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> your_character.<span class="title function_ invoke__">is_numeric</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Numerical!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Neither alphabetic nor numeric!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字符的属性有 is_alphabetic &#x2F; is_numeric，所以 your_character 赋值要用引号 <code>your_character = &#39;3&#39;</code>。</p>
<h2 id="018-primitive-types-primitive-types3-rs"><a href="#018-primitive-types-primitive-types3-rs" class="headerlink" title="018 primitive_types&#x2F;primitive_types3.rs"></a>018 primitive_types&#x2F;primitive_types3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">0</span>;<span class="number">1000</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> a.<span class="title function_ invoke__">len</span>() &gt;= <span class="number">100</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Wow, that&#x27;s a big array!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Meh, I eat arrays like that for breakfast.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="019-primitive-types-primitive-types4-rs"><a href="#019-primitive-types-primitive-types4-rs" class="headerlink" title="019 primitive_types&#x2F;primitive_types4.rs"></a>019 primitive_types&#x2F;primitive_types4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">slice_out_of_array</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">nice_slice</span> = &amp;a[<span class="number">1</span>..<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], nice_slice)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切片这个名字往往出现在生物课上，我们做样本玻片的时候要从生物体上获取切片，以供在显微镜上观察。在 Rust 中，切片的意思大致也是这样，只不过它从数据取材引用。</p>
<p>$x..y$ 表示 $[x, y)$ 的数学含义。所以记忆时，就用 $[x,y-1]$.</p>
<h2 id="020-primitive-types-primitive-types5-rs"><a href="#020-primitive-types-primitive-types5-rs" class="headerlink" title="020 primitive_types&#x2F;primitive_types5.rs"></a>020 primitive_types&#x2F;primitive_types5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cat</span> = (<span class="string">&quot;Furry McFurson&quot;</span>, <span class="number">3.5</span>);</span><br><span class="line">    <span class="keyword">let</span> (name, age)= cat;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; is &#123;&#125; years old.&quot;</span>, name, age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>元组 tuple 是和数组对应一种类型，数组的元素相同，元组元素可以不同。</p>
<p>元组是由多种类型组合到一起形成的，因此它是复合类型，元组的长度是固定的，元组中元素的顺序也是固定的。</p>
<h2 id="021-primitive-types-primitive-types6-rs"><a href="#021-primitive-types-primitive-types6-rs" class="headerlink" title="021 primitive_types&#x2F;primitive_types6.rs"></a>021 primitive_types&#x2F;primitive_types6.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">indexing_tuple</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// Replace below ??? with the tuple indexing syntax.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second</span> = numbers.<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">2</span>, second,</span><br><span class="line">        <span class="string">&quot;This is not the 2nd number in the tuple!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过点访问元组。</p>
<p>接触过python的话，这里很好理解，rust的语法是各家的杂糅。</p>
<h2 id="022-vecs-vecs1-rs"><a href="#022-vecs-vecs1-rs" class="headerlink" title="022 vecs&#x2F;vecs1.rs"></a>022 vecs&#x2F;vecs1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">array_and_vec</span>() <span class="punctuation">-&gt;</span> ([<span class="type">i32</span>; <span class="number">4</span>], <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">41</span>]; <span class="comment">// a plain array</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>];<span class="comment">// <span class="doctag">TODO:</span> declare your vector here with the macro for vectors</span></span><br><span class="line"></span><br><span class="line">    (a, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_array_and_vec_similarity</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> (a, v) = <span class="title function_ invoke__">array_and_vec</span>();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(a, v[..]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>注意：这里一个 array 和 一个 vector 可以做比较。</p>
<h4 id="背景讲解：Vector-向量详解"><a href="#背景讲解：Vector-向量详解" class="headerlink" title="背景讲解：Vector 向量详解"></a>背景讲解：Vector 向量详解</h4><p>an array in Rust is stored on the stack (meaning it can’t grow or shrink, and the size needs to be known at compile time), and a Vector is stored in the heap (where these restrictions do not apply).</p>
<p>数组分配在栈上，长度固定。而 vecs 存储在堆上，是一种动态数组类型。</p>
<h4 id="一、Vector-的定义和创建"><a href="#一、Vector-的定义和创建" class="headerlink" title="一、Vector 的定义和创建"></a>一、Vector 的定义和创建</h4><p>在 Rust 中，可以使用 Vec<T> 来定义和创建一个 Vector，其中的 T 是 Vector 存储的元素类型。下面是一个示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let numbers: Vec&lt;i32&gt; = Vec::new();</span><br></pre></td></tr></table></figure>
<p>在上述示例中，我们创建了一个空的整数类型的 Vector，使用 Vec::new() 方法来初始化。<br>另一种创建 Vector 的方式是使用宏 vec!：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let numbers = vec![1, 2, 3, 4, 5];</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，我们使用 vec! 宏创建了一个包含 1 到 5 的整数的 Vector。</p>
<h4 id="二、Vector-的常用方法"><a href="#二、Vector-的常用方法" class="headerlink" title="二、Vector 的常用方法"></a>二、Vector 的常用方法</h4><p>Vector 提供了丰富的方法，用于操作和管理数组。下面是一些常用的方法：</p>
<ul>
<li>push(element: T)：向 Vector 的末尾添加一个元素。</li>
<li>pop()：移除并返回 Vector 的末尾元素。</li>
<li>get(index: usize) -&gt; Option&lt;&amp;T&gt;：根据索引获取 Vector 中的元素，返回一个 Option 类型的引用。</li>
<li>len() -&gt; usize：获取 Vector 的长度（元素个数）。</li>
<li>is_empty() -&gt; bool：判断 Vector 是否为空。</li>
<li>contains(&amp;item) -&gt; bool：判断 Vector 是否包含指定元素。</li>
<li>iter()：返回一个迭代器，用于遍历 Vector 中的元素。</li>
</ul>
<p>除了上述方法外，Vector 还提供了很多其他有用的方法，如排序、映射、过滤等，可以根据具体需求选择使用。</p>
<h4 id="三、Vector-的使用示例"><a href="#三、Vector-的使用示例" class="headerlink" title="三、Vector 的使用示例"></a>三、Vector 的使用示例</h4><p>下面通过一些示例代码来演示 Vector 的使用。</p>
<h5 id="示例一：向-Vector-添加和删除元素"><a href="#示例一：向-Vector-添加和删除元素" class="headerlink" title="示例一：向 Vector 添加和删除元素"></a>示例一：向 Vector 添加和删除元素</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">fruits</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    fruits.<span class="title function_ invoke__">push</span>(<span class="string">&quot;Apple&quot;</span>);</span><br><span class="line">    fruits.<span class="title function_ invoke__">push</span>(<span class="string">&quot;Banana&quot;</span>);</span><br><span class="line">    fruits.<span class="title function_ invoke__">push</span>(<span class="string">&quot;Orange&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Fruits: &#123;:?&#125;&quot;</span>, fruits);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">removed_fruit</span> = fruits.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Removed fruit: &#123;:?&#125;&quot;</span>, removed_fruit);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Fruits: &#123;:?&#125;&quot;</span>, fruits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，我们首先创建了一个空的 Vector fruits。然后，使用 push 方法向 Vector 添加三个水果。接着，使用 pop 方法移除 Vector 的末尾元素，并将其打印出来。</p>
<h5 id="示例二：遍历-Vector-中的元素"><a href="#示例二：遍历-Vector-中的元素" class="headerlink" title="示例二：遍历 Vector 中的元素"></a>示例二：遍历 Vector 中的元素</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">number</span> <span class="keyword">in</span> &amp;numbers &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Number: &#123;&#125;&quot;</span>, number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述示例中，我们创建了一个包含一些整数的 Vector numbers。使用 iter 方法返回的迭代器来遍历 Vector 中的元素，并将每个元素打印出来。</p>
<h5 id="示例三：使用索引访问-Vector-中的元素"><a href="#示例三：使用索引访问-Vector-中的元素" class="headerlink" title="示例三：使用索引访问 Vector 中的元素"></a>示例三：使用索引访问 Vector 中的元素</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(first_number) = numbers.<span class="title function_ invoke__">get</span>(<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;First number: &#123;&#125;&quot;</span>, first_number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(third_number) = numbers.<span class="title function_ invoke__">get</span>(<span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Third number: &#123;&#125;&quot;</span>, third_number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，我们使用 get 方法根据索引访问 Vector 中的元素。通过匹配 Option 类型的返回值，我们可以安全地访问 Vector 中的元素，并将其打印出来。</p>
<h2 id="023-vecs-vecs2-rs"><a href="#023-vecs-vecs2-rs" class="headerlink" title="023 vecs&#x2F;vecs2.rs"></a>023 vecs&#x2F;vecs2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Vec of even numbers is given. Your task is to complete the loop so that</span></span><br><span class="line"><span class="comment">// each number in the Vec is multiplied by 2.</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_loop</span>(<span class="keyword">mut</span> v: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">element</span> <span class="keyword">in</span> v.<span class="title function_ invoke__">iter_mut</span>() &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Fill this up so that each element in the Vec `v` is</span></span><br><span class="line">        <span class="comment">// multiplied by 2.</span></span><br><span class="line">        *element = *element * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// At this point, `v` should be equal to [4, 8, 12, 16, 20].</span></span><br><span class="line">    v</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_map</span>(v: &amp;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    v.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|element| &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Do the same thing as above ## but instead of mutating the</span></span><br><span class="line">        <span class="comment">// Vec, you can just return the new number!</span></span><br><span class="line">        element * <span class="number">2</span></span><br><span class="line">    &#125;).<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_vec_loop</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = (<span class="number">1</span>..).<span class="title function_ invoke__">filter</span>(|x| x % <span class="number">2</span> == <span class="number">0</span>).<span class="title function_ invoke__">take</span>(<span class="number">5</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ans</span> = <span class="title function_ invoke__">vec_loop</span>(v.<span class="title function_ invoke__">clone</span>());</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(ans, v.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|x| x * <span class="number">2</span>).collect::&lt;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_vec_map</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = (<span class="number">1</span>..).<span class="title function_ invoke__">filter</span>(|x| x % <span class="number">2</span> == <span class="number">0</span>).<span class="title function_ invoke__">take</span>(<span class="number">5</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ans</span> = <span class="title function_ invoke__">vec_map</span>(&amp;v);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(ans, v.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|x| x * <span class="number">2</span>).collect::&lt;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="背景讲解：迭代器"><a href="#背景讲解：迭代器" class="headerlink" title="背景讲解：迭代器"></a>背景讲解：迭代器</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/linysuccess/article/details/123967906">https://blog.csdn.net/linysuccess/article/details/123967906</a></p>
<p>如果我们需要一个获取 v1 所有权并返回拥有所有权的迭代器，则可以调用 into_iter 而不是 iter。类似的，如果我们希望迭代可变引用，则可以调用 iter_mut 而不是 iter。</p>
<p>第一个函数，体验迭代器：注意遍历可变引用时，需要使用 * 运算符来解引用指针以获取可变引用所指向的值，解引用之后才修改的是引用指向的实际值。</p>
<p>第二个函数体验闭包：闭包是一个编程特性。</p>
<p>下面的实现中，使用 v.iter() 方法创建一个<code>不可变的迭代器</code>，该迭代器会产生 &amp;i32 类型的元素引用。</p>
<p>然后，使用 .map() 方法对每个元素进行转换操作。.map() 方法接受一个闭包作为参数，该闭包定义了对每个元素执行的转换操作。在这里，闭包的输入参数是 element，表示迭代器产生的每个元素的引用。</p>
<p>在闭包体内部，我们将 element 乘以 2，并通过闭包体的最后一行作为返回值返回这个新的结果。最后，我们<code>使用 .collect() 方法收集迭代器产生的转换结果，并返回一个新的 Vec&lt;i32&gt; 类型的向量</code>。因此， vec_map 函数实现了对传入的向量中的每个元素进行乘以2的操作，并返回一个包含结果的新向量。原始向量 v 不会被修改。</p>
<blockquote>
<p>所有编译型语言都是数组快（但是有一些语言没有普通的数组，把 C++&#x2F;Rust 的 vec 叫做数组）。<br>数组是放在栈（stack）上的，Vec 是放在堆（heap）上的。栈访问比堆快很多。<br>所以如果是不可变长数组，且长度不是太大，肯定优先选栈上的数组。</p>
</blockquote>
<p>Rust通过单一所有权，将堆上内存管理与分配在栈上的所有者变量生命周期绑定，所有者离开作用域后堆内存也自动释放。</p>
<h2 id="024-move-semantics-move-semantics1-rs"><a href="#024-move-semantics-move-semantics1-rs" class="headerlink" title="024 move_semantics&#x2F;move_semantics1.rs"></a>024 move_semantics&#x2F;move_semantics1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vec0</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec1</span> = <span class="title function_ invoke__">fill_vec</span>(vec0);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125; content `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec1&quot;</span>, vec1.<span class="title function_ invoke__">len</span>(), vec1);</span><br><span class="line"></span><br><span class="line">    vec1.<span class="title function_ invoke__">push</span>(<span class="number">88</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125; content `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec1&quot;</span>, vec1.<span class="title function_ invoke__">len</span>(), vec1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fill_vec</span>(vec: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec</span> = vec;</span><br><span class="line"></span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">22</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">44</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">66</span>);</span><br><span class="line"></span><br><span class="line">    vec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="背景讲解：所有权和借用"><a href="#背景讲解：所有权和借用" class="headerlink" title="背景讲解：所有权和借用"></a>背景讲解：所有权和借用</h4><h5 id="clone-：复制-String-中堆上的数据，而不仅仅是栈上的数据，。"><a href="#clone-：复制-String-中堆上的数据，而不仅仅是栈上的数据，。" class="headerlink" title="clone()：复制 String 中堆上的数据，而不仅仅是栈上的数据，。"></a>clone()：复制 String 中堆上的数据，而不仅仅是栈上的数据，。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let s1 = String::from(&quot;hello&quot;);</span><br><span class="line">let s2 = s1.clone();</span><br><span class="line"></span><br><span class="line">println!(&quot;s1 = &#123;&#125;, s2 = &#123;&#125;&quot;, s1, s2);</span><br></pre></td></tr></table></figure>

<h5 id="把一个值-所有权-传来传去来使用它"><a href="#把一个值-所有权-传来传去来使用它" class="headerlink" title="把一个值(所有权)传来传去来使用它"></a>把一个值(所有权)传来传去来使用它</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let s2 = String::from(&quot;hello&quot;);     // s2 进入作用域</span><br><span class="line"></span><br><span class="line">let s3 = takes_and_gives_back(s2);  // s2 被移动到 takes_and_gives_back 中,</span><br><span class="line">                                    // 它也将返回值移给 s3</span><br></pre></td></tr></table></figure>

<p>总是把一个值(所有权)传来传去来使用它。传入一个函数，很可能还要从该函数传出去，结果就是语言表达变得非常啰嗦。</p>
<blockquote>
<p>现有的参考书，在这个地方讲得比较模糊。具体而言，一个值是如何传来传去使用，在堆上是如何表现的，并没有讲得很清楚。</p>
</blockquote>
<p>所有权的概念要从 k&#x3D;v 说起，k 有 v 的所有权。而所有权的传来传去，意思是</p>
<h5 id="引用和借用"><a href="#引用和借用" class="headerlink" title="引用和借用"></a>引用和借用</h5><p>rust 把其它语言里的指针称为 “引用和借用”，<code>*y</code> 称为 “解引用”。</p>
<p>就有了不变引用和可变引用。</p>
<blockquote>
<p>普通的传值与借用的区别，从图形上来讲，就是一级指针和二级指针的区别。为什么搞得这么复杂？</p>
</blockquote>
<h2 id="025-move-semantics-move-semantics2-rs"><a href="#025-move-semantics-move-semantics2-rs" class="headerlink" title="025 move_semantics&#x2F;move_semantics2.rs"></a>025 move_semantics&#x2F;move_semantics2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vec0</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec1</span> = <span class="title function_ invoke__">fill_vec</span>(vec0.<span class="title function_ invoke__">clone</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125;, with contents: `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec0&quot;</span>, vec0.<span class="title function_ invoke__">len</span>(), vec0);</span><br><span class="line"></span><br><span class="line">    vec1.<span class="title function_ invoke__">push</span>(<span class="number">88</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125;, with contents `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec1&quot;</span>, vec1.<span class="title function_ invoke__">len</span>(), vec1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fill_vec</span>(vec: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec</span> = vec;</span><br><span class="line"></span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">22</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">44</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">66</span>);</span><br><span class="line"></span><br><span class="line">    vec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这道题与上道题的区别在于 <code>let mut vec1 = fill_vec(vec0.clone());</code> 的下一行，是否还需要访问 vec0。</p>
<h2 id="026-move-semantics-move-semantics3-rs"><a href="#026-move-semantics-move-semantics3-rs" class="headerlink" title="026 move_semantics&#x2F;move_semantics3.rs"></a>026 move_semantics&#x2F;move_semantics3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vec0</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec1</span> = <span class="title function_ invoke__">fill_vec</span>(vec0);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125; content `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec1&quot;</span>, vec1.<span class="title function_ invoke__">len</span>(), vec1);</span><br><span class="line"></span><br><span class="line">    vec1.<span class="title function_ invoke__">push</span>(<span class="number">88</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125; content `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec1&quot;</span>, vec1.<span class="title function_ invoke__">len</span>(), vec1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fill_vec</span>(<span class="keyword">mut</span> vec: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">22</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">44</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">66</span>);</span><br><span class="line"></span><br><span class="line">    vec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从 <code>fn fill_vec(vec: Vec&lt;i32&gt;)</code> 改为 <code>fn fill_vec(mut vec: Vec&lt;i32&gt;)</code>。</p>
<p>move_semantics1.rs 与该题的区别在于 <code>fill_vec</code> ，前者在函数里用了一个新变量，后者直接在 vec 上修改。</p>
<h2 id="027-move-semantics-move-semantics4-rs"><a href="#027-move-semantics-move-semantics4-rs" class="headerlink" title="027 move_semantics&#x2F;move_semantics4.rs"></a>027 move_semantics&#x2F;move_semantics4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">//let vec0 = Vec::new();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec1</span> = <span class="title function_ invoke__">fill_vec</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125; content `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec1&quot;</span>, vec1.<span class="title function_ invoke__">len</span>(), vec1);</span><br><span class="line"></span><br><span class="line">    vec1.<span class="title function_ invoke__">push</span>(<span class="number">88</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; has length &#123;&#125; content `&#123;:?&#125;`&quot;</span>, <span class="string">&quot;vec1&quot;</span>, vec1.<span class="title function_ invoke__">len</span>(), vec1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `fill_vec()` no longer takes `vec: Vec&lt;i32&gt;` as argument</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fill_vec</span>() <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">22</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">44</span>);</span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">66</span>);</span><br><span class="line"></span><br><span class="line">    vec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把 fill_vec() 的参数去掉，去掉 vec0。</p>
<h2 id="028-move-semantics-move-semantics5-rs"><a href="#028-move-semantics-move-semantics5-rs" class="headerlink" title="028 move_semantics&#x2F;move_semantics5.rs"></a>028 move_semantics&#x2F;move_semantics5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    *y += <span class="number">100</span>;</span><br><span class="line">    *z += <span class="number">1000</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(x, <span class="number">1200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>变量x创建了两个可变引用y和z，不满足借用规则的第2条”在同一时刻一个值不能创建多个可变引用”。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    *y += <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    *z += <span class="number">1000</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(x, <span class="number">1200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="029-move-semantics-move-semantics6-rs"><a href="#029-move-semantics-move-semantics6-rs" class="headerlink" title="029 move_semantics&#x2F;move_semantics6.rs"></a>029 move_semantics&#x2F;move_semantics6.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">data</span> = <span class="string">&quot;Rust is great!&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">get_char</span>(&amp;data);<span class="comment">// 不获取所有权，只有使用权</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">string_uppercase</span>(data); <span class="comment">// 获取所有权</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Should not take ownership</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_char</span>(data: &amp;<span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">char</span> &#123;</span><br><span class="line">    data.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">last</span>().<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Should take ownership</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">string_uppercase</span>(<span class="keyword">mut</span> data: <span class="type">String</span>) &#123;</span><br><span class="line">    data = data.<span class="title function_ invoke__">to_uppercase</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看注释，一个要求 “不获取所有权，只有使用权”，一个要求 “获取所有权”。</p>
<p>参考：rust 所有权和借用</p>
<h2 id="030-structs-structs1-rs"><a href="#030-structs-structs1-rs" class="headerlink" title="030 structs&#x2F;structs1.rs"></a>030 structs&#x2F;structs1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ColorClassicStruct</span> &#123;</span><br><span class="line">    red: <span class="type">u64</span>,</span><br><span class="line">    green: <span class="type">u64</span>,</span><br><span class="line">    blue: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ColorTupleStruct</span>(<span class="type">u64</span>,<span class="type">u64</span>,<span class="type">u64</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UnitLikeStruct</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">classic_c_structs</span>() &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Instantiate a classic c struct!</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">green</span> = ColorClassicStruct&#123;</span><br><span class="line">            red: <span class="number">0</span>,</span><br><span class="line">            green: <span class="number">255</span>,</span><br><span class="line">            blue: <span class="number">0</span>,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(green.red, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(green.green, <span class="number">255</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(green.blue, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">tuple_structs</span>() &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Instantiate a tuple struct!</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">green</span> = <span class="title function_ invoke__">ColorTupleStruct</span>(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(green.<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(green.<span class="number">1</span>, <span class="number">255</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(green.<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">unit_structs</span>() &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Instantiate a unit-like struct!</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">unit_like_struct</span> = UnitLikeStruct;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">message</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;s are fun!&quot;</span>, unit_like_struct);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(message, <span class="string">&quot;UnitLikeStructs are fun!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="背景讲解："><a href="#背景讲解：" class="headerlink" title="背景讲解："></a>背景讲解：</h4><p>这里涉及了 3 种结构体的声明和定义。</p>
<ul>
<li><p>与元组（在第三章讨论过）类似的结构体，称为 元组结构体。</p>
</li>
<li><p>也可以定义一个没有任何字段的结构体！它们被称为 类单元结构体（unit-like structs），因为它们类似于 ()，即“元组类型”一节中提到的 unit 类型。类单元结构体常常在你想要在某个类型上实现 trait 但不需要在类型中存储数据的时候发挥作用。它适用于不关心属性而关心行为&#x2F;方法&#x2F;函数的时候。</p>
</li>
</ul>
<h2 id="031-structs-structs2-rs"><a href="#031-structs-structs2-rs" class="headerlink" title="031 structs&#x2F;structs2.rs"></a>031 structs&#x2F;structs2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    year: <span class="type">u32</span>,</span><br><span class="line">    made_by_phone: <span class="type">bool</span>,</span><br><span class="line">    made_by_mobile: <span class="type">bool</span>,</span><br><span class="line">    made_by_email: <span class="type">bool</span>,</span><br><span class="line">    item_number: <span class="type">u32</span>,</span><br><span class="line">    count: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">create_order_template</span>() <span class="punctuation">-&gt;</span> Order &#123;</span><br><span class="line">    Order &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Bob&quot;</span>),</span><br><span class="line">        year: <span class="number">2019</span>,</span><br><span class="line">        made_by_phone: <span class="literal">false</span>,</span><br><span class="line">        made_by_mobile: <span class="literal">false</span>,</span><br><span class="line">        made_by_email: <span class="literal">true</span>,</span><br><span class="line">        item_number: <span class="number">123</span>,</span><br><span class="line">        count: <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">your_order</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">order_template</span> = <span class="title function_ invoke__">create_order_template</span>();</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Create your own order using the update syntax and template above!</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">your_order</span> = Order &#123;</span><br><span class="line">            name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hacker in Rust&quot;</span>),</span><br><span class="line">            year: <span class="number">2019</span>,</span><br><span class="line">            made_by_phone: <span class="literal">false</span>,</span><br><span class="line">            made_by_mobile: <span class="literal">false</span>,</span><br><span class="line">            made_by_email: <span class="literal">true</span>,</span><br><span class="line">            item_number: <span class="number">123</span>,</span><br><span class="line">            count: <span class="number">1</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(your_order.name, <span class="string">&quot;Hacker in Rust&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(your_order.year, order_template.year);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(your_order.made_by_phone, order_template.made_by_phone);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(your_order.made_by_mobile, order_template.made_by_mobile);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(your_order.made_by_email, order_template.made_by_email);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(your_order.item_number, order_template.item_number);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(your_order.count, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>按测试用例引导即可。</p>
<h2 id="032-structs-structs3-rs"><a href="#032-structs-structs3-rs" class="headerlink" title="032 structs&#x2F;structs3.rs"></a>032 structs&#x2F;structs3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Package</span> &#123;</span><br><span class="line">    sender_country: <span class="type">String</span>,</span><br><span class="line">    recipient_country: <span class="type">String</span>,</span><br><span class="line">    weight_in_grams: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Package</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(sender_country: <span class="type">String</span>, recipient_country: <span class="type">String</span>, weight_in_grams: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> Package &#123;</span><br><span class="line">        <span class="keyword">if</span> weight_in_grams &lt;= <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;Can not ship a weightless package.&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Package &#123;</span><br><span class="line">                sender_country,</span><br><span class="line">                recipient_country,</span><br><span class="line">                weight_in_grams,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_international</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.sender_country != <span class="keyword">self</span>.recipient_country</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_fees</span>(&amp;<span class="keyword">self</span>, cents_per_gram: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.weight_in_grams * cents_per_gram</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[should_panic]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fail_creating_weightless_package</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">sender_country</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Spain&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">recipient_country</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Austria&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Package::<span class="title function_ invoke__">new</span>(sender_country, recipient_country, -<span class="number">2210</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_international_package</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">sender_country</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Spain&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">recipient_country</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Russia&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">package</span> = Package::<span class="title function_ invoke__">new</span>(sender_country, recipient_country, <span class="number">1200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(package.<span class="title function_ invoke__">is_international</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_local_package</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">sender_country</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Canada&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">recipient_country</span> = sender_country.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">package</span> = Package::<span class="title function_ invoke__">new</span>(sender_country, recipient_country, <span class="number">1200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(!package.<span class="title function_ invoke__">is_international</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">calculate_transport_fees</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">sender_country</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Spain&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">recipient_country</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Spain&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">cents_per_gram</span> = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">package</span> = Package::<span class="title function_ invoke__">new</span>(sender_country, recipient_country, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(package.<span class="title function_ invoke__">get_fees</span>(cents_per_gram), <span class="number">4500</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(package.<span class="title function_ invoke__">get_fees</span>(cents_per_gram * <span class="number">2</span>), <span class="number">9000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>self 是一个代表类型实例（或者是类型的引用或者是值）的关键字，在 Rust 的方法中使用 self 可以引用当前类型的实例或者类型本身。</p>
<p>具体来说，当我们定义一个方法时，使用 self 关键字作为方法的第一个参数可以让我们在调用该方法时直接访问类型实例本身。</p>
<h2 id="033-enums-enums1-rs"><a href="#033-enums-enums1-rs" class="headerlink" title="033 enums&#x2F;enums1.rs"></a>033 enums&#x2F;enums1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Echo,</span><br><span class="line">    Move,</span><br><span class="line">    ChangeColor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, Message::Quit);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, Message::Echo);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, Message::Move);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, Message::ChangeColor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="034-enums-enums2-rs"><a href="#034-enums-enums2-rs" class="headerlink" title="034 enums&#x2F;enums2.rs"></a>034 enums&#x2F;enums2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Echo</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">    Quit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">call</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, <span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">messages</span> = [</span><br><span class="line">        Message::Move &#123; x: <span class="number">10</span>, y: <span class="number">30</span> &#125;,</span><br><span class="line">        Message::<span class="title function_ invoke__">Echo</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello world&quot;</span>)),</span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(<span class="number">200</span>, <span class="number">255</span>, <span class="number">255</span>),</span><br><span class="line">        Message::Quit,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">message</span> <span class="keyword">in</span> &amp;messages &#123;</span><br><span class="line">        message.<span class="title function_ invoke__">call</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>任何类型的数据都可以放入枚举成员中 : 例如字符串、数值、结构体甚至另一个枚举。</p>
<p>Echo(String) 是元组型的枚举。</p>
<h2 id="035-enums-enums3-rs"><a href="#035-enums-enums3-rs" class="headerlink" title="035 enums&#x2F;enums3.rs"></a>035 enums&#x2F;enums3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">    <span class="title function_ invoke__">Echo</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">Move</span>(Point),</span><br><span class="line">    Quit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">u8</span>,</span><br><span class="line">    y: <span class="type">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    color: (<span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>),</span><br><span class="line">    position: Point,</span><br><span class="line">    quit: <span class="type">bool</span>,</span><br><span class="line">    message: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">change_color</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, color: (<span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>)) &#123;</span><br><span class="line">        <span class="keyword">self</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">quit</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.quit = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">echo</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, s: <span class="type">String</span>) &#123; <span class="keyword">self</span>.message = s &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">move_position</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, p: Point) &#123;</span><br><span class="line">        <span class="keyword">self</span>.position = p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">process</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, message: Message) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> create a match expression to process the different message variants</span></span><br><span class="line">        <span class="comment">// Remember: When passing a tuple as a function argument, you&#x27;ll need extra parentheses: fn function((t, u, p, l, e))</span></span><br><span class="line">        <span class="keyword">match</span> message &#123;</span><br><span class="line">            Message::<span class="title function_ invoke__">ChangeColor</span>(r,g,b)  =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">change_color</span>((r <span class="keyword">as</span> <span class="type">u8</span> ,g <span class="keyword">as</span> <span class="type">u8</span>,b <span class="keyword">as</span> <span class="type">u8</span>)),</span><br><span class="line">            Message::<span class="title function_ invoke__">Echo</span>(s) =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">echo</span>(s),</span><br><span class="line">            Message::<span class="title function_ invoke__">Move</span>(args) =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">move_position</span>(args),</span><br><span class="line">            Message::Quit =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">quit</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_match_message_call</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">state</span> = State &#123;</span><br><span class="line">            quit: <span class="literal">false</span>,</span><br><span class="line">            position: Point &#123; x: <span class="number">0</span>, y: <span class="number">0</span> &#125;,</span><br><span class="line">            color: (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">            message: <span class="string">&quot;hello world&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        &#125;;</span><br><span class="line">        state.<span class="title function_ invoke__">process</span>(Message::<span class="title function_ invoke__">ChangeColor</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br><span class="line">        state.<span class="title function_ invoke__">process</span>(Message::<span class="title function_ invoke__">Echo</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello world&quot;</span>)));</span><br><span class="line">        state.<span class="title function_ invoke__">process</span>(Message::<span class="title function_ invoke__">Move</span>(Point &#123; x: <span class="number">10</span>, y: <span class="number">15</span> &#125;));</span><br><span class="line">        state.<span class="title function_ invoke__">process</span>(Message::Quit);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(state.color, (<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(state.position.x, <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(state.position.y, <span class="number">15</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(state.quit, <span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(state.message, <span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>match 的出现是为了防止我们写太多的 if，那样就比较丑陋。</p>
<h2 id="036-strings-strings1-rs"><a href="#036-strings-strings1-rs" class="headerlink" title="036 strings&#x2F;strings1.rs"></a>036 strings&#x2F;strings1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">answer</span> = <span class="title function_ invoke__">current_favorite_color</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;My current favorite color is &#123;&#125;&quot;</span>, answer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">current_favorite_color</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="string">&quot;blue&quot;</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Rust 有两种字符串类型：str 和 String。其中 str 是 String 的切片类型，也就是说，str 类型的字符串值是 String 类型的字符串值的一部分或全部。</p>
<h4 id="1-先看-str："><a href="#1-先看-str：" class="headerlink" title="1. 先看 str："></a>1. 先看 str：</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;helloworld&quot;</span>;</span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码等价于：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="type">str</span> = <span class="string">&quot;helloworld&quot;</span>;</span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>“helloworld” 保存在 literal 块，它是一个类似于 text &#x2F; data &#x2F; bss 块。</p>
<p>stack 里的指针 s 指向 literal 块的 “helloworld”。</p>
<blockquote>
<p>str (stack) ——–&gt; “helloworld” (literal)</p>
</blockquote>
<h4 id="2-再看-string"><a href="#2-再看-string" class="headerlink" title="2. 再看 string"></a>2. 再看 string</h4><p>let s &#x3D; String::from(“hello”);</p>
<p>编译器将 “hello” 放在 literal 内存区，当程序运行到let s &#x3D; String::from()操作时，从字面量内存区将其拷贝到堆内存中。</p>
<blockquote>
<p>str (stack) ——–&gt; “helloworld” (literal)——–&gt; “helloworld” (heap)</p>
</blockquote>
<p>最终即为：</p>
<blockquote>
<p>str (stack) ——–&gt; “helloworld” (heap)</p>
</blockquote>
<h2 id="037-strings-strings2-rs"><a href="#037-strings-strings2-rs" class="headerlink" title="037 strings&#x2F;strings2.rs"></a>037 strings&#x2F;strings2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;green&quot;</span>); <span class="comment">// Try not changing this line :)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_ invoke__">is_a_color_word</span>(&amp;word) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;That is a color word I know!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;That is not a color word I know.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">is_a_color_word</span>(attempt: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    attempt == <span class="string">&quot;green&quot;</span> || attempt == <span class="string">&quot;blue&quot;</span> || attempt == <span class="string">&quot;red&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="038-strings-strings3-rs"><a href="#038-strings-strings3-rs" class="headerlink" title="038 strings&#x2F;strings3.rs"></a>038 strings&#x2F;strings3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">trim_me</span>(input: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Remove whitespace from both ends of a string!</span></span><br><span class="line">    input.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">compose_me</span>(input: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Add &quot; world!&quot; to the string! There&#x27;s multiple ways to do this!</span></span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125; world!&quot;</span>, input)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">replace_me</span>(input: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Replace &quot;cars&quot; in the string with &quot;balloons&quot;!</span></span><br><span class="line">    input.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;cars&quot;</span>, <span class="string">&quot;balloons&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">trim_a_string</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">trim_me</span>(<span class="string">&quot;Hello!     &quot;</span>), <span class="string">&quot;Hello!&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">trim_me</span>(<span class="string">&quot;  What&#x27;s up!&quot;</span>), <span class="string">&quot;What&#x27;s up!&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">trim_me</span>(<span class="string">&quot;   Hola!  &quot;</span>), <span class="string">&quot;Hola!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">compose_a_string</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">compose_me</span>(<span class="string">&quot;Hello&quot;</span>), <span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">compose_me</span>(<span class="string">&quot;Goodbye&quot;</span>), <span class="string">&quot;Goodbye world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">replace_a_string</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">replace_me</span>(<span class="string">&quot;I think cars are cool&quot;</span>), <span class="string">&quot;I think balloons are cool&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">replace_me</span>(<span class="string">&quot;I love to look at cars&quot;</span>), <span class="string">&quot;I love to look at balloons&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>有点不理解，assert_eq 的第一个参数是 string, 第二个参数都是 str 类型，怎么能比较？</p>
</blockquote>
<h2 id="039-strings-strings4-rs"><a href="#039-strings-strings4-rs" class="headerlink" title="039 strings&#x2F;strings4.rs"></a>039 strings&#x2F;strings4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ok, here are a bunch of values-## some are `String`s, some are `&amp;str`s.</span></span><br><span class="line"><span class="comment">// Your task is to call one of these two functions on each value depending on what</span></span><br><span class="line"><span class="comment">// you think each value is. That is, add either `string_slice` or `string`</span></span><br><span class="line"><span class="comment">// before the parentheses on each line.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">string_slice</span>(arg: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, arg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">string</span>(arg: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">string_slice</span>(<span class="string">&quot;blue&quot;</span>);           <span class="comment">// str</span></span><br><span class="line">    <span class="title function_ invoke__">string</span>(<span class="string">&quot;red&quot;</span>.<span class="title function_ invoke__">to_string</span>());      <span class="comment">// String</span></span><br><span class="line">    <span class="title function_ invoke__">string</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>));     <span class="comment">// String</span></span><br><span class="line">    <span class="title function_ invoke__">string</span>(<span class="string">&quot;rust is fun!&quot;</span>.<span class="title function_ invoke__">to_owned</span>());</span><br><span class="line">    <span class="title function_ invoke__">string_slice</span>(<span class="string">&quot;nice weather&quot;</span>.<span class="title function_ invoke__">into</span>());</span><br><span class="line">    <span class="title function_ invoke__">string</span>(<span class="built_in">format!</span>(<span class="string">&quot;Interpolation &#123;&#125;&quot;</span>, <span class="string">&quot;Station&quot;</span>));     <span class="comment">//str</span></span><br><span class="line">    <span class="title function_ invoke__">string_slice</span>(&amp;<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>)[<span class="number">0</span>..<span class="number">1</span>]);           <span class="comment">//str</span></span><br><span class="line">    <span class="title function_ invoke__">string_slice</span>(<span class="string">&quot;  hello there &quot;</span>.<span class="title function_ invoke__">trim</span>());              <span class="comment">//str</span></span><br><span class="line">    <span class="title function_ invoke__">string</span>(<span class="string">&quot;Happy Monday!&quot;</span>.<span class="title function_ invoke__">to_string</span>().<span class="title function_ invoke__">replace</span>(<span class="string">&quot;Mon&quot;</span>, <span class="string">&quot;Tues&quot;</span>)); <span class="comment">//String</span></span><br><span class="line">    <span class="title function_ invoke__">string</span>(<span class="string">&quot;mY sHiFt KeY iS sTiCkY&quot;</span>.<span class="title function_ invoke__">to_lowercase</span>());    <span class="comment">// str</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下都是 string 类型，值得注意的地方是 trim 返回的是 &amp;tr 类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s.to_owned()</span><br><span class="line">s.to_string()</span><br><span class="line">s.into()</span><br><span class="line">String::from(s)</span><br><span class="line">format</span><br></pre></td></tr></table></figure>


<h2 id="040-modules-modules1-rs"><a href="#040-modules-modules1-rs" class="headerlink" title="040 modules&#x2F;modules1.rs"></a>040 modules&#x2F;modules1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> sausage_factory &#123;</span><br><span class="line">    <span class="comment">// Don&#x27;t let anybody outside of this module see this!</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_secret_recipe</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Ginger&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">make_sausage</span>() &#123;</span><br><span class="line">        <span class="title function_ invoke__">get_secret_recipe</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;sausage!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    sausage_factory::<span class="title function_ invoke__">make_sausage</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>crate 分成二进制 crate 和包 crate。cargo new my-project 创建了一个名为 my-project 的二进制 Crate。</li>
<li>mod 与 namespace 相似，mod 与 mod 之前互相隔离。</li>
<li>路径：mod 层级系统与文件系统比较类似，比如 &#x2F;a&#x2F;b&#x2F;c 对应于 crate::a::b::c，其中 crate 相当于 &#x2F;。</li>
</ul>
<h2 id="041-modules-modules2-rs"><a href="#041-modules-modules2-rs" class="headerlink" title="041 modules&#x2F;modules2.rs"></a>041 modules&#x2F;modules2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> delicious_snacks &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Fix these use statements</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">use</span> self::fruits::PEAR <span class="keyword">as</span> fruit;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">use</span> self::veggies::CUCUMBER <span class="keyword">as</span> veggie;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mod</span> fruits &#123;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">const</span> PEAR: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;Pear&quot;</span>;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">const</span> APPLE: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;Apple&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mod</span> veggies &#123;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">const</span> CUCUMBER: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;Cucumber&quot;</span>;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">const</span> CARROT: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;Carrot&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;favorite snacks: &#123;&#125; and &#123;&#125;&quot;</span>,</span><br><span class="line">        delicious_snacks::fruit,</span><br><span class="line">        delicious_snacks::veggie</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>use 就是其它语言的 import，as 就是一个别名。</p>
<h2 id="042-modules-modules3-rs"><a href="#042-modules-modules3-rs" class="headerlink" title="042 modules&#x2F;modules3.rs"></a>042 modules&#x2F;modules3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::time::SystemTime;</span><br><span class="line"><span class="keyword">use</span> std::time::UNIX_EPOCH;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">match</span> SystemTime::<span class="title function_ invoke__">now</span>().<span class="title function_ invoke__">duration_since</span>(UNIX_EPOCH) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(n) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;1970-01-01 00:00:00 UTC was &#123;&#125; seconds ago!&quot;</span>, n.<span class="title function_ invoke__">as_secs</span>()),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(_) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;SystemTime before UNIX EPOCH!&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>use 就是其它语言的 import。</p>
<h2 id="043-hashmaps-hashmaps1-rs"><a href="#043-hashmaps-hashmaps1-rs" class="headerlink" title="043 hashmaps&#x2F;hashmaps1.rs"></a>043 hashmaps&#x2F;hashmaps1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fruit_basket</span>() <span class="punctuation">-&gt;</span> HashMap&lt;<span class="type">String</span>, <span class="type">u32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">basket</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Put more fruits in your basket here.</span></span><br><span class="line">    basket.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;banana&quot;</span>), <span class="number">2</span>);</span><br><span class="line">    basket.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;apple&quot;</span>), <span class="number">3</span>);</span><br><span class="line">    basket.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;mango&quot;</span>), <span class="number">4</span>);</span><br><span class="line">    basket</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="044-hashmaps-hashmaps2-rs"><a href="#044-hashmaps-hashmaps2-rs" class="headerlink" title="044 hashmaps&#x2F;hashmaps2.rs"></a>044 hashmaps&#x2F;hashmaps2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">fruit</span> <span class="keyword">in</span> fruit_kinds &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Insert new fruits if they are not already present in the</span></span><br><span class="line">    <span class="comment">// basket. Note that you are not allowed to put any type of fruit that&#x27;s</span></span><br><span class="line">    <span class="comment">// already present!</span></span><br><span class="line">    <span class="comment">// 查询Yellow对应的值，若不存在则插入新值</span></span><br><span class="line">    basket.<span class="title function_ invoke__">entry</span>(fruit).<span class="title function_ invoke__">or_insert</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> <span class="variable">fruit</span> <span class="keyword">in</span> fruit_kinds &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Put new fruits if not already present. Note that you</span></span><br><span class="line">    <span class="comment">// are not allowed to put any type of fruit that&#x27;s already</span></span><br><span class="line">    <span class="comment">// present!</span></span><br><span class="line">    <span class="keyword">if</span> !basket.<span class="title function_ invoke__">contains_key</span>(&amp;fruit) &#123;</span><br><span class="line">        basket.<span class="title function_ invoke__">insert</span>(fruit, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="045-hashmaps-hashmaps3-rs"><a href="#045-hashmaps-hashmaps3-rs" class="headerlink" title="045 hashmaps&#x2F;hashmaps3.rs"></a>045 hashmaps&#x2F;hashmaps3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A structure to store the goal details of a team.</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Team</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    goals_scored: <span class="type">u8</span>,</span><br><span class="line">    goals_conceded: <span class="type">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">build_scores_table</span>(results: <span class="type">String</span>) <span class="punctuation">-&gt;</span> HashMap&lt;<span class="type">String</span>, Team&gt; &#123;</span><br><span class="line">    <span class="comment">// The name of the team is the key and its associated struct is the value.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span>: HashMap&lt;<span class="type">String</span>, Team&gt; = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">r</span> <span class="keyword">in</span> results.<span class="title function_ invoke__">lines</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;&amp;<span class="type">str</span>&gt; = r.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;,&#x27;</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team_1_name</span> = v[<span class="number">0</span>].<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team_1_score</span>: <span class="type">u8</span> = v[<span class="number">2</span>].<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team_2_name</span> = v[<span class="number">1</span>].<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team_2_score</span>: <span class="type">u8</span> = v[<span class="number">3</span>].<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Populate the scores table with details extracted from the</span></span><br><span class="line">        <span class="comment">// current line. Keep in mind that goals scored by team_1</span></span><br><span class="line">        <span class="comment">// will be the number of goals conceded from team_2, and similarly</span></span><br><span class="line">        <span class="comment">// goals scored by team_2 will be the number of goals conceded by</span></span><br><span class="line">        <span class="comment">// team_1.</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team_1</span> = scores.<span class="title function_ invoke__">entry</span>(team_1_name).<span class="title function_ invoke__">or_insert</span>(</span><br><span class="line">            Team &#123;</span><br><span class="line">                goals_scored: <span class="number">0</span>,</span><br><span class="line">                goals_conceded: <span class="number">0</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        team_1.goals_scored += team_1_score;</span><br><span class="line">        team_1.goals_conceded += team_2_score;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the team 2 score</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team_2</span> = scores.<span class="title function_ invoke__">entry</span>(team_2_name.<span class="title function_ invoke__">clone</span>()).<span class="title function_ invoke__">or_insert</span>(Team &#123;</span><br><span class="line">            goals_scored: <span class="number">0</span>,</span><br><span class="line">            goals_conceded: <span class="number">0</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        team_2.goals_scored += team_2_score;</span><br><span class="line">        team_2.goals_conceded += team_1_score;</span><br><span class="line">    &#125;</span><br><span class="line">    scores</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_results</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">results</span> = <span class="string">&quot;&quot;</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">            + <span class="string">&quot;England,France,4,2\n&quot;</span></span><br><span class="line">            + <span class="string">&quot;France,Italy,3,1\n&quot;</span></span><br><span class="line">            + <span class="string">&quot;Poland,Spain,2,0\n&quot;</span></span><br><span class="line">            + <span class="string">&quot;Germany,England,2,1\n&quot;</span>;</span><br><span class="line">        results</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_scores</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">scores</span> = <span class="title function_ invoke__">build_scores_table</span>(<span class="title function_ invoke__">get_results</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">keys</span>: <span class="type">Vec</span>&lt;&amp;<span class="type">String</span>&gt; = scores.<span class="title function_ invoke__">keys</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">        keys.<span class="title function_ invoke__">sort</span>();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            keys,</span><br><span class="line">            <span class="built_in">vec!</span>[<span class="string">&quot;England&quot;</span>, <span class="string">&quot;France&quot;</span>, <span class="string">&quot;Germany&quot;</span>, <span class="string">&quot;Italy&quot;</span>, <span class="string">&quot;Poland&quot;</span>, <span class="string">&quot;Spain&quot;</span>]</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">validate_team_score_1</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">scores</span> = <span class="title function_ invoke__">build_scores_table</span>(<span class="title function_ invoke__">get_results</span>());</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team</span> = scores.<span class="title function_ invoke__">get</span>(<span class="string">&quot;England&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(team.goals_scored, <span class="number">5</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(team.goals_conceded, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">validate_team_score_2</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">scores</span> = <span class="title function_ invoke__">build_scores_table</span>(<span class="title function_ invoke__">get_results</span>());</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">team</span> = scores.<span class="title function_ invoke__">get</span>(<span class="string">&quot;Spain&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(team.goals_scored, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(team.goals_conceded, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>u8.parse().unwrap() 查一下。</p>
</blockquote>
<blockquote>
<p>let v: Vec&lt;&amp;str&gt; &#x3D; r.split(‘,’).collect();<br>查一下。</p>
</blockquote>
<h2 id="046-quiz2-rs"><a href="#046-quiz2-rs" class="headerlink" title="046 quiz2.rs"></a>046 quiz2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is a quiz for the following sections:</span></span><br><span class="line"><span class="comment">// ## Strings</span></span><br><span class="line"><span class="comment">// ## Vecs</span></span><br><span class="line"><span class="comment">// ## Move semantics</span></span><br><span class="line"><span class="comment">// ## Modules</span></span><br><span class="line"><span class="comment">// ## Enums</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Let&#x27;s build a little machine in the form of a function.</span></span><br><span class="line"><span class="comment">// As input, we&#x27;re going to give a list of strings and commands.</span></span><br><span class="line"><span class="comment">// These commands determine what action is going to be applied to the string.</span></span><br><span class="line"><span class="comment">// It can either be:</span></span><br><span class="line"><span class="comment">// ## Uppercase the string</span></span><br><span class="line"><span class="comment">// ## Trim the string</span></span><br><span class="line"><span class="comment">// ## Append &quot;bar&quot; to the string a specified amount of times The exact form of this will be:</span></span><br><span class="line">        <span class="comment">// ## The input is going to be a Vector of a 2-length tuple,</span></span><br><span class="line">        <span class="comment">//   the first element is the string, the second one is the command.</span></span><br><span class="line">        <span class="comment">// ## The output element is going to be a Vector of strings.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    Uppercase,</span><br><span class="line">    Trim,</span><br><span class="line">    <span class="title function_ invoke__">Append</span>(<span class="type">usize</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> my_module &#123;</span><br><span class="line">    <span class="keyword">use</span> super::Command;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Complete the function signature!</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">transformer</span>(input: <span class="type">Vec</span>&lt;(<span class="type">String</span>, Command)&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Complete the output declaration!</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">output</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = <span class="built_in">vec!</span>[];</span><br><span class="line">        <span class="keyword">for</span> (string, command) <span class="keyword">in</span> input.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            <span class="keyword">match</span> command &#123;</span><br><span class="line">                Command::Uppercase =&gt; &#123;</span><br><span class="line">                    output.<span class="title function_ invoke__">push</span>(string.<span class="title function_ invoke__">to_uppercase</span>());</span><br><span class="line">                &#125;</span><br><span class="line">                Command::Trim =&gt; &#123;</span><br><span class="line">                    output.<span class="title function_ invoke__">push</span>(string.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">to_string</span>());</span><br><span class="line">                &#125;</span><br><span class="line">                Command::<span class="title function_ invoke__">Append</span>(<span class="type">usize</span>) =&gt;&#123;</span><br><span class="line">                    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ans</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">                    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..*<span class="type">usize</span> &#123;</span><br><span class="line">                        ans += &amp;string.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                    output.<span class="title function_ invoke__">push</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;bar&quot;</span>, ans));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        output</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> What do we need to import to have `transformer` in scope?</span></span><br><span class="line">    <span class="keyword">use</span> crate::my_module::transformer;</span><br><span class="line">    <span class="keyword">use</span> super::Command;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_works</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">output</span> = <span class="title function_ invoke__">transformer</span>(<span class="built_in">vec!</span>[</span><br><span class="line">            (<span class="string">&quot;hello&quot;</span>.<span class="title function_ invoke__">into</span>(), Command::Uppercase),</span><br><span class="line">            (<span class="string">&quot; all roads lead to rome! &quot;</span>.<span class="title function_ invoke__">into</span>(), Command::Trim),</span><br><span class="line">            (<span class="string">&quot;foo&quot;</span>.<span class="title function_ invoke__">into</span>(), Command::<span class="title function_ invoke__">Append</span>(<span class="number">1</span>)),</span><br><span class="line">            (<span class="string">&quot;bar&quot;</span>.<span class="title function_ invoke__">into</span>(), Command::<span class="title function_ invoke__">Append</span>(<span class="number">5</span>)),</span><br><span class="line">        ]);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(output[<span class="number">0</span>], <span class="string">&quot;HELLO&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(output[<span class="number">1</span>], <span class="string">&quot;all roads lead to rome!&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(output[<span class="number">2</span>], <span class="string">&quot;foobar&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(output[<span class="number">3</span>], <span class="string">&quot;barbarbarbarbarbar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="047-options-options1-rs"><a href="#047-options-options1-rs" class="headerlink" title="047 options&#x2F;options1.rs"></a>047 options&#x2F;options1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">maybe_icecream</span>(time_of_day: <span class="type">u16</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">u16</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// We use the 24-hour system here, so 10PM is a value of 22</span></span><br><span class="line">    <span class="comment">// and 12AM is a value of 0</span></span><br><span class="line">    <span class="comment">// The Option output should gracefully handle cases where time_of_day &gt; 23.</span></span><br><span class="line">    <span class="comment">// remember to return an Option!</span></span><br><span class="line">    <span class="keyword">if</span> time_of_day &gt; <span class="number">24</span> &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> time_of_day &lt;= <span class="number">12</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">5</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">check_icecream</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">maybe_icecream</span>(<span class="number">9</span>), <span class="title function_ invoke__">Some</span>(<span class="number">5</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">maybe_icecream</span>(<span class="number">10</span>), <span class="title function_ invoke__">Some</span>(<span class="number">5</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">maybe_icecream</span>(<span class="number">23</span>), <span class="title function_ invoke__">Some</span>(<span class="number">0</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">maybe_icecream</span>(<span class="number">22</span>), <span class="title function_ invoke__">Some</span>(<span class="number">0</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">maybe_icecream</span>(<span class="number">25</span>), <span class="literal">None</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">raw_value</span>() &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Fix this test. How do you get at the value contained in the</span></span><br><span class="line">        <span class="comment">// Option?</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">icecreams</span> = <span class="title function_ invoke__">maybe_icecream</span>(<span class="number">12</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(icecreams, <span class="title function_ invoke__">Some</span>(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>option 的出现是为了应对空指针。</p>
<blockquote>
<p>Some() 是个什么东西？</p>
</blockquote>
<h4 id="背景讲解：Option"><a href="#背景讲解：Option" class="headerlink" title="背景讲解：Option"></a>背景讲解：Option</h4><p>Option 是Rust中核心的枚举类型，它表示一个值可能存在，也可能不存在的情况。其提出是为了让空值得到有效的处理。任何可能为空值的结果都应被处理为Option。</p>
<p>Option 的枚举情况有两种，分别是代表有的Some()和代表无的 None。</p>
<p>Option 本质上是一个枚举，有两种分别是Some 和 None。Some 代表有值，None 则类似于 null，代表无值。</p>
<p>在 Option 类型中，”some” 表示某个具体的值存在，它的语法格式为 Some(value)，其中 value 是具体的值。</p>
<p>使用 unwrap<br>如果我们确定 Option 中一定存在值，可以使用 unwrap 方法来获取该值。如果 Option 中不存在值，则会触发 panic。<br>rust复制代码let some_value: Option<i32> &#x3D; Some(5);</p>
<p>let value &#x3D; some_value.unwrap();<br>println!(“The value is {}”, value);</p>
<h2 id="048-options-options2-rs"><a href="#048-options-options2-rs" class="headerlink" title="048 options&#x2F;options2.rs"></a>048 options&#x2F;options2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">simple_option</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">target</span> = <span class="string">&quot;rustlings&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">optional_target</span> = <span class="title function_ invoke__">Some</span>(target);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Make this an if let statement whose value is &quot;Some&quot; type</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(word) = optional_target &#123;</span><br><span class="line">            <span class="built_in">assert_eq!</span>(word, target);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">layered_option</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">range</span> = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">optional_integers</span>: <span class="type">Vec</span>&lt;<span class="type">Option</span>&lt;<span class="type">i8</span>&gt;&gt; = <span class="built_in">vec!</span>[<span class="literal">None</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1, 2, 3, 4 ...</span></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..(range + <span class="number">1</span>) &#123;</span><br><span class="line">            optional_integers.<span class="title function_ invoke__">push</span>(<span class="title function_ invoke__">Some</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">cursor</span> = range;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> make this a while let statement ## remember that vector.pop also</span></span><br><span class="line">        <span class="comment">// adds another layer of Option&lt;T&gt;. You can stack `Option&lt;T&gt;`s into</span></span><br><span class="line">        <span class="comment">// while let and if let.</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="title function_ invoke__">Some</span>(integer)) = optional_integers.<span class="title function_ invoke__">pop</span>() &#123;</span><br><span class="line">            <span class="built_in">assert_eq!</span>(integer, cursor);</span><br><span class="line">            cursor -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(cursor, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pop() -&gt; option<T></p>
<p>调用 pop 方法时，它会从数组的末尾移除一个元素。并且 pop 的返回值会套上 Option<T>。</p>
<p>因此，上例类型是 Vec&lt;Option<i8>&gt;，所以 pop 方法返回的类型是 Option&lt;Option<i8>&gt;。</p>
<h2 id="049-options-options3-rs"><a href="#049-options-options3-rs" class="headerlink" title="049 options&#x2F;options3.rs"></a>049 options&#x2F;options3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">Option</span>&lt;Point&gt; = <span class="title function_ invoke__">Some</span>(Point &#123; x: <span class="number">100</span>, y: <span class="number">200</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> y &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="keyword">ref</span> p) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Co-ordinates are &#123;&#125;,&#123;&#125; &quot;</span>, p.x, p.y),</span><br><span class="line">        _ =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;no match!&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    y; <span class="comment">// Fix without deleting this line.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再取Option里面的结构体的时候,我们需要知道,结构体在option里面,所有权是归Option值的,后面又访问了一次Option值,所以说y还没有放弃所有权,只能通过引用去访问。( y没有放弃所有权,里面的结构体也是属于y的,y&#x3D; Some(p)来取数据是不对的 )</p>
<blockquote>
<p>用 <code>ref p</code> 这种形式引用，比较奇怪，为什么不用 <code>&amp;</code>?</p>
</blockquote>
<h2 id="050-error-handling-errors1-rs"><a href="#050-error-handling-errors1-rs" class="headerlink" title="050 error_handling&#x2F;errors1.rs"></a>050 error_handling&#x2F;errors1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">generate_nametag_text</span>(name: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> name.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">        <span class="comment">// Empty names aren&#x27;t allowed.</span></span><br><span class="line">        <span class="title function_ invoke__">Err</span>(<span class="string">&quot;`name` was empty; it must be nonempty.&quot;</span>.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(<span class="built_in">format!</span>(<span class="string">&quot;Hi! My name is &#123;&#125;&quot;</span>, name))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">generates_nametag_text_for_a_nonempty_name</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="title function_ invoke__">generate_nametag_text</span>(<span class="string">&quot;Beyoncé&quot;</span>.<span class="title function_ invoke__">into</span>()),</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(<span class="string">&quot;Hi! My name is Beyoncé&quot;</span>.<span class="title function_ invoke__">into</span>())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">explains_why_generating_nametag_text_fails</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="title function_ invoke__">generate_nametag_text</span>(<span class="string">&quot;&quot;</span>.<span class="title function_ invoke__">into</span>()),</span><br><span class="line">            <span class="comment">// Don&#x27;t change this line</span></span><br><span class="line">            <span class="title function_ invoke__">Err</span>(<span class="string">&quot;`name` was empty; it must be nonempty.&quot;</span>.<span class="title function_ invoke__">into</span>())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="背景讲解：-From-和-Into"><a href="#背景讲解：-From-和-Into" class="headerlink" title="背景讲解： From 和 Into"></a>背景讲解： From 和 Into</h4><p>From 和 Into 两个 trait 是内部相关联的，实际上这是它们实现的一部分。如果我们能够从类型 B 得到类型 A，那么很容易相信我们也能够把类型 B 转换为类型 A。</p>
<p>From trait 允许一种类型定义 “怎么根据另一种类型生成自己”，<br>String::from(str); 根据 str 生成 string。</p>
<p>Into trait 就是把 From trait 倒过来而已。</p>
<h4 id="背景讲解：-Result"><a href="#背景讲解：-Result" class="headerlink" title="背景讲解： Result"></a>背景讲解： Result</h4><p>Rust对可靠性的执着也延伸到了错误处理。在很多情况下，Rust 要求你承认出错的可能性，并在编译代码之前就采取行动。这些要求使得程序更为健壮。Rust将错误组合为两个主要类别：可恢复错误和不可恢复错误。大部分语言并不区分这两类错误，并采用类似异常这样方式统一处理他们。Rust并没有异常，但是，有可恢复错误 Result&lt;T, E&gt;，和不可恢复(遇到错误时停止程序执行)错误panic!。</p>
<p>panic!前面已经接触过，但大多数错误并没有严重到需要程序完全停止执行。</p>
<p>我们先来说说题目中的那个option是怎么回事。</p>
<p>Option是标准库定义的一个枚举，它编码了一个常见的情况：一个值要么有值要么没值。Rust并没有空值，不过它确实拥有一个可以编码存在或不存在概念的枚举。这个枚举就是Option。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum Option&lt;T&gt; &#123;</span><br><span class="line">    Some(T),</span><br><span class="line">    None,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>泛型参数使得它可以包含任意类型的数据。我们现在知道它和错误处理没什么关系。对于可恢复错误，标准库也有一个枚举，Result。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum Result&lt;T, E&gt; &#123;</span><br><span class="line">    Ok(T),</span><br><span class="line">    Err(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>T表示成功时返回的Ok成员中的数据类型，E代表失败时返回的Err成员中的错误类型。所以我们修改程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">pub fn generate_nametag_text(name: String) -&gt; Result&lt;String, String&gt; &#123;</span><br><span class="line">    if name.len() &gt; 0 &#123;</span><br><span class="line">        Ok(format!(&quot;Hi! My name is &#123;&#125;&quot;, name))</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Empty names aren&#x27;t allowed.</span><br><span class="line">        //None</span><br><span class="line">        Err(&quot;`name` was empty; it must be nonempty.&quot;.to_string())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    // This test passes initially if you comment out the 2nd test.</span><br><span class="line">    // You&#x27;ll need to update what this test expects when you change</span><br><span class="line">    // the function under test!</span><br><span class="line">    #[test]</span><br><span class="line">    fn generates_nametag_text_for_a_nonempty_name() &#123;</span><br><span class="line">        assert_eq!(</span><br><span class="line">            generate_nametag_text(&quot;Beyoncé&quot;.into()),</span><br><span class="line">            Ok(&quot;Hi! My name is Beyoncé&quot;.into())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn explains_why_generating_nametag_text_fails() &#123;</span><br><span class="line">        assert_eq!(</span><br><span class="line">            generate_nametag_text(&quot;&quot;.into()),</span><br><span class="line">            Err(&quot;`name` was empty; it must be nonempty.&quot;.into())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就能通过了，</p>
<h2 id="051-error-handling-errors2-rs"><a href="#051-error-handling-errors2-rs" class="headerlink" title="051 error_handling&#x2F;errors2.rs"></a>051 error_handling&#x2F;errors2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">total_cost</span>(item_quantity: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">processing_fee</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cost_per_item</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">qty</span> = item_quantity.parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(qty * cost_per_item + processing_fee)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">item_quantity_is_a_valid_number</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">total_cost</span>(<span class="string">&quot;34&quot;</span>), <span class="title function_ invoke__">Ok</span>(<span class="number">171</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">item_quantity_is_an_invalid_number</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="title function_ invoke__">total_cost</span>(<span class="string">&quot;beep boop&quot;</span>).<span class="title function_ invoke__">unwrap_err</span>().<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            <span class="string">&quot;invalid digit found in string&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>total_cost(&quot;beep boop&quot;).unwrap_err().to_string()</code> 这种形式还待查一下。</p>
</blockquote>
<blockquote>
<p><code>let qty = item_quantity.parse::&lt;i32&gt;()?; 后面这个 </code> <code>?</code> 什么意思？</p>
</blockquote>
<p>? 运算符只能被用于返回值与 ? 作用的值相兼容的函数。因为 ? 运算符被定义为从函数中提早返回一个值，这与 match 表达式有着完全相同的工作方式。</p>
<p>看上去 <code>?</code> 是返回值的简化版，不需要 match 这种比较复杂的形式。</p>
<p>参考：用 Result 处理可恢复的错误，<a target="_blank" rel="noopener" href="https://kaisery.github.io/trpl-zh-cn/ch09-02-recoverable-errors-with-result.html">https://kaisery.github.io/trpl-zh-cn/ch09-02-recoverable-errors-with-result.html</a></p>
<h4 id="看下面的例子，-避免了对变量类型的判断。"><a href="#看下面的例子，-避免了对变量类型的判断。" class="headerlink" title="看下面的例子，? 避免了对变量类型的判断。"></a>看下面的例子，<code>?</code> 避免了对变量类型的判断。</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">multiply</span>(first_number_str: &amp;<span class="type">str</span>, second_number_str: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">first_number</span> = first_number_str.parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second_number</span> = second_number_str.parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(first_number * second_number)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="052-error-handling-errors3-rs"><a href="#052-error-handling-errors3-rs" class="headerlink" title="052 error_handling&#x2F;errors3.rs"></a>052 error_handling&#x2F;errors3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于库代码，不建议使用“Box&lt;dyn error::Error&gt;”之类的万能错误类型，因为调用者可能希望根据错误内容做出决策，而不是将其打印出来或进一步传播。在这里，我们定义了一个自定义错误类型，以便调用者能够决定当我们的函数返回错误时下一步要做什么。</span></span><br><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">tokens</span> = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pretend_user_input</span> = <span class="string">&quot;8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cost</span> = <span class="title function_ invoke__">total_cost</span>(pretend_user_input)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cost &gt; tokens &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;You can&#x27;t afford that many!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        tokens -= cost;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;You now have &#123;&#125; tokens.&quot;</span>, tokens);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">total_cost</span>(item_quantity: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">processing_fee</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cost_per_item</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">qty</span> = item_quantity.parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(qty * cost_per_item + processing_fee)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main 的最后一行添加了 <code>Ok(())</code>。</p>
<p>main函数默认没有返回值，或者说返回值类型是()，在这种函数中不能使用 ?，故而有两种解决方案：</p>
<ul>
<li>给main函数增加返回值类型，fn main() -&gt; Result&lt;(), ParseIntError&gt;</li>
<li>不使用?，用unwrap代替：letcost&#x3D;total_cost(pretend_user_input).unwrap();</li>
</ul>
<h4 id="unwrap-故障时执行panic"><a href="#unwrap-故障时执行panic" class="headerlink" title="unwrap: 故障时执行panic"></a>unwrap: 故障时执行panic</h4><p>并且你知道或者期望它一定是 Ok 值（即不包含错误）时，可以使用 .unwrap() 方法。它会提取并返回 Ok 包含的值。但如果该 Result 是 Err 值（包含错误），.unwrap() 会触发一个运行时panic，并停止程序执行，同时打印出错误信息。</p>
<h4 id="故障时返回Err对象"><a href="#故障时返回Err对象" class="headerlink" title="?: 故障时返回Err对象"></a>?: 故障时返回Err对象</h4><h2 id="053-error-handling-errors4-rs"><a href="#053-error-handling-errors4-rs" class="headerlink" title="053 error_handling&#x2F;errors4.rs"></a>053 error_handling&#x2F;errors4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositiveNonzeroInteger</span>(<span class="type">u64</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CreationError</span> &#123;</span><br><span class="line">    Negative,</span><br><span class="line">    Zero,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">PositiveNonzeroInteger</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(value: <span class="type">i64</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;PositiveNonzeroInteger, CreationError&gt; &#123;</span><br><span class="line">        <span class="comment">// Hmm...? Why is this only returning an Ok value?</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">PositiveNonzeroInteger</span>(value <span class="keyword">as</span> <span class="type">u64</span>))</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> value ==<span class="number">0</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(CreationError::Zero)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(CreationError::Negative)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_creation</span>() &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(PositiveNonzeroInteger::<span class="title function_ invoke__">new</span>(<span class="number">10</span>).<span class="title function_ invoke__">is_ok</span>());</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">Err</span>(CreationError::Negative),     PositiveNonzeroInteger::<span class="title function_ invoke__">new</span>(-<span class="number">10</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">Err</span>(CreationError::Zero),         PositiveNonzeroInteger::<span class="title function_ invoke__">new</span>(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="背景讲解：-1"><a href="#背景讲解：-1" class="headerlink" title="背景讲解："></a>背景讲解：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">PositiveNonzeroInteger::new 总会创建一个新的实例（instance）并返回结果 Ok，它应当做一些检查，在检查失败时返回 Err，仅当检查确定一切正常时返回 Ok。</span><br><span class="line"></span><br><span class="line">所以我们在 new 函数中实现检查，小于 0 是报错负数，等于 0 时报错 0。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">impl PositiveNonzeroInteger &#123;</span><br><span class="line">    fn new(value: i64) -&gt; Result&lt;PositiveNonzeroInteger, CreationError&gt; &#123;</span><br><span class="line">        if value &lt; 0 &#123;</span><br><span class="line">            Err(CreationError::Negative)</span><br><span class="line"></span><br><span class="line">        &#125; else if value == 0 &#123;</span><br><span class="line">            Err(CreationError::Zero)</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            Ok(PositiveNonzeroInteger(value as u64))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">除了 if 外，参考 errors5</span><br><span class="line"></span><br><span class="line">也可以使用 match 的版本：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">impl PositiveNonzeroInteger &#123;</span><br><span class="line">    fn new(value: i64) -&gt; Result&lt;PositiveNonzeroInteger, CreationError&gt; &#123;</span><br><span class="line">        match value &#123;</span><br><span class="line">            x if x &lt; 0 =&gt; Err(CreationError::Negative),</span><br><span class="line">            x if x == 0 =&gt; Err(CreationError::Zero),</span><br><span class="line">            _ =&gt; Ok(PositiveNonzeroInteger(value as u64))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h4><ol>
<li><p><code>fn new(value: i64) -&gt; Result&lt;PositiveNonzeroInteger, CreationError&gt;</code> 为什么没有包含 Ok 的值？但 Ok 有返回呀。</p>
</li>
<li><p>struct PositiveNonzeroInteger(u64) 是一种什么结构？</p>
</li>
</ol>
<p>它是一种元组结构体，如：<br>struct Pair(i32, f32);</p>
<h2 id="054-error-handling-errors5-rs"><a href="#054-error-handling-errors5-rs" class="headerlink" title="054 error_handling&#x2F;errors5.rs"></a>054 error_handling&#x2F;errors5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This program uses an altered version of the code from errors4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This exercise uses some concepts that we won&#x27;t get to until later in the course, like `Box` and the `From` trait. It&#x27;s not important to understand them in detail right now, but you can read ahead if you like. For now, think of the `Box&lt;dyn ???&gt;` type as an &quot;I want anything that does ???&quot; type, which, given Rust&#x27;s usual standards for runtime safety, should strike you as somewhat lenient!</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// In short, this particular use case for boxes is for when you want to own a value and you care only that it is a type which implements a particular trait. To do so, The Box is declared as of type Box&lt;dyn Trait&gt; where Trait is the trait the compiler looks for on any value used in that context. For this exercise, that context is the potential errors which can be returned in a Result.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// What can we use to describe both errors? In other words, is there a trait which both errors implement?</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">use</span> std::error;</span><br><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> update the return type of `main()` to make this compile.</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">Box</span>&lt;<span class="keyword">dyn</span> error::Error&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pretend_user_input</span> = <span class="string">&quot;42&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: <span class="type">i64</span> = pretend_user_input.<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;output=&#123;:?&#125;&quot;</span>, PositiveNonzeroInteger::<span class="title function_ invoke__">new</span>(x)?);</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Don&#x27;t change anything below this line.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositiveNonzeroInteger</span>(<span class="type">u64</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CreationError</span> &#123;</span><br><span class="line">    Negative,</span><br><span class="line">    Zero,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">PositiveNonzeroInteger</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(value: <span class="type">i64</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;PositiveNonzeroInteger, CreationError&gt; &#123;</span><br><span class="line">        <span class="keyword">match</span> value &#123;</span><br><span class="line">            x <span class="keyword">if</span> x &lt; <span class="number">0</span> =&gt; <span class="title function_ invoke__">Err</span>(CreationError::Negative),</span><br><span class="line">            x <span class="keyword">if</span> x == <span class="number">0</span> =&gt; <span class="title function_ invoke__">Err</span>(CreationError::Zero),</span><br><span class="line">            x =&gt; <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">PositiveNonzeroInteger</span>(x <span class="keyword">as</span> <span class="type">u64</span>)),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is required so that `CreationError` can implement `error::Error`.</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">CreationError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">description</span> = <span class="keyword">match</span> *<span class="keyword">self</span> &#123;</span><br><span class="line">            CreationError::Negative =&gt; <span class="string">&quot;number is negative&quot;</span>,</span><br><span class="line">            CreationError::Zero =&gt; <span class="string">&quot;number is zero&quot;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        f.<span class="title function_ invoke__">write_str</span>(description)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">error</span>::Error <span class="keyword">for</span> <span class="title class_">CreationError</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>本题与 error3.rs 背景类似，<br>因为 ? 要求 Result&lt;T, E&gt; 形式的返回值，而 main 函数的返回是 ()<br>本题只需个修改 <code>fn main() -&gt; Result&lt;(), Box&lt;dyn error::Error&gt;&gt;</code>。</p>
<h4 id="疑问-1"><a href="#疑问-1" class="headerlink" title="疑问"></a>疑问</h4><ul>
<li>Box<dyn error::Error>&gt;</li>
</ul>
<p>查 dyn 是个什么关键字？</p>
<h2 id="055-error-handling-errors6-rs"><a href="#055-error-handling-errors6-rs" class="headerlink" title="055 error_handling&#x2F;errors6.rs"></a>055 error_handling&#x2F;errors6.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// errors6.rs</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Using catch-all error types like `Box&lt;dyn error::Error&gt;` isn&#x27;t recommended for library code, where callers might want to make decisions based on the error content, instead of printing it out or propagating it further. Here, we define a custom error type to make it possible for callers to decide what to do next when our function returns an error.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint errors6` or use the `hint` watch subcommand for a</span></span><br><span class="line"><span class="comment">// hint.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is a custom error type that we will be using in `parse_pos_nonzero()`.</span></span><br><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ParsePosNonzeroError</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Creation</span>(CreationError),</span><br><span class="line">    <span class="title function_ invoke__">ParseInt</span>(ParseIntError),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">ParsePosNonzeroError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from_creation</span>(err: CreationError) <span class="punctuation">-&gt;</span> ParsePosNonzeroError &#123;</span><br><span class="line">        ParsePosNonzeroError::<span class="title function_ invoke__">Creation</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from_parseint</span>(err: ParseIntError) <span class="punctuation">-&gt;</span> ParsePosNonzeroError &#123;</span><br><span class="line">        ParsePosNonzeroError::<span class="title function_ invoke__">ParseInt</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">parse_pos_nonzero</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;PositiveNonzeroInteger, ParsePosNonzeroError&gt; &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> change this to return an appropriate error instead of panicking</span></span><br><span class="line">    <span class="comment">// when `parse()` returns an error.</span></span><br><span class="line">    <span class="comment">//let x: i64 = s.parse().map_err(PositiveNonzeroInteger::from_parseint)?;</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: <span class="type">i64</span> = s.<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">map_err</span>(ParsePosNonzeroError::from_parseint)?;</span><br><span class="line">    PositiveNonzeroInteger::<span class="title function_ invoke__">new</span>(x).<span class="title function_ invoke__">map_err</span>(ParsePosNonzeroError::from_creation)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Don&#x27;t change anything below this line.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositiveNonzeroInteger</span>(<span class="type">u64</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CreationError</span> &#123;</span><br><span class="line">    Negative,</span><br><span class="line">    Zero,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">PositiveNonzeroInteger</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(value: <span class="type">i64</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;PositiveNonzeroInteger, CreationError&gt; &#123;</span><br><span class="line">        <span class="keyword">match</span> value &#123;</span><br><span class="line">            x <span class="keyword">if</span> x &lt; <span class="number">0</span> =&gt; <span class="title function_ invoke__">Err</span>(CreationError::Negative),</span><br><span class="line">            x <span class="keyword">if</span> x == <span class="number">0</span> =&gt; <span class="title function_ invoke__">Err</span>(CreationError::Zero),</span><br><span class="line">            x =&gt; <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">PositiveNonzeroInteger</span>(x <span class="keyword">as</span> <span class="type">u64</span>)),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> test &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_parse_error</span>() &#123;</span><br><span class="line">        <span class="comment">// We can&#x27;t construct a ParseIntError, so we have to pattern match.</span></span><br><span class="line">        <span class="built_in">assert!</span>(matches!(</span><br><span class="line">            <span class="title function_ invoke__">parse_pos_nonzero</span>(<span class="string">&quot;not a number&quot;</span>),</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(ParsePosNonzeroError::<span class="title function_ invoke__">ParseInt</span>(_))</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_negative</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="title function_ invoke__">parse_pos_nonzero</span>(<span class="string">&quot;-555&quot;</span>),</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(ParsePosNonzeroError::<span class="title function_ invoke__">Creation</span>(CreationError::Negative))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_zero</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="title function_ invoke__">parse_pos_nonzero</span>(<span class="string">&quot;0&quot;</span>),</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(ParsePosNonzeroError::<span class="title function_ invoke__">Creation</span>(CreationError::Zero))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_positive</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = PositiveNonzeroInteger::<span class="title function_ invoke__">new</span>(<span class="number">42</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(x.<span class="title function_ invoke__">is_ok</span>());</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">parse_pos_nonzero</span>(<span class="string">&quot;42&quot;</span>), <span class="title function_ invoke__">Ok</span>(x.<span class="title function_ invoke__">unwrap</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a target="_blank" rel="noopener" href="https://course.rs/advance/errors.html#map-%E5%92%8C-map_err">https://course.rs/advance/errors.html#map-%E5%92%8C-map_err</a></p>
<h4 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h4><p><code>let x: i64 = s.parse().map_err(ParsePosNonzeroError::from_parseint)?</code> 为什么是这么个顺序，虽然它表达的意思我们大致能够理解。</p>
<p>这行代码的意思是，如果 s.parse() 解析成功，则将解析后的整数值赋值给 x；如果解析失败，? 操作符会立即返回并将 ParseIntError 转换为 ParsePosNonzeroError::ParseInt 错误，并将其作为 parse_pos_nonzero 函数的返回结果。</p>
<p>在 Rust 中，? 操作符用于简化错误处理的过程。它只能在返回 Result 或 Option 的函数中使用。当使用 ? 操作符时，编译器会自动为你处理错误的传播。</p>
<p>具体到代码中，s.parse() 返回的是一个 Result&lt;i64, ParseIntError&gt;，该结果表示解析字符串为整数的过程。如果解析成功，返回 Ok 包含解析后的整数值；如果解析失败，则返回 Err 包含一个 ParseIntError 错误。</p>
<h4 id="待删"><a href="#待删" class="headerlink" title="待删"></a>待删</h4><p>main 的返回值是 Result&lt;(), ParseIntError&gt; ，而 PositiveNonzeroInteger::new(x) 的返回值是 Result&lt;PositiveNonzeroInteger, CreationError&gt;。我们怎么能让 main 的返回值包含它们呢？看看 hint：</p>
<p>main 中会产生两种错误类型（ParseIntError 和 CreationError），它们都通过 ? 传递。我们怎样在 main 中声明同时允许两种错误返回的情况呢？ 还是参考 Where The ? Operator Can Be Used，在底层实现中，? 对错误值调用 From::from 将其转换成一个装箱（boxed）的 trait 对象，也就是 Box<dyn error::Error>，它是多态的，意味着很多不同类型的错误可以从同一个函数返回。所有的错误行为都是一样的，因为它们都实现了 error::Error trait（特征）。</p>
<p>这样我们可以通过修改返回值简单地实现：</p>
<p>fn main() -&gt; Result&lt;(), Box<dyn error::Error>&gt;</p>
<h4 id="待消化，待删除的内容"><a href="#待消化，待删除的内容" class="headerlink" title="待消化，待删除的内容"></a>待消化，待删除的内容</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is a custom error type that we will be using in `parse_pos_nonzero()`.</span></span><br><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ParsePosNonzeroError</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Creation</span>(CreationError),</span><br><span class="line">    <span class="title function_ invoke__">ParseInt</span>(ParseIntError),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">ParsePosNonzeroError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from_creation</span>(err: CreationError) <span class="punctuation">-&gt;</span> ParsePosNonzeroError &#123;</span><br><span class="line">        ParsePosNonzeroError::<span class="title function_ invoke__">Creation</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> add another error conversion function here.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from_parseint</span>(err: ParseIntError)<span class="punctuation">-&gt;</span> ParsePosNonzeroError &#123;</span><br><span class="line">        ParsePosNonzeroError::<span class="title function_ invoke__">ParseInt</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">parse_pos_nonzero</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;PositiveNonzeroInteger, ParsePosNonzeroError&gt; &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> change this to return an appropriate error instead of panicking</span></span><br><span class="line">    <span class="comment">// when `parse()` returns an error.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: <span class="type">i64</span> = s.<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">map_err</span>(ParsePosNonzeroError::from_parseint)?;</span><br><span class="line">    PositiveNonzeroInteger::<span class="title function_ invoke__">new</span>(x).<span class="title function_ invoke__">map_err</span>(ParsePosNonzeroError::from_creation)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原本是parse().unwrap()，这将会导致如果s不能解析为整数i64，就会直接panic掉，而使用map_err对Err()进行一些修改，捕获原本的ParseInt类型错误，而将它转化成ParsePosNonzeroError::ParseInt，这就符合下面的测试逻辑了。</p>
<p>再解释一下 let x: i64 &#x3D; s.parse().map_err(ParsePosNonzeroError::from_parseint)?; 为什么是这么个顺序，虽然它表达的意思我们大致能够理解。</p>
<p>这行代码的意思是，如果 s.parse() 解析成功，则将解析后的整数值赋值给 x；如果解析失败，? 操作符会立即返回并将 ParseIntError 转换为 ParsePosNonzeroError::ParseInt 错误，并将其作为 parse_pos_nonzero 函数的返回结果。</p>
<p>在 Rust 中，? 操作符用于简化错误处理的过程。它只能在返回 Result 或 Option 的函数中使用。当使用 ? 操作符时，编译器会自动为你处理错误的传播。</p>
<p>具体到代码中，s.parse() 返回的是一个 Result&lt;i64, ParseIntError&gt;，该结果表示解析字符串为整数的过程。如果解析成功，返回 Ok 包含解析后的整数值；如果解析失败，则返回 Err 包含一个 ParseIntError 错误。</p>
<h2 id="056-generics-generics1-rs"><a href="#056-generics-generics1-rs" class="headerlink" title="056 generics&#x2F;generics1.rs"></a>056 generics&#x2F;generics1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">shopping_list</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    shopping_list.<span class="title function_ invoke__">push</span>(<span class="string">&quot;milk&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先是 Vec 的类型为 String，那么下面的字符串就需要 .to_string()，还可以设置 Vec 的类型为 &amp;str，就不需要修改下面的 push 了。</p>
<h2 id="057-generics-generics2-rs"><a href="#057-generics-generics2-rs" class="headerlink" title="057 generics&#x2F;generics2.rs"></a>057 generics&#x2F;generics2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This powerful wrapper provides the ability to store a positive integer value.</span></span><br><span class="line"><span class="comment">// Rewrite it using generics so that it supports wrapping ANY type.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Wrapper</span>&lt;T&gt; &#123;</span><br><span class="line">    value: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Wrapper&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(value: T) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Wrapper &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">store_u32_in_wrapper</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(Wrapper::<span class="title function_ invoke__">new</span>(<span class="number">42</span>).value, <span class="number">42</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">store_str_in_wrapper</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(Wrapper::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Foo&quot;</span>).value, <span class="string">&quot;Foo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="058-traits-traits1-rs"><a href="#058-traits-traits1-rs" class="headerlink" title="058 traits&#x2F;traits1.rs"></a>058 traits&#x2F;traits1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Time to implement some traits! Your task is to implement the trait</span></span><br><span class="line"><span class="comment">// `AppendBar` for the type `String`. The trait AppendBar has only one function,</span></span><br><span class="line"><span class="comment">// which appends &quot;Bar&quot; to any object implementing this trait.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint traits1` or use the `hint` watch subcommand for a</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">AppendBar</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">append_bar</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">AppendBar</span> <span class="keyword">for</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement `AppendBar` for type `String`.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">append_bar</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>&#123;</span><br><span class="line">        <span class="keyword">self</span> + <span class="string">&quot;Bar&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Foo&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = s.<span class="title function_ invoke__">append_bar</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;s: &#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_foo_bar</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Foo&quot;</span>).<span class="title function_ invoke__">append_bar</span>(), <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;FooBar&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_bar_bar</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;&quot;</span>).<span class="title function_ invoke__">append_bar</span>().<span class="title function_ invoke__">append_bar</span>(),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;BarBar&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="59-traits-traits2-rs"><a href="#59-traits-traits2-rs" class="headerlink" title="59 traits&#x2F;traits2.rs"></a>59 traits&#x2F;traits2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Your task is to implement the trait `AppendBar` for a vector of strings.</span></span><br><span class="line"><span class="comment">// To implement this trait, consider for a moment what it means to &#x27;append Bar&#x27; to a vector of strings.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// No boiler plate code this time, you can do this!</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint traits2` or use the `hint` watch subcommand for a hint.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">AppendBar</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">append_bar</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">AppendBar</span> <span class="keyword">for</span> <span class="title class_">Vec</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">append_bar</span>(<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;&#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">push</span>(<span class="string">&quot;Bar&quot;</span>.<span class="title function_ invoke__">to_owned</span>());</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Implement trait `AppendBar` for a vector of strings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_vec_pop_eq_bar</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">foo</span> = <span class="built_in">vec!</span>[<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Foo&quot;</span>)].<span class="title function_ invoke__">append_bar</span>();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(foo.<span class="title function_ invoke__">pop</span>().<span class="title function_ invoke__">unwrap</span>(), <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Bar&quot;</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(foo.<span class="title function_ invoke__">pop</span>().<span class="title function_ invoke__">unwrap</span>(), <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Foo&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面两题都很基础，没什么可说的。</p>
<h2 id="60-traits-traits3-rs"><a href="#60-traits-traits3-rs" class="headerlink" title="60 traits&#x2F;traits3.rs"></a>60 traits&#x2F;traits3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Your task is to implement the Licensed trait for both structures and have them return the same information</span></span><br><span class="line"><span class="comment">// without writing the same function twice.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Consider what you can add to the Licensed trait.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint traits3` or use the `hint` watch subcommand for a hint.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Licensed</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">licensing_info</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Some information&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SomeSoftware</span> &#123;</span><br><span class="line">    version_number: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">OtherSoftware</span> &#123;</span><br><span class="line">    version_number: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Licensed</span> <span class="keyword">for</span> <span class="title class_">SomeSoftware</span> &#123;&#125; <span class="comment">// Don&#x27;t edit this line</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Licensed</span> <span class="keyword">for</span> <span class="title class_">OtherSoftware</span> &#123;&#125; <span class="comment">// Don&#x27;t edit this line</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_licensing_info_the_same</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">licensing_info</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Some information&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">some_software</span> = SomeSoftware   &#123; version_number: <span class="number">1</span> &#125;;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">other_software</span> = OtherSoftware &#123; version_number: <span class="string">&quot;v2.0.0&quot;</span>.<span class="title function_ invoke__">to_string</span>(), &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取出 licensing_info 返回值，和字符串比较。</span></span><br><span class="line">        <span class="built_in">assert_eq!</span>(some_software.<span class="title function_ invoke__">licensing_info</span>(), licensing_info);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(other_software.<span class="title function_ invoke__">licensing_info</span>(), licensing_info);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口实现了一个基本的函数。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">licensing_info</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Some information&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="61-traits-traits4-rs"><a href="#61-traits-traits4-rs" class="headerlink" title="61 traits&#x2F;traits4.rs"></a>61 traits&#x2F;traits4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Your task is to replace the &#x27;??&#x27; sections so the code compiles.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Don&#x27;t change any line other than the marked one.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint traits4` or use the `hint` watch subcommand for a</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Licensed</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">licensing_info</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="string">&quot;some information&quot;</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SomeSoftware</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">OtherSoftware</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Licensed</span> <span class="keyword">for</span> <span class="title class_">SomeSoftware</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Licensed</span> <span class="keyword">for</span> <span class="title class_">OtherSoftware</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// YOU MAY ONLY CHANGE THE NEXT LINE</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">compare_license_types</span>(software: <span class="keyword">impl</span> <span class="title class_">Licensed</span> , software_two: <span class="keyword">impl</span> <span class="title class_">Licensed</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    software.<span class="title function_ invoke__">licensing_info</span>() == software_two.<span class="title function_ invoke__">licensing_info</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">compare_license_information</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">some_software</span> = SomeSoftware &#123;&#125;;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">other_software</span> = OtherSoftware &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(<span class="title function_ invoke__">compare_license_types</span>(some_software, other_software));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">compare_license_information_backwards</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">some_software</span> = SomeSoftware &#123;&#125;;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">other_software</span> = OtherSoftware &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(<span class="title function_ invoke__">compare_license_types</span>(other_software, some_software));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改了 <code>fn compare_license_types(software: impl Licensed , software_two: impl Licensed) -&gt; bool</code></p>
<p>不用写具体的类名，只需 <code>impl Licensed</code>，这样表示它实现了一个抽象类。</p>
<h2 id="62-traits-traits5-rs"><a href="#62-traits-traits5-rs" class="headerlink" title="62 traits&#x2F;traits5.rs"></a>62 traits&#x2F;traits5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Your task is to replace the &#x27;??&#x27; sections so the code compiles.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">SomeTrait</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">some_function</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">OtherTrait</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">other_function</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SomeStruct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">OtherStruct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">SomeTrait</span> <span class="keyword">for</span> <span class="title class_">SomeStruct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">OtherTrait</span> <span class="keyword">for</span> <span class="title class_">SomeStruct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">SomeTrait</span> <span class="keyword">for</span> <span class="title class_">OtherStruct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">OtherTrait</span> <span class="keyword">for</span> <span class="title class_">OtherStruct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// YOU MAY ONLY CHANGE THE NEXT LINE</span></span><br><span class="line"><span class="comment">// fn some_func(item: ??) -&gt; bool &#123;</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">some_func</span>(item: <span class="keyword">impl</span> <span class="title class_">SomeTrait</span> + OtherTrait) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    item.<span class="title function_ invoke__">some_function</span>() &amp;&amp; item.<span class="title function_ invoke__">other_function</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">some_func</span>(SomeStruct &#123;&#125;);</span><br><span class="line">    <span class="title function_ invoke__">some_func</span>(OtherStruct &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>item: impl SomeTrait + OtherTrait</code> 表示 item 实现了两个抽象类。</p>
<h2 id="63-quiz3-rs"><a href="#63-quiz3-rs" class="headerlink" title="63 quiz3.rs"></a>63 quiz3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一所虚构的魔法学校有一个新的用 Rust 编写的成绩单生成系统！</span></span><br><span class="line"><span class="comment">// 目前，该系统仅支持创建以数字表示学生成绩的成绩单（例如 1.0 -&gt; 5.5）。但是，学校还颁发按字母顺序排列的成绩（A+ -&gt; F-），并且需要能够打印这两种类型的成绩单！</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 在 struct ReportCard 和 impl 块中进行必要的代码更改以支持按字母顺序排列的成绩单。将第二个测试中的成绩更改为“A+”，以表明您的更改允许按字母顺序排列的成绩。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">ReportCard</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> grade: T,</span><br><span class="line">    <span class="keyword">pub</span> student_name: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> student_age: <span class="type">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: std::fmt::Display&gt; ReportCard&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">print</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125; (&#123;&#125;) ## achieved a grade of &#123;&#125;&quot;</span>,</span><br><span class="line">            &amp;<span class="keyword">self</span>.student_name, &amp;<span class="keyword">self</span>.student_age, &amp;<span class="keyword">self</span>.grade)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">generate_numeric_report_card</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">report_card</span> = ReportCard &#123;</span><br><span class="line">            grade: <span class="number">2.1</span>,</span><br><span class="line">            student_name: <span class="string">&quot;Tom Wriggle&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            student_age: <span class="number">12</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            report_card.<span class="title function_ invoke__">print</span>(),</span><br><span class="line">            <span class="string">&quot;Tom Wriggle (12) ## achieved a grade of 2.1&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">generate_alphabetic_report_card</span>() &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Make sure to change the grade here after you finish the exercise.</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">report_card</span> = ReportCard &#123;</span><br><span class="line">            grade: <span class="string">&quot;A+&quot;</span>,</span><br><span class="line">            student_name: <span class="string">&quot;Gary Plotter&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            student_age: <span class="number">11</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            report_card.<span class="title function_ invoke__">print</span>(),</span><br><span class="line">            <span class="string">&quot;Gary Plotter (11) ## achieved a grade of A+&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要添加了一行 <code>impl&lt;T: std::fmt::Display&gt; ReportCard&lt;T&gt;</code></p>
<p>通过在 impl 声明中指定 T: std::fmt::Display，表明泛型类型 T 必须实现 std::fmt::Display trait。</p>
<h4 id="疑问："><a href="#疑问：" class="headerlink" title="疑问："></a>疑问：</h4><p><code>泛型类型 T 必须实现 std::fmt::Display trait </code>这里还没太懂。</p>
<h2 id="064-lifetimes-lifetimes1-rs"><a href="#064-lifetimes-lifetimes1-rs" class="headerlink" title="064 lifetimes&#x2F;lifetimes1.rs"></a>064 lifetimes&#x2F;lifetimes1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abcd&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string2</span> = <span class="string">&quot;xyz&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">longest</span>(string1.<span class="title function_ invoke__">as_str</span>(), string2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The longest string is &#x27;&#123;&#125;&#x27;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生命周期，简而言之就是引用的有效作用域，生命周期主要是解决悬垂引用问题。</p>
<p>生命周期语法用来将函数的多个引用参数和返回值的作用域关联到一起，一旦关联到一起后，Rust 就拥有充分的信息来确保我们的操作是内存安全的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    let r;                // ---------+-- &#x27;a</span><br><span class="line">                          //          |</span><br><span class="line">    &#123;                     //          |</span><br><span class="line">        let x = 5;        // -+-- &#x27;b  |</span><br><span class="line">        r = &amp;x;           //  |       |</span><br><span class="line">    &#125;                     // -+       |</span><br><span class="line">                          //          |</span><br><span class="line">    println!(&quot;r: &#123;&#125;&quot;, r); //          |</span><br><span class="line">&#125;                         // ---------+</span><br></pre></td></tr></table></figure>

<p>在编译期会比较两个变量的生命周期，结果发现 r 生命周期 ‘a，引用了小得多的生命周期 ‘b，编译器认为存在风险，因此拒绝运行。</p>
<p>要想编译通过，引用，即箭头右边指向的那个东西，要活得久一点。</p>
<p>回到本题，该函数的返回值是一个引用类型，但是函数签名无法说明，该引用是借用自 <code>x</code> 还是 <code>y</code>，它不知道 x 和 y 的生命周期跟返回值的之间的关系是怎样的？</p>
<p><code>longest&lt;&#39;a&gt;(x: &amp;&#39;a str, y: &amp;&#39;a str) -&gt; &amp;&#39;a str</code> 表示 x、y 和返回值存活一样久。</p>
<h2 id="065-lifetimes-lifetimes2-rs"><a href="#065-lifetimes-lifetimes2-rs" class="headerlink" title="065 lifetimes&#x2F;lifetimes2.rs"></a>065 lifetimes&#x2F;lifetimes2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;long string is long&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">string2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;xyz&quot;</span>);</span><br><span class="line">        result = <span class="title function_ invoke__">longest</span>(string1.<span class="title function_ invoke__">as_str</span>(), string2.<span class="title function_ invoke__">as_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The longest string is &#x27;&#123;&#125;&#x27;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面是原题。</p>
<p>此处的逻辑有点违反直觉，原以为 result 都已经从函数里返回出来了，它不应该受 string1 &#x2F; string2 的影响，上面代码理应正常通过。</p>
<p>但真实逻辑是：’a 等于两者中生命周期较小的那个，也就是 ‘a 等于 string2 的生命周期，同理，result 也是 ‘a，可以得出 result 等于 string2 的生命周期。</p>
<h2 id="066-lifetimes-lifetimes3-rs"><a href="#066-lifetimes-lifetimes3-rs" class="headerlink" title="066 lifetimes&#x2F;lifetimes3.rs"></a>066 lifetimes&#x2F;lifetimes3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lifetimes are also needed when structs hold references.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint lifetimes3` or use the `hint` watch subcommand for a</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Book</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    author: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    title: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">name</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Jill Smith&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">title</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Fish Flying&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">book</span> = Book &#123; author: &amp;name, title: &amp;title &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; by &#123;&#125;&quot;</span>, book.title, book.author);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="067-tests-tests1-rs"><a href="#067-tests-tests1-rs" class="headerlink" title="067 tests&#x2F;tests1.rs"></a>067 tests&#x2F;tests1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tests are important to ensure that your code does what you think it should</span></span><br><span class="line"><span class="comment">// do. Tests can be run on this file with the following command: rustlings run</span></span><br><span class="line"><span class="comment">// tests1</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This test has a problem with it -## make the test compile! Make the test pass!</span></span><br><span class="line"><span class="comment">// Make the test fail!</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint tests1` or use the `hint` watch subcommand for a</span></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">you_can_assert</span>() &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>介绍 test 模块是怎么回事。</p>
<h2 id="068-tests-tests2-rs"><a href="#068-tests-tests2-rs" class="headerlink" title="068 tests&#x2F;tests2.rs"></a>068 tests&#x2F;tests2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This test has a problem with it -## make the test compile! Make the test pass!</span></span><br><span class="line"><span class="comment">// Make the test fail!</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint tests2` or use the `hint` watch subcommand for a</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">you_can_assert_eq</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="069-tests-tests3-rs"><a href="#069-tests-tests3-rs" class="headerlink" title="069 tests&#x2F;tests3.rs"></a>069 tests&#x2F;tests3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This test isn&#x27;t testing our function -## make it do that in such a way that</span></span><br><span class="line"><span class="comment">// the test passes. Then write a second test that tests whether we get the</span></span><br><span class="line"><span class="comment">// result we expect to get when we call `is_even(5)`.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint tests3` or use the `hint` watch subcommand for a</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">is_even</span>(num: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    num % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_true_when_even</span>() &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(<span class="title function_ invoke__">is_even</span>(<span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">is_false_when_odd</span>() &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(!<span class="title function_ invoke__">is_even</span>(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="070-tests-tests4-rs"><a href="#070-tests-tests4-rs" class="headerlink" title="070 tests&#x2F;tests4.rs"></a>070 tests&#x2F;tests4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Make sure that we&#x27;re testing for the correct conditions!</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint tests4` or use the `hint` watch subcommand for a</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">i32</span>,</span><br><span class="line">    height: <span class="type">i32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="comment">// Only change the test functions themselves</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(width: <span class="type">i32</span>, height: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> width &lt;= <span class="number">0</span> || height &lt;= <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;Rectangle width and height cannot be negative!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Rectangle &#123;width, height&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">correct_width_and_height</span>() &#123;</span><br><span class="line">        <span class="comment">// This test should check if the rectangle is the size that we pass into its constructor</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">rect</span> = Rectangle::<span class="title function_ invoke__">new</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(rect.width, <span class="number">10</span>); <span class="comment">// check width</span></span><br><span class="line">        <span class="built_in">assert_eq!</span>(rect.height, <span class="number">20</span>); <span class="comment">// check height</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[should_panic]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">negative_width</span>() &#123;</span><br><span class="line">        <span class="comment">// This test should check if program panics when we try to create rectangle with negative width</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">_rect</span> = Rectangle::<span class="title function_ invoke__">new</span>(-<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[should_panic]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">negative_height</span>() &#123;</span><br><span class="line">        <span class="comment">// This test should check if program panics when we try to create rectangle with negative height</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">_rect</span> = Rectangle::<span class="title function_ invoke__">new</span>(<span class="number">10</span>, -<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="疑问：-1"><a href="#疑问：-1" class="headerlink" title="疑问："></a>疑问：</h4><p>主要涉及到 <code>#[should_panic]</code> 特性。</p>
<h2 id="71-iterators-iterators1-rs"><a href="#71-iterators-iterators1-rs" class="headerlink" title="71 iterators&#x2F;iterators1.rs"></a>71 iterators&#x2F;iterators1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// When performing operations on elements within a collection, iterators are</span></span><br><span class="line"><span class="comment">// essential. This module helps you get familiar with the structure of using an iterator and how to go through elements within an iterable collection.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Make me compile by filling in the `???`s</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint iterators1` or use the `hint` watch subcommand for a</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_fav_fruits</span> = <span class="built_in">vec!</span>[<span class="string">&quot;banana&quot;</span>, <span class="string">&quot;custard apple&quot;</span>, <span class="string">&quot;avocado&quot;</span>, <span class="string">&quot;peach&quot;</span>, <span class="string">&quot;raspberry&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">my_iterable_fav_fruits</span> = my_fav_fruits.<span class="title function_ invoke__">iter</span>();;   <span class="comment">// <span class="doctag">TODO:</span> Step 1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(my_iterable_fav_fruits.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="string">&quot;banana&quot;</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(my_iterable_fav_fruits.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="string">&quot;custard apple&quot;</span>));     <span class="comment">// <span class="doctag">TODO:</span> Step 2</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(my_iterable_fav_fruits.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="string">&quot;avocado&quot;</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(my_iterable_fav_fruits.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="string">&quot;peach&quot;</span>));     <span class="comment">// <span class="doctag">TODO:</span> Step 3</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(my_iterable_fav_fruits.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="string">&quot;raspberry&quot;</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(my_iterable_fav_fruits.<span class="title function_ invoke__">next</span>(), <span class="literal">None</span>);     <span class="comment">// <span class="doctag">TODO:</span> Step 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>into_iter()会夺走所有权，iter()是借用。如果使用前者，assert_eq!中比较对象应该是Some(“banana”)。</p>
<h2 id="72-iterators-iterators2-rs"><a href="#72-iterators-iterators2-rs" class="headerlink" title="72 iterators&#x2F;iterators2.rs"></a>72 iterators&#x2F;iterators2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step 1.</span></span><br><span class="line"><span class="comment">// Complete the `capitalize_first` function.</span></span><br><span class="line"><span class="comment">// &quot;hello&quot; -&gt; &quot;Hello&quot;</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">capitalize_first</span>(input: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">c</span> = input.<span class="title function_ invoke__">chars</span>();</span><br><span class="line">    <span class="keyword">match</span> c.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="type">String</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(first) =&gt; first.<span class="title function_ invoke__">to_uppercase</span>().<span class="title function_ invoke__">to_string</span>() + c.<span class="title function_ invoke__">as_str</span>(),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 2.</span></span><br><span class="line"><span class="comment">// Apply the `capitalize_first` function to a slice of string slices.</span></span><br><span class="line"><span class="comment">// Return a vector of strings.</span></span><br><span class="line"><span class="comment">// [&quot;hello&quot;, &quot;world&quot;] -&gt; [&quot;Hello&quot;, &quot;World&quot;]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">capitalize_words_vector</span>(words: &amp;[&amp;<span class="type">str</span>]) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    words.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|words| <span class="title function_ invoke__">capitalize_first</span>(words)).<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 3.</span></span><br><span class="line"><span class="comment">// Apply the `capitalize_first` function again to a slice of string slices.</span></span><br><span class="line"><span class="comment">// Return a single string.</span></span><br><span class="line"><span class="comment">// [&quot;hello&quot;, &quot; &quot;, &quot;world&quot;] -&gt; &quot;Hello World&quot;</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">capitalize_words_string</span>(words: &amp;[&amp;<span class="type">str</span>]) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    words.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|words| <span class="title function_ invoke__">capitalize_first</span>(words)).<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_success</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">capitalize_first</span>(<span class="string">&quot;hello&quot;</span>), <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_empty</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">capitalize_first</span>(<span class="string">&quot;&quot;</span>), <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_iterate_string_vec</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">words</span> = <span class="built_in">vec!</span>[<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>];</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">capitalize_words_vector</span>(&amp;words), [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_iterate_into_string</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">words</span> = <span class="built_in">vec!</span>[<span class="string">&quot;hello&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;world&quot;</span>];</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">capitalize_words_string</span>(&amp;words), <span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="73-iterators-iterators3-rs"><a href="#73-iterators-iterators3-rs" class="headerlink" title="73 iterators&#x2F;iterators3.rs"></a>73 iterators&#x2F;iterators3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug, PartialEq, Eq)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">DivisionError</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">NotDivisible</span>(NotDivisibleError),</span><br><span class="line">    DivideByZero,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq, Eq)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">NotDivisibleError</span> &#123;</span><br><span class="line">    dividend: <span class="type">i32</span>,</span><br><span class="line">    divisor: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Calculate `a` divided by `b` if `a` is evenly divisible by `b`.</span></span><br><span class="line"><span class="comment">// Otherwise, return a suitable error.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">divide</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, DivisionError&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(DivisionError::DivideByZero);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> a % b !=<span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(DivisionError::<span class="title function_ invoke__">NotDivisible</span>(</span><br><span class="line">            NotDivisibleError</span><br><span class="line">            &#123;</span><br><span class="line">                dividend:a,</span><br><span class="line">                divisor:b,&#125;</span><br><span class="line">            ));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(a/b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Complete the function and return a value of the correct type so the test</span></span><br><span class="line"><span class="comment">// passes.</span></span><br><span class="line"><span class="comment">// Desired output: Ok([1, 11, 1426, 3])</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">result_with_list</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;, DivisionError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = <span class="built_in">vec!</span>[<span class="number">27</span>, <span class="number">297</span>, <span class="number">38502</span>, <span class="number">81</span>];</span><br><span class="line">    numbers.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">map</span>(|n| <span class="title function_ invoke__">divide</span>(n, <span class="number">27</span>)).<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Complete the function and return a value of the correct type so the test</span></span><br><span class="line"><span class="comment">// passes.</span></span><br><span class="line"><span class="comment">// Desired output: [Ok(1), Ok(11), Ok(1426), Ok(3)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">list_of_results</span>() <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">Result</span>&lt;<span class="type">i32</span>, DivisionError&gt;&gt;   &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = <span class="built_in">vec!</span>[<span class="number">27</span>, <span class="number">297</span>, <span class="number">38502</span>, <span class="number">81</span>];</span><br><span class="line">    numbers.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">map</span>(|n| <span class="title function_ invoke__">divide</span>(n, <span class="number">27</span>)).<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_success</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">divide</span>(<span class="number">81</span>, <span class="number">9</span>), <span class="title function_ invoke__">Ok</span>(<span class="number">9</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_not_divisible</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="title function_ invoke__">divide</span>(<span class="number">81</span>, <span class="number">6</span>),</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(DivisionError::<span class="title function_ invoke__">NotDivisible</span>(NotDivisibleError &#123;</span><br><span class="line">                dividend: <span class="number">81</span>,</span><br><span class="line">                divisor: <span class="number">6</span></span><br><span class="line">            &#125;))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_divide_by_0</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">divide</span>(<span class="number">81</span>, <span class="number">0</span>), <span class="title function_ invoke__">Err</span>(DivisionError::DivideByZero));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_divide_0_by_something</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">divide</span>(<span class="number">0</span>, <span class="number">81</span>), <span class="title function_ invoke__">Ok</span>(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_result_with_list</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, <span class="title function_ invoke__">result_with_list</span>()), <span class="string">&quot;Ok([1, 11, 1426, 3])&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_list_of_results</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, <span class="title function_ invoke__">list_of_results</span>()),</span><br><span class="line">            <span class="string">&quot;[Ok(1), Ok(11), Ok(1426), Ok(3)]&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="疑问-2"><a href="#疑问-2" class="headerlink" title="疑问"></a>疑问</h4><blockquote>
<p>下面两条代码，还没有明白。</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Complete the function and return a value of the correct type so the test</span></span><br><span class="line"><span class="comment">// passes.</span></span><br><span class="line"><span class="comment">// Desired output: Ok([1, 11, 1426, 3])</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">result_with_list</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;, DivisionError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = <span class="built_in">vec!</span>[<span class="number">27</span>, <span class="number">297</span>, <span class="number">38502</span>, <span class="number">81</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">division_results</span> = numbers.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">map</span>(|n| <span class="title function_ invoke__">divide</span>(n, <span class="number">27</span>)).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    division_results</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Complete the function and return a value of the correct type so the test</span></span><br><span class="line"><span class="comment">// passes.</span></span><br><span class="line"><span class="comment">// Desired output: [Ok(1), Ok(11), Ok(1426), Ok(3)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">list_of_results</span>() <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">Result</span>&lt;<span class="type">i32</span>, DivisionError&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = <span class="built_in">vec!</span>[<span class="number">27</span>, <span class="number">297</span>, <span class="number">38502</span>, <span class="number">81</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">division_results</span> = numbers.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">map</span>(|n| <span class="title function_ invoke__">divide</span>(n, <span class="number">27</span>)).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    division_results</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>map：转换数据。接受一个闭包并为迭代器中的每个元素调用该闭包，然后返回一个新的迭代器，其中包含闭包返回的值。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let v = vec![1, 2, 3];</span><br><span class="line">let v_squared: Vec&lt;i32&gt; = v.iter().map(|x| x * x).collect();</span><br></pre></td></tr></table></figure>

<ul>
<li>filter：过滤数据。接受一个闭包并为迭代器中的每个元素调用该闭包。如果闭包返回true，则元素将包含在新的迭代器中。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let v = vec![1, 2, 3];</span><br><span class="line">let v_even: Vec&lt;&amp;i32&gt; = v.iter().filter(|x| *x % 2 == 0).collect();</span><br></pre></td></tr></table></figure>
<ul>
<li>fold：聚合数据。接受一个初始值和一个闭包，并将闭包应用于初始值和迭代器中的每个元素，以生成一个单一的最终值。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let v = vec![1, 2, 3];</span><br><span class="line">let sum: i32 = v.iter().fold(0, |acc, x| acc + x);</span><br></pre></td></tr></table></figure>

<ul>
<li>chain：该方法是Iterator trait的一个方法，它允许你将两个迭代器链接在一起，形成一个新的迭代器。这个新的迭代器会先遍历第一个迭代器中的所有元素，然后再遍历第二个迭代器中的所有元素。</li>
</ul>
<p>例如，你可以使用chain方法将两个数组中的元素链接在一起：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let a = [1, 2, 3];</span><br><span class="line">let b = [4, 5];</span><br><span class="line">let c: Vec&lt;i32&gt; = a.iter().chain(b.iter()).copied().collect();</span><br><span class="line">assert_eq!(c, [1, 2, 3, 4, 5]);</span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们创建了两个数组a和b，然后使用chain方法将它们链接在一起，形成一个新的迭代器。最后，我们使用collect方法将迭代器中的元素收集到一个向量中。</p>
<h2 id="74-iterators-iterators4-rs"><a href="#74-iterators-iterators4-rs" class="headerlink" title="74 iterators&#x2F;iterators4.rs"></a>74 iterators&#x2F;iterators4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">factorial</span>(num: <span class="type">u64</span>) <span class="punctuation">-&gt;</span> <span class="type">u64</span> &#123;</span><br><span class="line">    (<span class="number">1</span>..num+<span class="number">1</span>).<span class="title function_ invoke__">product</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="75-iterators-iterators5-rs"><a href="#75-iterators-iterators5-rs" class="headerlink" title="75 iterators&#x2F;iterators5.rs"></a>75 iterators&#x2F;iterators5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Clone, Copy, PartialEq, Eq)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Progress</span> &#123;</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">    <span class="literal">Some</span>,</span><br><span class="line">    Complete,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">count_for</span>(map: &amp;HashMap&lt;<span class="type">String</span>, Progress&gt;, value: Progress) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> map.<span class="title function_ invoke__">values</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> val == &amp;value &#123;</span><br><span class="line">            count += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">count_iterator</span>(map: &amp;HashMap&lt;<span class="type">String</span>, Progress&gt;, value: Progress) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    <span class="comment">// map is a hashmap with String keys and Progress values.</span></span><br><span class="line">    <span class="comment">// map = &#123; &quot;variables1&quot;: Complete, &quot;from_str&quot;: None, ... &#125;</span></span><br><span class="line">    map.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">filter</span>(|v| *v.<span class="number">1</span> == value).<span class="title function_ invoke__">count</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">count_collection_for</span>(collection: &amp;[HashMap&lt;<span class="type">String</span>, Progress&gt;], value: Progress) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">map</span> <span class="keyword">in</span> collection &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> map.<span class="title function_ invoke__">values</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> val == &amp;value &#123;</span><br><span class="line">                count += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">count_collection_iterator</span>(collection: &amp;[HashMap&lt;<span class="type">String</span>, Progress&gt;], value: Progress) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    <span class="comment">// collection is a slice of hashmaps.</span></span><br><span class="line">    <span class="comment">// collection = [&#123; &quot;variables1&quot;: Complete, &quot;from_str&quot;: None, ... &#125;,</span></span><br><span class="line">    <span class="comment">//     &#123; &quot;variables2&quot;: Complete, ... &#125;, ... ]</span></span><br><span class="line">    collection</span><br><span class="line">        .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|vals| vals.<span class="title function_ invoke__">values</span>().<span class="title function_ invoke__">filter</span>(|val| *val == &amp;value).<span class="title function_ invoke__">count</span>())</span><br><span class="line">        .<span class="title function_ invoke__">sum</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>迭代器就好像是现实世界的水管，现实世界中，水管是标准化的接口，打开水管就可以出水。厨房用水可能需要加热，洗澡间用水可能需要冷热混合，淋浴花洒可能需要将水分割成若干个小水流。干这些事情的，我们称之为适配器。</p>
<p>filter_map 适配器是个非常有用的适配器，它有点像 filter 和 map 的结合体。我们有时候遍历 Result 类型的迭代器的时候，有时候，可能会有失败的情况，我们就用 filter_map 来忽略失败的项。</p>
<h4 id="疑问-3"><a href="#疑问-3" class="headerlink" title="疑问"></a>疑问</h4><p>再了解迭代器。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">collection</span><br><span class="line">    .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|vals| vals.<span class="title function_ invoke__">values</span>().<span class="title function_ invoke__">filter</span>(|val| *val == &amp;value).<span class="title function_ invoke__">count</span>())</span><br><span class="line">    .<span class="title function_ invoke__">sum</span>()</span><br></pre></td></tr></table></figure>

<h4 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h4><p><a target="_blank" rel="noopener" href="https://kaisery.github.io/trpl-zh-cn/ch15-04-rc.html">https://kaisery.github.io/trpl-zh-cn/ch15-04-rc.html</a></p>
<h2 id="76-smart-pointers-box1-rs"><a href="#76-smart-pointers-box1-rs" class="headerlink" title="76 smart_pointers&#x2F;box1.rs"></a>76 smart_pointers&#x2F;box1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, <span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;This is an empty cons list: &#123;:?&#125;&quot;</span>, <span class="title function_ invoke__">create_empty_list</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;This is a non-empty cons list: &#123;:?&#125;&quot;</span>, <span class="title function_ invoke__">create_non_empty_list</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_empty_list</span>() <span class="punctuation">-&gt;</span> List &#123;</span><br><span class="line">    List::Nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_non_empty_list</span>() <span class="punctuation">-&gt;</span> List &#123;</span><br><span class="line">    List::<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(List::Nil))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="77-smart-pointers-rc1-rs"><a href="#77-smart-pointers-rc1-rs" class="headerlink" title="77 smart_pointers&#x2F;rc1.rs"></a>77 smart_pointers&#x2F;rc1.rs</h2><p>调用Rc::clone()增加引用计数，drop()删除引用计数。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Sun</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Planet</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Mercury</span>(Rc&lt;Sun&gt;),</span><br><span class="line">    <span class="title function_ invoke__">Venus</span>(Rc&lt;Sun&gt;),</span><br><span class="line">    <span class="title function_ invoke__">Earth</span>(Rc&lt;Sun&gt;),</span><br><span class="line">    <span class="title function_ invoke__">Mars</span>(Rc&lt;Sun&gt;),</span><br><span class="line">    <span class="title function_ invoke__">Jupiter</span>(Rc&lt;Sun&gt;),</span><br><span class="line">    <span class="title function_ invoke__">Saturn</span>(Rc&lt;Sun&gt;),</span><br><span class="line">    <span class="title function_ invoke__">Uranus</span>(Rc&lt;Sun&gt;),</span><br><span class="line">    <span class="title function_ invoke__">Neptune</span>(Rc&lt;Sun&gt;),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Planet</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">details</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Hi from &#123;:?&#125;!&quot;</span>, <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sun</span> = Rc::<span class="title function_ invoke__">new</span>(Sun &#123;&#125;);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 1 reference</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mercury</span> = Planet::<span class="title function_ invoke__">Mercury</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;2. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 2 references</span></span><br><span class="line">    mercury.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">venus</span> = Planet::<span class="title function_ invoke__">Venus</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;3. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 3 references</span></span><br><span class="line">    venus.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">earth</span> = Planet::<span class="title function_ invoke__">Earth</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;4. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 4 references</span></span><br><span class="line">    earth.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mars</span> = Planet::<span class="title function_ invoke__">Mars</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;5. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 5 references</span></span><br><span class="line">    mars.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">jupiter</span> = Planet::<span class="title function_ invoke__">Jupiter</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;6. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 6 references</span></span><br><span class="line">    jupiter.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">saturn</span> = Planet::<span class="title function_ invoke__">Saturn</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;7. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 7 references</span></span><br><span class="line">    saturn.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">uranus</span> = Planet::<span class="title function_ invoke__">Uranus</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;8. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 8 references</span></span><br><span class="line">    uranus.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">neptune</span> = Planet::<span class="title function_ invoke__">Neptune</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;sun));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;9. reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 9 references</span></span><br><span class="line">    neptune.<span class="title function_ invoke__">details</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun), <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(neptune);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 8 references</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(uranus);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 7 references</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(saturn);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 6 references</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(jupiter);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 5 references</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(mars);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 4 references</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(earth);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 3 references</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(venus);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 2 references</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(mercury);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;reference count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun)); <span class="comment">// 1 reference</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(Rc::<span class="title function_ invoke__">strong_count</span>(&amp;sun), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="78-smart-pointers-arc1-rs"><a href="#78-smart-pointers-arc1-rs" class="headerlink" title="78 smart_pointers&#x2F;arc1.rs"></a>78 smart_pointers&#x2F;arc1.rs</h2><p>所谓智能指针，并不是说指针是智能的，它其实是对原生指针的一种封装，这种封装通过引用计数器的方法来判断指针是否还在使用，从而自动的管理指针对应的内存资源回收。</p>
<p>在Rust中，最初级的智能指针可以算是 Box，它提供了类似于其它语言的<code>装箱操作</code>，它在堆上提供简单的复制操作。其所有权的语义取决于其封装的对象的类型。其针对单一所有权，如果基础类型实现了 copy，那么它就是拷贝，否则就是Move。</p>
<p>如果感兴趣可以尝试着去实现一个基础的链表，会发现在实现的过程中Rust对Box的一些用法。</p>
<p> a atomic，所以这是一个 原子引用计数（atomically reference counted）类型。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::Arc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span>: <span class="type">Vec</span>&lt;_&gt; = (<span class="number">0</span>…<span class="number">100u32</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 引用计数指针, 指向一个 Vec</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">shared_numbers</span> = Arc::<span class="title function_ invoke__">new</span>(numbers);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环创建 10 个线程</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>…<span class="number">10</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 复制引用计数指针,所有的 Arc 都指向同一个 Vec</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">child_numbers</span> = shared_numbers.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// move修饰闭包,上面这个 Arc 指针被 move 进入了新线程中</span></span><br><span class="line">        thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="comment">// 我们可以在新线程中使用 Arc,读取共享的那个 Vec</span></span><br><span class="line">            <span class="keyword">let</span> <span class="variable">local_numbers</span> = &amp;child_numbers[…];</span><br><span class="line">            <span class="comment">// 继续使用 Vec 中的数据</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个实验中，给定一个 u32 的 Vec，称其 numbers，值从 0 到 99。</p>
<p>我们希望在 8 个不同的线程中同时使用这组数字。</p>
<p>每一个线程会获得总和的 1&#x2F;8，带有偏移：</p>
<p>对于第一个线程（offset 0），会对 0, 8, 16, … 求和<br>对于第二个线程（offset 1），会对 1, 9, 17, … 求和<br>对于第三个线程（offset 2），会对 2, 10, 18, … 求和<br>…<br>对于第八个线程（offset 7），会对 7, 15, 23, … 求和</p>
<p>因为我们使用了线程，我们的值需要是线程安全的。因此，我们使用 Arc。</p>
<p>通过填充第一个 TODO 所在的 shared_numbers 使代码通过编译，在第二个 TODO 所在的位置为 child_numbers 创建初始绑定。尽量不要创建 numbers Vec 的任何复制。</p>
<p>有关 Arc 的知识，参考原子引用计数 Arc<T> 和 Struct std::sync::Arc。它的本质就是对Rc<T> 引用计数智能指针 的一种重构，使得它可以安全的用于并发环境。</p>
<p>shared_numbers 通过 Arc 创建引用计数的 numbers，在下面的循环中，child_numbers 每通过 Arc clone 一次，shared_numbers 的引用计数就会加一。</p>
<p>在计算 sum 时，filter 会获取满足 *n % 8 &#x3D;&#x3D; offset 的数字并求和，最终输出。为了避免创建 numbers 的 copy，我们需要在 main 线程中创建 child_numbers，而不是在子线程中。</p>
<p>文件名：src&#x2F;main.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::&#123;Arc, Mutex&#125;;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">counter</span> = Arc::<span class="title function_ invoke__">new</span>(Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">counter</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;counter);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">            *num += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, *counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 16-15: 使用 Arc<T> 包装一个 Mutex<T> 能够实现在多线程之间共享所有权</p>
<p>这会打印出：</p>
<p>Result: 10</p>
<p>成功了！我们从 0 数到了 10，这可能并不是很显眼，不过一路上我们确实学习了很多关于 Mutex<T> 和线程安全的内容！这个例子中构建的结构可以用于比增加计数更为复杂的操作。使用这个策略，可将计算分成独立的部分，分散到多个线程中，接着使用 Mutex<T> 使用各自的结算结果更新最终的结果。</p>
<p>注意如果是简单的数值运算，标准库中 std::sync::atomic 模块 提供的比 Mutex<T> 更简单的类型。这些类型提供了基本类型之上安全、并发、原子的操作。这个例子中选择在基本类型上使用 Mutex<T> 以便我们可以专注于 Mutex<T> 如何工作。</p>
<h2 id="79-smart-pointers-cow1-rs"><a href="#79-smart-pointers-cow1-rs" class="headerlink" title="79 smart_pointers&#x2F;cow1.rs"></a>79 smart_pointers&#x2F;cow1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::borrow::Cow;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">abs_all</span>&lt;<span class="symbol">&#x27;a</span>, <span class="symbol">&#x27;b</span>&gt;(input: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> Cow&lt;<span class="symbol">&#x27;b</span>, [<span class="type">i32</span>]&gt;) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> Cow&lt;<span class="symbol">&#x27;b</span>, [<span class="type">i32</span>]&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..input.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">v</span> = input[i];</span><br><span class="line">        <span class="keyword">if</span> v &lt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// Clones into a vector if not already owned.</span></span><br><span class="line">            input.<span class="title function_ invoke__">to_mut</span>()[i] = -v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    input</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">reference_mutation</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// Clone occurs because `input` needs to be mutated.</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">slice</span> = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span> = Cow::<span class="title function_ invoke__">from</span>(&amp;slice[..]);</span><br><span class="line">        <span class="keyword">match</span> <span class="title function_ invoke__">abs_all</span>(&amp;<span class="keyword">mut</span> input) &#123;</span><br><span class="line">            Cow::<span class="title function_ invoke__">Owned</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(()),</span><br><span class="line">            _ =&gt; <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Expected owned value&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">reference_no_mutation</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// No clone occurs because `input` doesn&#x27;t need to be mutated.</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">slice</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span> = Cow::<span class="title function_ invoke__">from</span>(&amp;slice[..]);</span><br><span class="line">        <span class="keyword">match</span> <span class="title function_ invoke__">abs_all</span>(&amp;<span class="keyword">mut</span> input) &#123;</span><br><span class="line">            Cow::<span class="title function_ invoke__">Borrowed</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(()),</span><br><span class="line">            _ =&gt; <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Expected borrowed value&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">owned_no_mutation</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// We can also pass `slice` without `&amp;` so Cow owns it directly. In this</span></span><br><span class="line">        <span class="comment">// case no mutation occurs and thus also no clone, but the result is</span></span><br><span class="line">        <span class="comment">// still owned because it was never borrowed or mutated.</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">slice</span> = <span class="built_in">vec!</span>[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span> = Cow::<span class="title function_ invoke__">from</span>(slice);</span><br><span class="line">        <span class="keyword">match</span> <span class="title function_ invoke__">abs_all</span>(&amp;<span class="keyword">mut</span> input) &#123;</span><br><span class="line">            Cow::<span class="title function_ invoke__">Owned</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(()),</span><br><span class="line">            _ =&gt; <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Expected borrowed value&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">owned_mutation</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// Of course this is also the case if a mutation does occur. In this</span></span><br><span class="line">        <span class="comment">// case the call to `to_mut()` returns a reference to the same data as</span></span><br><span class="line">        <span class="comment">// before.</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">slice</span> = <span class="built_in">vec!</span>[-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span> = Cow::<span class="title function_ invoke__">from</span>(slice);</span><br><span class="line">        <span class="keyword">match</span> <span class="title function_ invoke__">abs_all</span>(&amp;<span class="keyword">mut</span> input) &#123;</span><br><span class="line">            Cow::<span class="title function_ invoke__">Owned</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(()),</span><br><span class="line">            _ =&gt; <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Expected borrowed value&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="疑问-4"><a href="#疑问-4" class="headerlink" title="疑问"></a>疑问</h4><p>不懂该题的背景。</p>
<p>cow大致是在解决引用类型数据的所有权与可修改有时会发生矛盾的问题（处理借用和所有权转移），cow写时复制，当不修改内容时，就返回不可变引用；修改内容时，复制一份产生可变引用。具体来说：</p>
<ul>
<li>to_mut()方法的作用是获取数据的可变引用，如果数据当前处于Owned状态，则直接返回对该数据的可变引用；否则，通过克隆数据来获取可变引用，并将数据的所有权转移为Owned状态。</li>
<li>具体来说，如果Cow当前处于Borrowed状态，则说明Cow的底层数据目前并不拥有所有权。此时调用to_mut()方法将克隆数据并返回对其的可变引用，从而获取了底层数据的所有权。此后，对返回的可变引用进行的修改将直接反映在底层数据上。</li>
</ul>
<h2 id="80-thread-thread1-rs"><a href="#80-thread-thread1-rs" class="headerlink" title="80 thread&#x2F;thread1.rs"></a>80 thread&#x2F;thread1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">start</span> = Instant::<span class="title function_ invoke__">now</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">250</span>));</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;thread &#123;&#125; is complete&quot;</span>, i);</span><br><span class="line">            start.<span class="title function_ invoke__">elapsed</span>().<span class="title function_ invoke__">as_millis</span>()</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">results</span>: <span class="type">Vec</span>&lt;<span class="type">u128</span>&gt; = <span class="built_in">vec!</span>[];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        results.<span class="title function_ invoke__">push</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> results.<span class="title function_ invoke__">len</span>() != <span class="number">10</span> &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">&quot;Oh no! All the spawned threads did not finish!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>();</span><br><span class="line">    <span class="keyword">for</span> (i, result) <span class="keyword">in</span> results.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;thread &#123;&#125; took &#123;&#125;ms&quot;</span>, i, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>rust 并没有像 golang 采用大道至简的方式，而是选择了多线程与 async&#x2F;await 相结合，优点是可控性更强、性能更高，缺点是复杂度不低。</p>
<p>move 关键字经常用于传递给 thread::spawn 的闭包，因为闭包会获取从环境中取得的值的所有权。</p>
<p>定义一个可变的 handles 向量来存储所有的线程句柄。接下来，使用一个循环来创建 10 个线程。当线程启动时，它会获取当前时间戳并存储在 start 变量中，当它完成时，它会再次获取当前时间戳，并计算时间差。然后，在 vector 中存储该时间差。</p>
<p>接下来，我们使用一个循环来等待每个线程完成，然后从其返回值中提取时间差，并将其存储在vector中。如果任何线程不能成功地join，则程序将崩溃并显示错误消息。</p>
<h2 id="81-threads-threads2-rs"><a href="#81-threads-threads2-rs" class="headerlink" title="81 threads&#x2F;threads2.rs"></a>81 threads&#x2F;threads2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">JobStatus</span> &#123;</span><br><span class="line">    jobs_completed: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">status</span> = Arc::<span class="title function_ invoke__">new</span>(Mutex::<span class="title function_ invoke__">new</span>(JobStatus &#123; jobs_completed: <span class="number">0</span> &#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">status_shared</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;status);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">250</span>));</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> You must take an action before you update a shared value</span></span><br><span class="line">            status_shared.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().jobs_completed += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Print the value of the JobStatus.jobs_completed. Did you notice</span></span><br><span class="line">        <span class="comment">// anything interesting in the output? Do you have to &#x27;join&#x27; on all the</span></span><br><span class="line">        <span class="comment">// handles?</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;jobs completed &#123;&#125;&quot;</span>, status.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().jobs_completed);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本题是关于“多线程和多所有权”。</p>
<p>Go 编程语言文档中口号的这一部分：“不要通过共享内存来通讯”。</p>
<p>任何编程语言中的信道都类似于单所有权，因为一旦将一个值传送到信道中，将无法再使用这个值。共享内存类似于多所有权：多个线程可以同时访问相同的内存位置。</p>
<h4 id="疑问-5"><a href="#疑问-5" class="headerlink" title="疑问"></a>疑问</h4><p>该程序还不明白，本程序中出现了两句相似的语句。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">status_shared.lock().unwrap().jobs_completed += 1;</span><br><span class="line">status.lock().unwrap().jobs_completed</span><br></pre></td></tr></table></figure>

<h4 id="背景了解：智能指针"><a href="#背景了解：智能指针" class="headerlink" title="背景了解：智能指针"></a>背景了解：智能指针</h4><p>智能指针（smart pointers）是一类数据结构，他们的表现类似指针，但是也拥有额外的元数据和功能。</p>
<p>在 Rust 中，普通引用和智能指针的一个额外的区别是引用是一类只借用数据的指针；相反，在大部分情况下，智能指针 拥有 他们指向的数据。Rust现存的智能指针很多，这里会研究其中4种智能指针：</p>
<p>Box<T>，用于在堆上分配值<br>Rc<T>，(reference counter) 一个引用计数类型，其数据可以有多个所有者。<br>Arc<T>，(atomic reference counter) 可被多线程操作，但只能只读。<br>Mutex<T>，互斥指针，能保证修改的时候只有一个线程参与。</p>
<h4 id="1-Box指针"><a href="#1-Box指针" class="headerlink" title="1. Box指针"></a>1. Box指针</h4><p>第8章给出了一个错误版本，其中比较重要的部分是因为我们的变量p在多线程环境下被分配到了每个线程的栈内存中，根据rust所有权的机制，它在线程间不断的move，这样的变量是无法满足我们的要求的。因此，我们希望变量能够被储存在堆上。</p>
<p>定义一个Box包装变量：</p>
<p>let mut p &#x3D; Box::new(Point { x: 1, y: 2 });<br>解引用<br>前面一直说引用&amp;，那么如何读出引用的值，就需要解引用*。因此，读取Box变量的写法：</p>
<p>println!(“{}”, (*p).x);<br>执行成功。这里要注意解引用时要加括号，否则会作用到x上面引发报错。</p>
<p><strong>Box变量虽然被强制分配在堆上，但它只能有一个所有权。所以还不是真正的共享。</strong></p>
<h4 id="2-Rc指针"><a href="#2-Rc指针" class="headerlink" title="2. Rc指针"></a>2. Rc指针</h4><p>Box指针修饰的变量只能保证强制被分配到堆上，但同一时间仍旧只能有一个所有权，不算真的共享。下面来学习Rc指针。Rc是一个引用计数智能指针，首先它修饰的变量也会分配在堆上，可以被多个变量所引用，智能指针会记录每个变量的引用，这就是引用计数的概念。下面看一下如何编写使用Rc智能指针。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = Rc::<span class="title function_ invoke__">new</span>(Point &#123; x: <span class="number">1</span>, y: <span class="number">2</span> &#125;);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = Rc::<span class="title function_ invoke__">clone</span>(&amp;p);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = Rc::<span class="title function_ invoke__">clone</span>(&amp;p);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;,&#123;&#125;&quot;</span>, p.x, p1.x, p2.x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、首先变量p被指定由Rc所包装。</p>
<p>2、接着，p1和p2都是由p的引用克隆而来，所以他们都指向p的内存。</p>
<p>3、尝试打印p和p1,p2的x坐标的值，我们用Box指针的话，这样是不行的，一定会报错。但是Rc指针是可以的。</p>
<p>执行成功，打印出1,1,1。</p>
<p>Rc智能指针学习到这里，看上去是可以满足我们的多线程修改共享变量的目的，那我们捡起来之前的rust代码，并将p修改为Rc智能指针所修饰，再去执行一下做个试验。</p>
<p>error[E0277]: Rc<Point> cannot be sent between threads safely</p>
<p>结果是不行的，报错提示了，<strong>说明Rc指针不能保证线程安全，因此只能在单线程中使用。</strong> 看来Rc指针是不能满足我们的需求了。下面我们继续来学习Arc指针。</p>
<h4 id="3-Arc指针"><a href="#3-Arc指针" class="headerlink" title="3. Arc指针"></a>3. Arc指针</h4><p>Arc指针是比Rc多了一个Atomic的限定词语，这是原子的意思。熟悉多线程的朋友应该了解，原子性代表了一种线程安全的特性。那么它该如何使用，是否能满足我们的要求呢？我们来编写一下。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = Arc::<span class="title function_ invoke__">new</span>(Point &#123; x: <span class="number">1</span>, y: <span class="number">2</span> &#125;);</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">p1</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;p);</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>, i, p1.x);</span><br><span class="line">    <span class="comment">// p.x += 1;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">  handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;TODO: panic message&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, p.x);</span><br></pre></td></tr></table></figure>

<p>1、我们修改了第1行p为Arc的修饰。</p>
<p>2、然后第4行增加了对p的引用的克隆。这是在循环体内执行的，保证每个线程都能有单独的变量使用，同时借由Arc的特性，这些变量都共同指向了同一个内存值。</p>
<p>3、我们注释掉了第7行对于共享变量的修改操作，否则会报错：error[E0594]: cannot assign to data in an Arc</p>
<p>总结一下，<strong>Arc智能指针继承了Rc的能力，同时又能够满足多线程下的操作，使得变量真正成为共享变量。然而Arc不能被修改，是只读权限</strong>，这就无法满足我们要修改的需求。我们距离目标越来越近了。</p>
<h4 id="4-Mutex指针"><a href="#4-Mutex指针" class="headerlink" title="4. Mutex指针"></a>4. Mutex指针</h4><p>下面来介绍Mutex指针，它是专门为修改共享变量而生的。Mutex指针能够保证同一时间下，只有一个线程可以对变量进行修改，其他线程必须等待当前线程修改完毕方可进行修改。</p>
<p>Mutex指针的功能描述，与java的多线程上锁的过程很相似。可变不共享，共享不可变。</p>
<p>下面我们在之前的基础上尝试修改：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = Mutex::<span class="title function_ invoke__">new</span>(Point &#123; x: <span class="number">1</span>, y: <span class="number">2</span> &#125;);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="comment">// let p1 = Arc::clone(&amp;p);</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p0</span> = p.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>, i, p0.x);</span><br><span class="line">            p0.x += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;TODO: panic message&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, p.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、首先第2行我们将p改为用Mutex指针修饰。</p>
<p>2、第7行要注意，Mutex 之所以能够是互斥，因为它内部是通过锁机制来实现了多线程下的线程安全。所以这里要先得到p的锁即 p.lock()，然后再解包装，就能得到里面的值。我们将它复制给 p0。</p>
<p>3、最后打印的时候也要注意同样的写法。</p>
<p>那么这段代码的执行仍旧是失败，报错提示error[E0382]: use of moved value: p。</p>
<p>其实<strong>问题还是出在了共享变量上，Mutex单独修饰的变量并不是共享变量，因为它的所有权在同一时间仍旧是只有一个，也就是说这里其实缺少了Rc的能力。</strong></p>
<h5 id="终版"><a href="#终版" class="headerlink" title="终版"></a>终版</h5><p>前面我们学习了4种智能指针，<strong>Box和Rc首先被淘汰</strong>，因为他们距离我们的需求都比较遥远，但是他们两个的学习可以很有效地帮助我们学习其他的智能指针。而Arc和Mutex这两个智能指针在编写代码的时候，总是感觉跟我们的目标擦肩而过。那么我们可以想一想，如果<strong>使用Arc来包装Mutex指针，然后Mutex指针再包装一层变量。</strong> 这样我们就可以既满足多线程下修改的线程安全，同时又能够克隆出来多个变量的引用，共同指向同一内存。下面就来实现一下本文题目的最终版本。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::&#123;Arc, Mutex&#125;;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = Arc::<span class="title function_ invoke__">new</span>(Mutex::<span class="title function_ invoke__">new</span>(Point &#123; x: <span class="number">1</span>, y: <span class="number">2</span> &#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">pp</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;p);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p0</span> = pp.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;thread-&#123;&#125;::&#123;&#125;&quot;</span>, i, p0.x);</span><br><span class="line">            p0.x += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;TODO: panic message&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;total: &#123;&#125;&quot;</span>, p.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>().x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正如前面分析的，</p>
<p>1、我们在第10行将变量p先用Mutex包装一层，然后在外层再使用Arc智能指针包装一层。</p>
<p>2、第13行，我们在循环体内，子线程外，给变量p克隆出一个pp。</p>
<p>3、第15行，我们使用pp.lock().unwrap()得到Mutex包装的变量值。</p>
<p>4、后面就是对于p0在子线程中的操作。</p>
<p>最后打印出来p的x坐标，执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">thread-0::1</span><br><span class="line">thread-1::2</span><br><span class="line">thread-4::3</span><br><span class="line">thread-3::4</span><br><span class="line">thread-2::5</span><br><span class="line">thread-5::6</span><br><span class="line">thread-6::7</span><br><span class="line">thread-7::8</span><br><span class="line">thread-8::9</span><br><span class="line">thread-9::10</span><br><span class="line">total: 11</span><br></pre></td></tr></table></figure>
<p>共享变量p的x坐标值被10个线程所修改，每个线程都对其进行了加1操作，最终该共享变量p的x坐标变为了11，结果符合预期。</p>
<h2 id="82-threads-threads3-rs"><a href="#82-threads-threads3-rs" class="headerlink" title="82 threads&#x2F;threads3.rs"></a>82 threads&#x2F;threads3.rs</h2><p>任何编程语言中的信道都类似于单所有权，因为一旦将一个值传送到信道中，将无法再使用这个值。共享内存类似于多所有权：多个线程可以同时访问相同的内存位置。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Queue</span> &#123;</span><br><span class="line">    length: <span class="type">u32</span>,</span><br><span class="line">    first_half: <span class="type">Vec</span>&lt;<span class="type">u32</span>&gt;,</span><br><span class="line">    second_half: <span class="type">Vec</span>&lt;<span class="type">u32</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Queue</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Queue &#123;</span><br><span class="line">            length: <span class="number">10</span>,</span><br><span class="line">            first_half: <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">            second_half: <span class="built_in">vec!</span>[<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">send_tx</span>(q: Queue, tx: mpsc::Sender&lt;<span class="type">u32</span>&gt;) <span class="punctuation">-&gt;</span> () &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">qc</span> = Arc::<span class="title function_ invoke__">new</span>(q);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">qc1</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;qc);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">qc2</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;qc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tx1</span> = mpsc::Sender::<span class="title function_ invoke__">clone</span>(&amp;tx);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tx2</span> = mpsc::Sender::<span class="title function_ invoke__">clone</span>(&amp;tx);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> &amp;qc1.first_half &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;sending &#123;:?&#125;&quot;</span>, val);</span><br><span class="line">            tx1.<span class="title function_ invoke__">send</span>(*val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> &amp;qc2.second_half &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;sending &#123;:?&#125;&quot;</span>, val);</span><br><span class="line">            tx2.<span class="title function_ invoke__">send</span>(*val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">queue</span> = Queue::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">queue_length</span> = queue.length;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">send_tx</span>(queue, tx);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">total_received</span>: <span class="type">u32</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Got: &#123;&#125;&quot;</span>, received);</span><br><span class="line">        total_received += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;total numbers received: &#123;&#125;&quot;</span>, total_received);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(total_received, queue_length)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该程序添加了下面两句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let tx1 = mpsc::Sender::clone(&amp;tx);</span><br><span class="line">let tx2 = mpsc::Sender::clone(&amp;tx);</span><br></pre></td></tr></table></figure>

<p>In the code you provided, <code>tx</code> is cloned to ensure that each spawned thread has its own copy of the sender, allowing them to send data concurrently without data races. This is a common pattern when working with Rust’s <code>mpsc</code> (multi-producer, single-consumer) channels.</p>
<p>Here’s why you need to clone <code>tx</code>:</p>
<ol>
<li><p><strong>Ownership and Concurrency</strong>: In Rust, ownership rules prevent multiple threads from directly accessing the same data. To send data through a channel, you need to have ownership of the sender. By cloning <code>tx</code>, you are effectively creating a separate sender for each thread, ensuring that each thread has exclusive ownership of its sender.</p>
</li>
<li><p><strong>Message Passing</strong>: Each thread will send messages through its own sender (<code>tx1</code> and <code>tx2</code>) without conflicting with the other threads. If you shared the same sender across multiple threads, you could have race conditions and undefined behavior when they try to send messages concurrently.</p>
</li>
<li><p><strong>Cloning is Cheap for Senders</strong>: Cloning a sender (<code>Sender</code>) in Rust is a cheap operation because it doesn’t involve deep copying of data but rather increments the reference count for the underlying channel. It allows multiple threads to send messages through the same channel simultaneously.</p>
</li>
</ol>
<p>So, cloning <code>tx</code> is a common practice in multi-threaded Rust code when you want each thread to have its own sender for concurrent message passing while avoiding data races.</p>
<h2 id="083-macros-macros1-rs"><a href="#083-macros-macros1-rs" class="headerlink" title="083 macros&#x2F;macros1.rs"></a>083 macros&#x2F;macros1.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> my_macro &#123;</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Check out my macro!&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    my_macro!();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从根本上来说，宏是通过一种代码来生成另一种代码。</p>
<p>声明宏（declarative macros）声明宏允许我们编写一些类似 Rust match 表达式的代码。</p>
<h2 id="084-macros-macros2-rs"><a href="#084-macros-macros2-rs" class="headerlink" title="084 macros&#x2F;macros2.rs"></a>084 macros&#x2F;macros2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> my_macro &#123;</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Check out my macro!&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    my_macro!();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="085-macros-macros3-rs"><a href="#085-macros-macros3-rs" class="headerlink" title="085 macros&#x2F;macros3.rs"></a>085 macros&#x2F;macros3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> macros &#123;</span><br><span class="line">    <span class="built_in">macro_rules!</span> my_macro &#123;</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Check out my macro!&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    my_macro!();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="086-macros-macros4-rs"><a href="#086-macros-macros4-rs" class="headerlink" title="086 macros&#x2F;macros4.rs"></a>086 macros&#x2F;macros4.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> my_macro &#123;</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Check out my macro!&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    ($val:expr) =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Look at this other macro: &#123;&#125;&quot;</span>, $val);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    my_macro!();</span><br><span class="line">    my_macro!(<span class="number">7777</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="087-clippy-clippy1-rs"><a href="#087-clippy-clippy1-rs" class="headerlink" title="087 clippy&#x2F;clippy1.rs"></a>087 clippy&#x2F;clippy1.rs</h2><p>clippy1:参考 <a target="_blank" rel="noopener" href="https://rust-lang.github.io/rust-clippy/master/index.html#approx_constant%EF%BC%8C%E5%BD%93%E6%A3%80%E6%9F%A5%E5%88%B0%E8%BF%91%E4%BC%BC%E4%BA%8E">https://rust-lang.github.io/rust-clippy/master/index.html#approx_constant，当检查到近似于</a> std::f32::consts 或 std::f64::consts 的常量时就会报错。因为默认 #[deny(clippy::approx_constant)] 选项是开启的。我们可以用 f32::consts::PI 替代</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let pi = f32::consts::PI;</span><br></pre></td></tr></table></figure>

<h2 id="088-clippy-clippy2-rs"><a href="#088-clippy-clippy2-rs" class="headerlink" title="088 clippy&#x2F;clippy2.rs"></a>088 clippy&#x2F;clippy2.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">res</span> = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">option</span> = <span class="title function_ invoke__">Some</span>(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(x) = option &#123;</span><br><span class="line">        res += x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="089-clippy-clippy3-rs"><a href="#089-clippy-clippy3-rs" class="headerlink" title="089 clippy&#x2F;clippy3.rs"></a>089 clippy&#x2F;clippy3.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(unused_variables, unused_assignments)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_option</span>: <span class="type">Option</span>&lt;()&gt; = <span class="literal">None</span>;</span><br><span class="line">    <span class="comment">//if my_option.is_none() &#123;</span></span><br><span class="line">    <span class="comment">//    my_option.unwrap();</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_arr</span> = &amp;[</span><br><span class="line">        -<span class="number">1</span>, -<span class="number">2</span>, -<span class="number">3</span>,</span><br><span class="line">        -<span class="number">4</span>, -<span class="number">5</span>, -<span class="number">6</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;My array! Here it is: &#123;:?&#125;&quot;</span>, my_arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">my_empty_vec</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">    my_empty_vec.<span class="title function_ invoke__">clear</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;This Vec is empty, see? &#123;:?&#125;&quot;</span>, my_empty_vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">value_a</span> = <span class="number">45</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">value_b</span> = <span class="number">66</span>;</span><br><span class="line">    <span class="comment">// Let&#x27;s swap these two!</span></span><br><span class="line">    <span class="comment">//value_a = value_b;</span></span><br><span class="line">    <span class="comment">//value_b = value_a;</span></span><br><span class="line">    std::mem::<span class="title function_ invoke__">swap</span>(&amp;<span class="keyword">mut</span> value_a, &amp;<span class="keyword">mut</span> value_b);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;value a: &#123;&#125;; value b: &#123;&#125;&quot;</span>, value_a, value_b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="090-conversions-using-as-rs"><a href="#090-conversions-using-as-rs" class="headerlink" title="090 conversions&#x2F;using_as.rs"></a>090 conversions&#x2F;using_as.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">average</span>(values: &amp;[<span class="type">f64</span>]) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">total</span> = values.<span class="title function_ invoke__">iter</span>().sum::&lt;<span class="type">f64</span>&gt;();</span><br><span class="line">    total / values.<span class="title function_ invoke__">len</span>() <span class="keyword">as</span> <span class="type">f64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">values</span> = [<span class="number">3.5</span>, <span class="number">0.3</span>, <span class="number">13.0</span>, <span class="number">11.7</span>];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="title function_ invoke__">average</span>(&amp;values));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Rust 中内置了一些基本类型之间的转换，使用 as 操作符来完成。</p>
<h2 id="091-conversions-from-into-rs"><a href="#091-conversions-from-into-rs" class="headerlink" title="091 conversions&#x2F;from_into.rs"></a>091 conversions&#x2F;from_into.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">usize</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// We implement the Default trait to use it as a fallback</span></span><br><span class="line"><span class="comment">// when the provided string is not convertible into a Person object</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Default</span> <span class="keyword">for</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">default</span>() <span class="punctuation">-&gt;</span> Person &#123;</span><br><span class="line">        Person &#123;</span><br><span class="line">            name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;John&quot;</span>),</span><br><span class="line">            age: <span class="number">30</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Your task is to complete this implementation in order for the line `let p = Person::from(&quot;Mark,20&quot;)` to compile Please note that you&#x27;ll need to parse the</span></span><br><span class="line"><span class="comment">// age component into a `usize` with something like `&quot;4&quot;.parse::&lt;usize&gt;()`.</span></span><br><span class="line"><span class="comment">// The outcome of this needs to be handled appropriately.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Steps:</span></span><br><span class="line"><span class="comment">// 1. If the length of the provided string is 0, then return the default of Person.</span></span><br><span class="line"><span class="comment">// 2. Split the given string on the commas present in it.</span></span><br><span class="line"><span class="comment">// 3. Extract the first element from the split operation and use it as the name.</span></span><br><span class="line"><span class="comment">// 4. If the name is empty, then return the default of Person.</span></span><br><span class="line"><span class="comment">// 5. Extract the other element from the split operation and parse it into a</span></span><br><span class="line"><span class="comment">//    `usize` as the age.</span></span><br><span class="line"><span class="comment">// If while parsing the age, something goes wrong, then return the default of</span></span><br><span class="line"><span class="comment">// Person Otherwise, then return an instantiated Person object with the results</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 首先检查输入字符串的长度，如果是0则返回默认的Person对象。这个步骤也可以直接使用 if s.is_empty()来代替。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2. 使用逗号分隔符将输入字符串分割成两个部分。这个步骤使用 s.split(&#x27;,&#x27;).collect()实现。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3. 提取分割后的第一个元素作为姓名（name）。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4. 如果姓名为空，则返回默认的Person对象。这个步骤可以直接使用 if name.is_empty()来判断。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5. 将分割后的第二部分作为字符串进行解析，得到年龄age，如果解析失败则返回默认的Person对象。这个步骤使用 parts[1].trim().parse::&lt;usize&gt;()来实现。trim()函数用于去除空格和换行符等。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">6. 如果所有步骤都成功，则返回一个新的Person对象，其姓名是name，年龄是age。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;&amp;<span class="type">str</span>&gt; <span class="keyword">for</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> Person &#123;</span><br><span class="line">        <span class="keyword">if</span> s.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">            Person::<span class="title function_ invoke__">default</span>()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">let</span> <span class="variable">parts</span>:<span class="type">Vec</span>&lt;&amp;<span class="type">str</span>&gt; = s.<span class="title function_ invoke__">split</span>(<span class="string">&quot;,&quot;</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">            <span class="keyword">if</span> parts.<span class="title function_ invoke__">len</span>() != <span class="number">2</span>&#123;</span><br><span class="line">                Person::<span class="title function_ invoke__">default</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">name</span> = parts[<span class="number">0</span>].<span class="title function_ invoke__">trim</span>();</span><br><span class="line">                <span class="keyword">if</span> name.<span class="title function_ invoke__">is_empty</span>()&#123;</span><br><span class="line">                    Person::<span class="title function_ invoke__">default</span>()</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Ok</span>(age) = parts[<span class="number">1</span>].<span class="title function_ invoke__">trim</span>().parse::&lt;<span class="type">usize</span>&gt;() &#123;</span><br><span class="line">                    Person&#123;name:<span class="type">String</span>::<span class="title function_ invoke__">from</span>(name),age&#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Person::<span class="title function_ invoke__">default</span>()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// Use the `from` function</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mark,20&quot;</span>);</span><br><span class="line">    <span class="comment">// Since From is implemented for Person, we should be able to use Into</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span>: Person = <span class="string">&quot;Gerald,70&quot;</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, p1);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, p2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_default</span>() &#123;</span><br><span class="line">        <span class="comment">// Test that the default person is 30 year old John</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">dp</span> = Person::<span class="title function_ invoke__">default</span>();</span><br><span class="line">        <span class="built_in">assert_eq!</span>(dp.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(dp.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_bad_convert</span>() &#123;</span><br><span class="line">        <span class="comment">// Test that John is returned when bad string is provided</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span> = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_good_convert</span>() &#123;</span><br><span class="line">        <span class="comment">// Test that &quot;Mark,20&quot; works</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span> = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mark,20&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;Mark&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_bad_age</span>() &#123;</span><br><span class="line">        <span class="comment">// Test that &quot;Mark,twenty&quot; will return the default person due to an</span></span><br><span class="line">        <span class="comment">// error in parsing age</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span> = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mark,twenty&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_missing_comma_and_age</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span>: Person = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mark&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_missing_age</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span>: Person = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mark,&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_missing_name</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span>: Person = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;,1&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_missing_name_and_age</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span>: Person = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_missing_name_and_invalid_age</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span>: Person = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;,one&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_trailing_comma</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span>: Person = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mike,32,&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_trailing_comma_and_some_string</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">p</span>: Person = Person::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mike,32,man&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.name, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(p.age, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let num = Number::from(30);</span><br><span class="line"></span><br><span class="line">let int = 5;</span><br><span class="line">let num: Number = int.into();</span><br></pre></td></tr></table></figure>

<p>from into 两个成对的函数的，在我看来，两者的功能一样，都是将 int 转换为 Number。<br>这是一个疑问，一样的功能，为什么要提出这么一个概念？</p>
<h2 id="092-conversions-from-str-rs"><a href="#092-conversions-from-str-rs" class="headerlink" title="092 conversions&#x2F;from_str.rs"></a>092 conversions&#x2F;from_str.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">usize</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// We will use this error type for the `FromStr` implementation.</span></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ParsePersonError</span> &#123;</span><br><span class="line">    <span class="comment">// Empty input string</span></span><br><span class="line">    Empty,</span><br><span class="line">    <span class="comment">// Incorrect number of fields</span></span><br><span class="line">    BadLen,</span><br><span class="line">    <span class="comment">// Empty name field</span></span><br><span class="line">    NoName,</span><br><span class="line">    <span class="comment">// Wrapped error from parse::&lt;usize&gt;()</span></span><br><span class="line">    <span class="title function_ invoke__">ParseInt</span>(ParseIntError),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Steps:</span></span><br><span class="line"><span class="comment">// 1. If the length of the provided string is 0, an error should be returned</span></span><br><span class="line"><span class="comment">// 2. Split the given string on the commas present in it</span></span><br><span class="line"><span class="comment">// 3. Only 2 elements should be returned from the split, otherwise return an error</span></span><br><span class="line"><span class="comment">// 4. Extract the first element from the split operation and use it as the name</span></span><br><span class="line"><span class="comment">// 5. Extract the other element from the split operation and parse it into a</span></span><br><span class="line"><span class="comment">//    `usize` as the age with something like `&quot;4&quot;.parse::&lt;usize&gt;()`</span></span><br><span class="line"><span class="comment">// 6. If while extracting the name and the age something goes wrong, an error</span></span><br><span class="line"><span class="comment">//    should be returned</span></span><br><span class="line"><span class="comment">// If everything goes well, then return a Result of a Person object</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// As an aside: `Box&lt;dyn Error&gt;` implements `From&lt;&amp;&#x27;_ str&gt;`. This means that if</span></span><br><span class="line"><span class="comment">// you want to return a string error message, you can do so via just using</span></span><br><span class="line"><span class="comment">// return `Err(&quot;my error message&quot;.into())`.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">FromStr</span> <span class="keyword">for</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Err</span> = ParsePersonError;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from_str</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;Person, <span class="keyword">Self</span>::<span class="literal">Err</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">match</span> s.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">            <span class="literal">true</span> =&gt; <span class="title function_ invoke__">Err</span>(ParsePersonError::Empty),</span><br><span class="line">            <span class="literal">false</span> =&gt;&#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">parts</span>:<span class="type">Vec</span>&lt;&amp;<span class="type">str</span>&gt; = s.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;,&#x27;</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">                <span class="keyword">match</span> parts.<span class="title function_ invoke__">len</span>() !=<span class="number">2</span> &#123;</span><br><span class="line">                    <span class="literal">true</span> =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(ParsePersonError::BadLen),</span><br><span class="line">                    <span class="literal">false</span> =&gt; &#123;</span><br><span class="line">                        <span class="keyword">let</span> <span class="variable">name</span> = parts[<span class="number">0</span>].<span class="title function_ invoke__">trim</span>();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> name.<span class="title function_ invoke__">is_empty</span>()&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(ParsePersonError::NoName);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">let</span> <span class="variable">number</span> = parts[<span class="number">1</span>].<span class="title function_ invoke__">parse</span>();</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(x) = number &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(ParsePersonError::<span class="title function_ invoke__">ParseInt</span>((x)))</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title function_ invoke__">Ok</span>(Person&#123;name:<span class="type">String</span>::<span class="title function_ invoke__">from</span>(name), age:number.<span class="title function_ invoke__">unwrap</span>()&#125;)</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = <span class="string">&quot;Mark,20&quot;</span>.parse::&lt;Person&gt;().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读完代码发现跟from_into的逻辑基本类似，只是将默认处理修改为了Err报错。由于测试test逻辑基本类似，所以基本不用大改，只是由于Err的类型，需要略微调整一下代码的顺序。</p>
<p>在实现 FromStr 时，可以在 Strings 上使用 parse 方法以生成实现者类型的对象。</p>
<h2 id="093-conversions-try-from-into-rs"><a href="#093-conversions-try-from-into-rs" class="headerlink" title="093 conversions&#x2F;try_from_into.rs"></a>093 conversions&#x2F;try_from_into.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::convert::&#123;TryFrom, TryInto&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    red: <span class="type">u8</span>,</span><br><span class="line">    green: <span class="type">u8</span>,</span><br><span class="line">    blue: <span class="type">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// We will use this error type for these `TryFrom` conversions.</span></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">IntoColorError</span> &#123;</span><br><span class="line">    <span class="comment">// Incorrect length of slice</span></span><br><span class="line">    BadLen,</span><br><span class="line">    <span class="comment">// Integer conversion error</span></span><br><span class="line">    IntConversion,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 您需要为三个整数的元组、三个整数的数组和一个整数切片创建一个实现。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Tuple implementation</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TryFrom</span>&lt;(<span class="type">i16</span>, <span class="type">i16</span>, <span class="type">i16</span>)&gt; <span class="keyword">for</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Error</span> = IntoColorError;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">try_from</span>(tuple: (<span class="type">i16</span>, <span class="type">i16</span>, <span class="type">i16</span>)) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="keyword">Self</span>, <span class="keyword">Self</span>::Error&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> [tuple.<span class="number">0</span>,tuple.<span class="number">1</span>,tuple.<span class="number">2</span>] &#123;</span><br><span class="line">            <span class="keyword">if</span> i &lt;<span class="number">0</span> || i&gt;<span class="number">255</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(IntoColorError::IntConversion);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(Color&#123;red:tuple.<span class="number">0</span> <span class="keyword">as</span> <span class="type">u8</span>, green:tuple.<span class="number">1</span> <span class="keyword">as</span> <span class="type">u8</span>, blue:tuple.<span class="number">2</span> <span class="keyword">as</span> <span class="type">u8</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array implementation</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TryFrom</span>&lt;[<span class="type">i16</span>; <span class="number">3</span>]&gt; <span class="keyword">for</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Error</span> = IntoColorError;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">try_from</span>(arr: [<span class="type">i16</span>; <span class="number">3</span>]) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="keyword">Self</span>, <span class="keyword">Self</span>::Error&gt; &#123;</span><br><span class="line">        Color::<span class="title function_ invoke__">try_from</span>((arr[<span class="number">0</span>],arr[<span class="number">1</span>],arr[<span class="number">2</span>]))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Slice implementation</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TryFrom</span>&lt;&amp;[<span class="type">i16</span>]&gt; <span class="keyword">for</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Error</span> = IntoColorError;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">try_from</span>(slice: &amp;[<span class="type">i16</span>]) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="keyword">Self</span>, <span class="keyword">Self</span>::Error&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> slice.<span class="title function_ invoke__">len</span>() != <span class="number">3</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(IntoColorError::BadLen)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Color::<span class="title function_ invoke__">try_from</span>((slice[<span class="number">0</span>],slice[<span class="number">1</span>],slice[<span class="number">2</span>]))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// Use the `try_from` function</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c1</span> = Color::<span class="title function_ invoke__">try_from</span>((<span class="number">183</span>, <span class="number">65</span>, <span class="number">14</span>));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, c1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Since TryFrom is implemented for Color, we should be able to use TryInto</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c2</span>: <span class="type">Result</span>&lt;Color, _&gt; = [<span class="number">183</span>, <span class="number">65</span>, <span class="number">14</span>].<span class="title function_ invoke__">try_into</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, c2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">183</span>, <span class="number">65</span>, <span class="number">14</span>];</span><br><span class="line">    <span class="comment">// With slice we should use `try_from` function</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c3</span> = Color::<span class="title function_ invoke__">try_from</span>(&amp;v[..]);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, c3);</span><br><span class="line">    <span class="comment">// or take slice within round brackets and use TryInto</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c4</span>: <span class="type">Result</span>&lt;Color, _&gt; = (&amp;v[..]).<span class="title function_ invoke__">try_into</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, c4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TryFrom 是 Rust 标准库中的一个工具，它可以让我们从一个类型转换到另一个类型。但与 From 不同的是，TryFrom 会在转换失败时返回错误，而不是 panic。</p>
<p>例如，假设我们有一个字符串表示年龄，我们想把它转换成一个 usize 类型。使用 FromStr trait 我们可以通过调用 parse() 函数轻松地实现这个转换，如果能成功转换，则返回解析后的值，否则返回一个 Err 对象。这种方式简单易懂，但是它违反了 Rust 的一些设计原则——避免隐藏错误。</p>
<p>如果我们使用 FromStr 进行转换时没有考虑到错误情况，那么就会导致程序在转换失败时无法处理错误，最终产生不可预测的后果。</p>
<p>TryFrom 就是为了解决这个问题而诞生的。它强制我们在类型转换中考虑错误的情况，并且在转换失败时返回一个合适的错误类型，以便我们能够更好地处理错误。当我们使用 TryFrom 时，我们需要为目标类型实现 TryFrom trait，并使用 try_from() 函数进行转换。如果转换成功，则返回之前提及的 Ok 对象，否则返回一个 Err 对象，其中包含了转换失败的相关信息。</p>
<h2 id="094-conversions-as-ref-mut-rs"><a href="#094-conversions-as-ref-mut-rs" class="headerlink" title="094 conversions&#x2F;as_ref_mut.rs"></a>094 conversions&#x2F;as_ref_mut.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">byte_counter</span>&lt;T: <span class="built_in">AsRef</span>&lt;<span class="type">str</span>&gt;&gt;(arg: T) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    arg.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">as_bytes</span>().<span class="title function_ invoke__">len</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Obtain the number of characters (not bytes) in the given argument.</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Add the AsRef trait appropriately as a trait bound.</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">char_counter</span>&lt;T: <span class="built_in">AsRef</span>&lt;<span class="type">str</span>&gt;&gt;(arg: T) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    arg.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">count</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Squares a number using as_mut().</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Add the appropriate trait bound.</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">num_sq</span>&lt;T: <span class="built_in">AsMut</span>&lt;<span class="type">u32</span>&gt;&gt;(arg: &amp;<span class="keyword">mut</span> T) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement the function body.</span></span><br><span class="line">    *arg.<span class="title function_ invoke__">as_mut</span>() *= *arg.<span class="title function_ invoke__">as_mut</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">different_counts</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;Café au lait&quot;</span>;</span><br><span class="line">        <span class="built_in">assert_ne!</span>(<span class="title function_ invoke__">char_counter</span>(s), <span class="title function_ invoke__">byte_counter</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">same_counts</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;Cafe au lait&quot;</span>;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">char_counter</span>(s), <span class="title function_ invoke__">byte_counter</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">different_counts_using_string</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Café au lait&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_ne!</span>(<span class="title function_ invoke__">char_counter</span>(s.<span class="title function_ invoke__">clone</span>()), <span class="title function_ invoke__">byte_counter</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">same_counts_using_string</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Cafe au lait&quot;</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">char_counter</span>(s.<span class="title function_ invoke__">clone</span>()), <span class="title function_ invoke__">byte_counter</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">mult_box</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span>: <span class="type">Box</span>&lt;<span class="type">u32</span>&gt; = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="title function_ invoke__">num_sq</span>(&amp;<span class="keyword">mut</span> num);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(*num, <span class="number">9</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>as_ref_mut 是一个方法，它允许我们将一个值转换为对同一值的可变引用。</p>
<p>假设我们有一个整数变量 x，它的类型是 i32。通常情况下，如果我们想修改 x 的值，我们需要拥有它的可变借用（mutable borrow）。但是有时候，我们可能已经拥有了一个“不可变的引用”，而我们又希望能够修改这个值。</p>
<p>这时候就可以使用 as_ref_mut 方法来实现。</p>
<p>具体来说，as_ref_mut 方法将一个值转换为对同一值的可变引用，但是只有在原始值（调用 as_ref_mut 方法的值）<strong>本身就是可变的时候</strong>才会返回可变引用。如果原始值是不可变的，那么 as_ref_mut 方法返回一个 None。因此，我们可以通过检查 Option 类型的返回值来确定是否成功地获得了可变引用。</p>
<p>举个例子，假设我们有一个字符串 s，我们希望将其转换为一个字节切片的可变引用。我们可以使用 as_mut 方法将字符串转换为 &amp;mut [u8] 类型的可变引用。如果字符串是可变的，那么转换成功并返回一个 Some 值，其中包含可变引用；否则，返回 None。</p>
<p>总之，as_ref_mut 方法是 Rust 提供的一种转换方法，<strong>它可以方便地将一个值转换为对同一值的可变引用，但只有在原始值本身是可变的情况下才会成功。这样可以帮助我们更好地控制可变性，并提供一种安全和灵活的方式来修改数据。</strong></p>
<p>AsRef 是一个 trait（特质），用于将一个类型转换为另一种类型的引用。</p>
<p>AsRef 的主要作用是允许我们以统一的方式处理不同类型之间的转换。通过实现 AsRef trait，我们可以定义一个类型转换函数，该函数将一个类型转换为另一个类型的引用，而不是拥有新的所有权。</p>
<p>具体来说，如果我们有一个类型 T，并且希望将其转换为类型 U 的引用，我们可以实现 <code>AsRef &lt;U&gt; trait</code> 来完成这个转换。在实现中，我们需要提供一个名为 as_ref 的方法，该方法返回类型 &amp;U。这样，我们就可以使用 as_ref 方法来将 T 转换为 U 的引用。</p>
<p>当我们在代码中需要将一个类型转换为另一个类型的引用时，可以使用 as_ref 方法来进行转换。这对于接受不同类型引用参数的函数或方法非常有用，因为它使得我们可以使用相同的代码来处理不同的类型。</p>
<p>AsRef trait 主要用于提供一种通用的引用转换机制，使得代码更加灵活和可重用。在标准库中，许多类型都实现了 AsRef trait，例如字符串、向量、切片等。这意味着我们可以使用 as_ref 方法来将这些类型转换为其他类型的引用，而不需要进行显式的类型转换。</p>
<p>总之，AsRef 是 Rust 中的一个 trait，它提供了一种统一的方式来将一个类型转换为另一个类型的引用。通过实现 AsRef trait，我们可以定义自己的类型转换，并使用 as_ref 方法来执行转换操作。这为代码重用和类型灵活性提供了便利。</p>
<p>as_mut()和AsMut trait就也很好理解了。跟上面AsRef极其类似。至于为什么要使用as_mut，这是因为T类型因为不确定，所以编译器不清楚它的内部值是否可以直接修改，所以对泛型参数进行可变操作是被禁止的，所以我们用as_mut明确地告诉编译器该类型是可变的。</p>
<p>AsMut <T> 是一个标准库中定义的 trait，它将类型 T 转换为一个指向其内部值的可变引用。当我们在泛型函数中使用 T: AsMut <u32> 这个 trait bound 时，我们告诉编译器要求 T 类型必须具备将其内部值作为 u32 类型的可变引用的能力。通过这个 trait bound，编译器就可以安全地假设我们可以使用 as_mut() 方法来获得一个指向 arg 内部值的可变引用。这样，我们就可以对该值进行修改，而不会破坏借用规则。</p>
<h2 id="095-tests-tests5-rs"><a href="#095-tests-tests5-rs" class="headerlink" title="095 tests&#x2F;tests5.rs"></a>095 tests&#x2F;tests5.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// # Safety</span></span><br><span class="line"><span class="comment">/// The `address` must contain a mutable reference to a valid `u32` value.</span></span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">fn</span> <span class="title function_">modify_by_address</span>(address: <span class="type">usize</span>) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Fill your safety notice of the code block below to match your</span></span><br><span class="line">    <span class="comment">// code&#x27;s behavior and the contract of this function. You may use the</span></span><br><span class="line">    <span class="comment">// comment of the test below as your format reference.</span></span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        *(address <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">u32</span>) = <span class="number">0xAABBCCDD</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_success</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">t</span>: <span class="type">u32</span> = <span class="number">0x12345678</span>;</span><br><span class="line">        <span class="comment">// SAFETY: The address is guaranteed to be valid and contains</span></span><br><span class="line">        <span class="comment">// a unique reference to a `u32` local variable.</span></span><br><span class="line">        <span class="keyword">unsafe</span> &#123; <span class="title function_ invoke__">modify_by_address</span>(&amp;<span class="keyword">mut</span> t <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">u32</span> <span class="keyword">as</span> <span class="type">usize</span>) &#125;;</span><br><span class="line">        <span class="built_in">assert!</span>(t == <span class="number">0xAABBCCDD</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><ul>
<li><a target="_blank" rel="noopener" href="https://rqdmap.top/posts/rust-unsafe/">https://rqdmap.top/posts/rust-unsafe/</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/388258029">https://zhuanlan.zhihu.com/p/388258029</a></li>
</ul>
<h2 id="096-tests-tests6-rs"><a href="#096-tests-tests6-rs" class="headerlink" title="096 tests&#x2F;tests6.rs"></a>096 tests&#x2F;tests6.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In this example we take a shallow dive into the Rust standard library&#x27;s</span></span><br><span class="line"><span class="comment">// unsafe functions. Fix all the question marks and todos to make the test</span></span><br><span class="line"><span class="comment">// pass.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint tests6` or use the `hint` watch subcommand for a</span></span><br><span class="line"><span class="comment">// hint.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    a: <span class="type">u128</span>,</span><br><span class="line">    b: <span class="type">Option</span>&lt;<span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// # Safety</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The `ptr` must contain an owned box of ` ???Foo`.</span></span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">fn</span> <span class="title function_">raw_pointer_to_box</span>(ptr: *<span class="keyword">mut</span> Foo) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;Foo&gt; &#123;</span><br><span class="line">    <span class="comment">// SAFETY: The `ptr` contains an owned box of `Foo` by contract. We</span></span><br><span class="line">    <span class="comment">// simply reconstruct the box from that pointer.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ret</span>: <span class="type">Box</span>&lt;Foo&gt; = <span class="keyword">unsafe</span> &#123; <span class="type">Box</span>::<span class="title function_ invoke__">from_raw</span>(ptr) &#125;;</span><br><span class="line">    ret.b = <span class="title function_ invoke__">Some</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line">    ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    <span class="keyword">use</span> std::time::Instant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_success</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">data</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Foo &#123; a: <span class="number">1</span>, b: <span class="literal">None</span> &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ptr_1</span> = &amp;data.a <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">u128</span> <span class="keyword">as</span> <span class="type">usize</span>;</span><br><span class="line">        <span class="comment">// SAFETY: We pass an owned box of ` ???Foo`.</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ret</span> = <span class="keyword">unsafe</span> &#123; <span class="title function_ invoke__">raw_pointer_to_box</span>(<span class="type">Box</span>::<span class="title function_ invoke__">into_raw</span>(data)) &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ptr_2</span> = &amp;ret.a <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">u128</span> <span class="keyword">as</span> <span class="type">usize</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(ptr_1 == ptr_2);</span><br><span class="line">        <span class="built_in">assert!</span>(ret.b == <span class="title function_ invoke__">Some</span>(<span class="string">&quot;hello&quot;</span>.<span class="title function_ invoke__">to_owned</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="097-tests-tests7-rs"><a href="#097-tests-tests7-rs" class="headerlink" title="097 tests&#x2F;tests7.rs"></a>097 tests&#x2F;tests7.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// When building packages, some dependencies can neither be imported in</span></span><br><span class="line"><span class="comment">// `Cargo.toml` nor be directly linked; some preprocesses varies from code</span></span><br><span class="line"><span class="comment">// generation to set-up package-specific configurations.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Cargo does not aim to replace other build tools, but it does integrate</span></span><br><span class="line"><span class="comment">// with them with custom build scripts called `build.rs`. This file is</span></span><br><span class="line"><span class="comment">// usually placed in the root of the project, while in this case the same</span></span><br><span class="line"><span class="comment">// directory of this exercise.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// It can be used to:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// ## Building a bundled C library.</span></span><br><span class="line"><span class="comment">// ## Finding a C library on the host system.</span></span><br><span class="line"><span class="comment">// ## Generating a Rust module from a specification.</span></span><br><span class="line"><span class="comment">// ## Performing any platform-specific configuration needed for the crate.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// When setting up configurations, we can `println!` in the build script</span></span><br><span class="line"><span class="comment">// to tell Cargo to follow some instructions. The generic format is:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     println!(&quot;cargo:&#123;&#125;&quot;, your_command_in_string);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Please see the official Cargo book about build scripts for more</span></span><br><span class="line"><span class="comment">// information:</span></span><br><span class="line"><span class="comment">// https://doc.rust-lang.org/cargo/reference/build-scripts.html</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// In this exercise, we look for an environment variable and expect it to</span></span><br><span class="line"><span class="comment">// fall in a range. You can look into the testcase to find out the details.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// You should NOT modify this file. Modify `build.rs` in the same directory to pass this exercise.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint tests7` or use the `hint` watch subcommand for a</span></span><br><span class="line"><span class="comment">// hint.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// std::env::set_var(&quot;TEST_FOO&quot;, timestamp.to_string());</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_success</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">timestamp</span> = std::time::SystemTime::<span class="title function_ invoke__">now</span>()</span><br><span class="line">            .<span class="title function_ invoke__">duration_since</span>(std::time::UNIX_EPOCH)</span><br><span class="line">            .<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">            .<span class="title function_ invoke__">as_secs</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">s</span> = std::env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;TEST_FOO&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">e</span>: <span class="type">u64</span> = s.<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="built_in">assert!</span>(timestamp &gt;= e &amp;&amp; timestamp &lt; e + <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="098-tests-tests8-rs"><a href="#098-tests-tests8-rs" class="headerlink" title="098 tests&#x2F;tests8.rs"></a>098 tests&#x2F;tests8.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This execrise shares `build.rs` with the previous exercise.</span></span><br><span class="line"><span class="comment">// You need to add some code to `build.rs` to make both this exercise and</span></span><br><span class="line"><span class="comment">// the previous one work.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Execute `rustlings hint tests8` or use the `hint` watch subcommand for a</span></span><br><span class="line"><span class="comment">// hint.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_success</span>() &#123;</span><br><span class="line">        <span class="meta">#[cfg(feature = <span class="string">&quot;pass&quot;</span>)]</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">&quot;no cfg set&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="099-tests-tests9-rs"><a href="#099-tests-tests9-rs" class="headerlink" title="099 tests&#x2F;tests9.rs"></a>099 tests&#x2F;tests9.rs</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rust is highly capable of sharing FFI interfaces with C/C++ and other statically compiled</span></span><br><span class="line"><span class="comment">// languages, and it can even link within the code itself! It makes it through the extern</span></span><br><span class="line"><span class="comment">// block, just like the code below.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The short string after the `extern` keyword indicates which ABI the externally imported</span></span><br><span class="line"><span class="comment">// function would follow. In this exercise, &quot;Rust&quot; is used, while other variants exists like</span></span><br><span class="line"><span class="comment">// &quot;C&quot; for standard C ABI, &quot;stdcall&quot; for the Windows ABI.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The externally imported functions are declared in the extern blocks, with a semicolon to</span></span><br><span class="line"><span class="comment">// mark the end of signature instead of curly braces. Some attributes can be applied to those</span></span><br><span class="line"><span class="comment">// function declarations to modify the linking behavior, such as #[link_name = &quot;..&quot;] to</span></span><br><span class="line"><span class="comment">// modify the actual symbol names.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// If you want to export your symbol to the linking environment, the `extern` keyword can</span></span><br><span class="line"><span class="comment">// also be marked before a function definition with the same ABI string note. The default ABI</span></span><br><span class="line"><span class="comment">// for Rust functions is literally &quot;Rust&quot;, so if you want to link against pure Rust functions,</span></span><br><span class="line"><span class="comment">// the whole extern term can be omitted.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Rust mangles symbols by default, just like C++ does. To suppress this behavior and make</span></span><br><span class="line"><span class="comment">// those functions addressable by name, the attribute #[no_mangle] can be applied.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// In this exercise, your task is to make the testcase able to call the `my_demo_function` in</span></span><br><span class="line"><span class="comment">// module Foo. the `my_demo_function_alias` is an alias for `my_demo_function`, so the two</span></span><br><span class="line"><span class="comment">// line of code in the testcase should call the same function.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// You should NOT modify any existing code except for adding two lines of attributes.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;Rust&quot;</span> &#123;</span><br><span class="line">    <span class="meta">#[no_mangle]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">my_demo_function</span>(a: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[no_mangle]</span></span><br><span class="line">    <span class="meta">#[link_name = <span class="string">&quot;my_demo_function&quot;</span>]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">my_demo_function_alias</span>(a: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> Foo &#123;</span><br><span class="line">    <span class="comment">// No `extern` equals `extern &quot;Rust&quot;`.</span></span><br><span class="line">    <span class="meta">#[no_mangle]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">my_demo_function</span>(a: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_success</span>() &#123;</span><br><span class="line">        <span class="comment">// The externally imported functions are UNSAFE by default</span></span><br><span class="line">        <span class="comment">// because of untrusted source of other languages. You may</span></span><br><span class="line">        <span class="comment">// wrap them in safe Rust APIs to ease the burden of callers.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// SAFETY: We know those functions are aliases of a safe</span></span><br><span class="line">        <span class="comment">// Rust function.</span></span><br><span class="line">        <span class="keyword">unsafe</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">my_demo_function</span>(<span class="number">123</span>);</span><br><span class="line">            <span class="title function_ invoke__">my_demo_function_alias</span>(<span class="number">456</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考：-1"><a href="#参考：-1" class="headerlink" title="参考："></a>参考：</h2><ul>
<li><a target="_blank" rel="noopener" href="https://rust-book.junmajinlong.com/">https://rust-book.junmajinlong.com</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Roboduster/p/17781712.html">https://www.cnblogs.com/Roboduster/p/17781712.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43840665/article/details/130065993">https://blog.csdn.net/qq_43840665/article/details/130065993</a></li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/rust/rust-tutorial.html">https://www.runoob.com/rust/rust-tutorial.html</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/08/31/os5/" rel="prev" title="os5">
                  <i class="fa fa-angle-left"></i> os5
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">zhou tao</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
